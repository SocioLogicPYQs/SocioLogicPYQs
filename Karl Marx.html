<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YOUR PYQ BATTLE</title>
    <style>
        :root {
            --brand-main: #2563eb;
            --brand-grad: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --bg-grad: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-light: #64748b;
            --success: #15803d;
            --danger: #b91c1c;
            --review: #7c3aed;
            --selected: #eff6ff;
            --radius: 16px;
            --shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-grad);
            color: var(--text-main);
            height: 100vh;
            height: 100dvh;
            /* Mobile Chrome Fix */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- 1. WELCOME SCREEN --- */
        #welcome-screen {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: white;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- UPDATED WELCOME SCREEN (Wider & Premium) --- */
        .welcome-card {
            background: white;
            width: 90%;
            /* Good for Mobile */
            max-width: 700px;
            /* Increased from 450px for Laptop (Wider look) */
            padding: 50px;
            /* More spacious "Grand" feel */
            border-radius: 24px;
            /* Softer corners */
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
            /* Deeper shadow */
            text-align: center;
            border: 1px solid #e2e8f0;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            /* Fixes layout alignment */
            flex-direction: column;
            align-items: center;
            /* Centers everything perfectly */
        }

        /* Ensure input fields don't stretch too ugly on the wide screen */
        .welcome-card .input-field {
            max-width: 500px;
            /* Keeps inputs looking neat */
            width: 100%;
        }

        /* Mobile Adjustment */
        @media(max-width: 600px) {
            .welcome-card {
                width: 95%;
                /* Maximize space on phone */
                padding: 30px 20px;
                /* Slightly tighter padding for small screens */
            }
        }

        .mode-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #64748b;
            font-weight: 600;
        }

        .mode-btn.active {
            border-color: #2563eb;
            background: #eff6ff;
            color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }

        /* --- SCORECARD GRID STYLES --- */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        .score-card-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            text-align: center;
        }

        .sc-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .sc-value {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1.1rem;
            outline: none;
            text-align: center;
            font-weight: 600;
            transition: 0.2s;
        }

        .input-field:focus {
            border-color: #2563eb;
        }

        #attempt-badge {
            display: inline-block;
            background: #fff7ed;
            color: #c2410c;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            border: 1px solid #ffedd5;
            margin-bottom: 20px;
        }

        /* --- 2. MAIN INTERFACE --- */
        #app-wrapper {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        /* Header */
        nav {
            background: var(--brand-grad);
            color: white;
            height: 64px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            z-index: 50;
            flex-shrink: 0;
        }

        .timer-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 8px;
            font-family: monospace;
            font-weight: 700;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
        }

        /* Main Area */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .main-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
        }

        .q-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            max-width: 900px;
            width: 100%;
            height: fit-content;
            border-top: 5px solid #2563eb;
            animation: slideUp 0.3s ease-out;
            margin-bottom: 40px;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .topic-tag {
            background: #eff6ff;
            color: #1e40af;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .q-text {
            font-size: 1.2rem;
            font-weight: 600;
            line-height: 1.6;
            color: var(--text-main);
            margin-bottom: 25px;
        }

        /* Options */
        .option {
            display: flex;
            align-items: flex-start;
            padding: 16px 20px;
            margin-bottom: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            line-height: 1.5;
        }

        .option:hover {
            border-color: #93c5fd;
            background: #f8fafc;
        }

        .option.selected {
            border-color: #2563eb;
            background: var(--selected);
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.1);
        }

        .option.selected .opt-key {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .option.review-marked {
            border-color: var(--review);
            background: #f5f3ff;
        }

        .option.review-marked .opt-key {
            background: var(--review);
            color: white;
            border-color: var(--review);
        }

        .opt-key {
            min-width: 32px;
            height: 32px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #64748b;
            margin-right: 15px;
            font-size: 0.9rem;
        }

        /* Sidebar (Desktop Default) */
        .sidebar {
            width: 340px;
            background: white;
            border-left: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            z-index: 40;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sb-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            overflow-y: auto;
            align-content: start;
        }

        .grid-btn {
            aspect-ratio: 1;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #64748b;
            background: white;
        }

        /* States */
        .st-curr {
            border-color: #2563eb;
            color: #2563eb;
            box-shadow: inset 0 0 0 2px #2563eb;
        }

        .st-ans {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .st-rev {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .st-ans-rev {
            background: var(--review);
            border-color: var(--review);
            color: white;
        }

        /* Footer */
        .footer-bar {
            height: 72px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 30;
            flex-shrink: 0;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            transition: 0.2s;
            white-space: nowrap;
        }

        .btn-pri {
            background: #1e40af;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.2);
        }

        .btn-sec {
            background: white;
            border: 2px solid #e2e8f0;
            color: #475569;
        }

        .btn-rev {
            background: #fffbeb;
            color: #b45309;
            border: 1px solid #fcd34d;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* --- PREMIUM MOBILE/TABLET ADAPTATION --- */
        /* Only activates when 'mobile-mode' class is on body */
        body.mobile-mode .sidebar {
            position: fixed;
            right: 0;
            top: 64px;
            bottom: 0;
            width: 85%;
            max-width: 320px;
            transform: translateX(100%);
            /* Hidden by default */
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.2);
        }

        body.mobile-mode .sidebar.active {
            transform: translateX(0);
        }

        /* Slide in */

        body.mobile-mode .main-area {
            padding: 15px;
        }

        body.mobile-mode .q-card {
            padding: 25px;
            border-radius: 12px;
        }

        /* Bigger Touch Targets for Mobile */
        body.mobile-mode .option {
            padding: 18px 15px;
            margin-bottom: 12px;
        }

        body.mobile-mode .btn {
            padding: 14px 18px;
            font-size: 1rem;
        }

        body.mobile-mode .footer-bar {
            height: 80px;
            padding: 0 15px;
        }

        /* Hide Text Labels on Mobile Footer if needed to fit */
        body.mobile-mode .btn-sec span {
            display: none;
        }

        body.mobile-mode .btn svg {
            display: block;
        }

        /* --- COMPACT RESULT CARD STYLES --- */
        /* --- UPDATED WIDTH FOR RESULT CARD --- */
        .res-card {
            background: #ffffff;
            width: 95%;
            /* Uses 95% screen width on Mobile */
            max-width: 900px;
            /* Increased from 500px to 900px for Laptop */
            max-height: 90vh;
            /* Keeps it fitting vertically */
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .res-header {
            background: var(--brand-grad);
            padding: 20px;
            /* Reduced padding */
            text-align: center;
            color: white;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .res-header h2 {
            font-size: 1.1rem;
            margin: 0 0 15px 0;
            opacity: 0.95;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* Compact Score Grid */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            /* 4 items in one row */
            gap: 8px;
            margin: 0;
        }

        .score-card-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 4px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            text-align: center;
        }

        .sc-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.85;
            margin-bottom: 3px;
            font-weight: 600;
        }

        .sc-value {
            font-size: 1.15rem;
            font-weight: 700;
            line-height: 1.1;
        }

        /* Result Body */
        .res-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            background: #f8fafc;
        }

        /* Analysis Boxes */
        .analysis-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .analysis-box {
            background: white;
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        }

        .ab-title {
            font-size: 0.7rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ab-val {
            font-size: 0.9rem;
            font-weight: 700;
            color: #334155;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- MISSING OVERLAY & EXPLANATION STYLES --- */
        .overlay {
            display: none;
            /* Hidden by default */
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.8);
            /* Dark background */
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        /* Explanation Feed Styling */
        .exp-row {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .exp-row.correct {
            border-left: 5px solid #16a34a;
        }

        .exp-row.wrong {
            border-left: 5px solid #dc2626;
        }

        .exp-detail {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            margin-top: 15px;
            padding-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .why-box {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #334155;
        }

        .txt-green {
            color: #16a34a;
            font-weight: 700;
        }

        .txt-red {
            color: #dc2626;
            font-weight: 700;
        }

        /* Mobile Tweak: Stack scores if screen is too small */
        @media(max-width: 400px) {
            .score-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* --- PREMIUM HISTORY MODAL --- */
        #history-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 250;
            background: rgba(15, 23, 42, 0.7);
            /* Darker blur */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.2s ease-out;
        }

        .history-card {
            background: white;
            width: 90%;
            max-width: 550px;
            max-height: 80vh;
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .hist-header {
            padding: 25px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hist-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1e293b;
            letter-spacing: -0.5px;
        }

        .hist-close {
            background: #fee2e2;
            color: #ef4444;
            border: none;
            padding: 8px 16px;
            border-radius: 99px;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.2s;
        }

        .hist-close:hover {
            background: #fecaca;
            transform: scale(1.05);
        }

        .hist-list {
            padding: 20px;
            overflow-y: auto;
            background: #f8fafc;
            flex: 1;
        }

        /* The Individual Attempt Card */
        .hist-item {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .hist-item:hover {
            transform: translateY(-3px);
            border-color: #3b82f6;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1);
        }

        .h-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .h-title {
            font-weight: 700;
            color: #334155;
            font-size: 1rem;
        }

        .h-date {
            font-size: 0.8rem;
            color: #94a3b8;
            font-weight: 500;
        }

        .h-score-badge {
            background: #eff6ff;
            color: #2563eb;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            border: 1px solid #dbeafe;
        }

        /* Empty State */
        .hist-empty {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
            font-style: italic;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media(max-width: 768px) {
            .analysis-row {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            /* Default hide on small screens until toggled */
            .sidebar.active {
                display: flex;
                position: fixed;
                right: 0;
                top: 64px;
                bottom: 0;
                width: 85%;
                transform: none;
                box-shadow: -10px 0 20px rgba(0, 0, 0, 0.2);
            }
        }


        /* --- NEW HEADER STYLES --- */
        .header-left-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-box {
            background: white;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .logo-box img {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
        }

        .candidate-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
            line-height: 1.2;
        }

        .candidate-name {
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            font-size: 20px;
            /* Bigger Font */
            font-weight: 700;
            /* Bold */
            margin: 0;
            letter-spacing: 0.5px;
            text-transform: capitalize;
        }

        .test-badge {
            color: rgba(255, 255, 255, 0.85);
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 2px;
        }

        /* --- GLOBAL WATERMARK --- */
        body::after {
            content: "";
            position: fixed;
            inset: 0;
            background-image: url('https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50vmin;
            opacity: 0.1;
            z-index: 9999;
            pointer-events: none;
            filter: grayscale(100%);
            mix-blend-mode: multiply;
        }

        /* --- IMPROVED THANK YOU SCREEN --- */
        .ty-card {
            background: white;
            width: 90%;
            max-width: 750px;
            /* Wider on Laptop for grandeur */
            padding: 60px 40px;
            /* Generous spacing for symmetry */
            text-align: center;
            border-radius: 30px;
            box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.4s ease-out;
        }

        .ty-header {
            font-size: 3.5rem;
            /* Very large, clear text */
            font-weight: 800;
            color: #0f172a;
            margin: 20px 0 15px 0;
            line-height: 1.1;
            letter-spacing: -1px;
        }

        .ty-msg {
            font-size: 1.4rem;
            /* Large, easy-to-read body text */
            color: #475569;
            line-height: 1.8;
            /* High readability */
            margin-bottom: 40px;
            max-width: 90%;
            /* Prevents text stretching too wide */
        }

        /* Mobile Adjustments */
        @media(max-width: 600px) {
            .ty-card {
                padding: 40px 20px;
            }

            .ty-header {
                font-size: 2.5rem;
            }

            /* Adjusted for phone screens */
            .ty-msg {
                font-size: 1.15rem;
                line-height: 1.6;
            }
        }

        /* --- RESUME NAVIGATION TOAST --- */
        .resume-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            /* Hidden initially */
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            border: 1px solid #e2e8f0;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 300px;
        }

        .resume-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .rt-text {
            font-size: 0.9rem;
            color: #1e293b;
            flex: 1;
        }

        .rt-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            white-space: nowrap;
        }

        .rt-close {
            background: #f1f5f9;
            color: #64748b;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body onload="document.getElementById('instrOverlay').style.display='flex'">

<div id="instrOverlay" style="display:flex; position:fixed; inset:0; background:rgba(255,255,255,0.98); z-index:9999; align-items:center; justify-content:center; font-family:'Segoe UI', sans-serif;">
    <div style="width:100%; max-width:600px; background:white; padding:30px; border-radius:20px; box-shadow:0 25px 50px rgba(0,0,0,0.15); border:1px solid #e2e8f0; max-height:90vh; overflow-y:auto; margin:15px;">
        <div style="text-align:center; border-bottom:2px solid #eff6ff; padding-bottom:15px; margin-bottom:20px;">
            <h2 style="margin:0; color:#1e293b; font-size:22px;">üìú Instructions</h2>
            <p style="margin:5px 0 0; color:#64748b; font-size:14px;">Please read the marking scheme carefully</p>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:25px;">
            <div style="background:#f0fdf4; padding:15px; border-radius:12px; border:1px solid #bbf7d0; text-align:center;">
                <div style="color:#166534; font-size:12px; font-weight:700; text-transform:uppercase;">Correct Answer</div>
                <div style="font-size:24px; font-weight:800; color:#15803d;">+4</div>
            </div>
            <div style="background:#fef2f2; padding:15px; border-radius:12px; border:1px solid #fecaca; text-align:center;">
                <div style="color:#991b1b; font-size:12px; font-weight:700; text-transform:uppercase;">Incorrect Answer</div>
                <div style="font-size:24px; font-weight:800; color:#dc2626;">-1</div>
            </div>
        </div>

        <div style="background:#f8fafc; padding:20px; border-radius:12px; margin-bottom:25px; border:1px solid #e2e8f0;">
            <h3 style="margin:0 0 10px 0; font-size:16px; color:#334155;">üéÆ How to Submit:</h3>
            <ul style="margin:0; padding-left:20px; color:#475569; font-size:14px; line-height:1.6;">
                <li><strong>Smartphone Users:</strong> Use the <span style="color:#dc2626; font-weight:bold;">Red Submit Button</span> in the bottom footer.</li>
                <li><strong>Laptop Users:</strong> Click 'Submit Test' on the sidebar.</li>
                <li>You can review and change answers anytime before submitting.</li>
            </ul>
        </div>

        <button onclick="document.getElementById('instrOverlay').style.display='none'" style="width:100%; padding:16px; background:#2563eb; color:white; border:none; border-radius:12px; font-size:16px; font-weight:700; cursor:pointer; box-shadow:0 4px 12px rgba(37,99,235,0.2);">I am ready to begin ‚ûú</button>
    </div>
</div>

    <div id="welcome-screen">
        <div class="welcome-card">
            <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="SocioLogic"
                style="height: 120px; width: auto; display: inline-block;">

            <h1 style="color:#1e293b; margin:0; font-size:1.8rem; letter-spacing:-0.5px;">YOUR PYQ BATTLE</h1>
            <p style="color:#64748b; margin-top:5px; margin-bottom:20px;">Karl Marx</p>

            <div class="mode-selector">
                <div class="mode-btn active" onclick="setMode('desktop')" id="btn-desktop">
                    <span style="font-size:1.5rem">üíª</span>
                    <span style="font-size:0.9rem">Laptop/Tablet</span>
                </div>
                <div class="mode-btn" onclick="setMode('mobile')" id="btn-mobile">
                    <span style="font-size:1.5rem">üì±</span>
                    <span style="font-size:0.9rem">Mobile</span>
                </div>
            </div>

            <input type="text" id="candidateName" class="input-field" placeholder="Enter Your Name" autocomplete="off"
                style="margin-bottom:10px;">

            <input type="text" id="username" class="input-field" placeholder="Enter 4-Digit ID" autocomplete="off">

            <div id="attempt-badge"
                style="margin-bottom:15px; font-size:0.85rem; color:#64748b; font-weight:600; padding:10px; border-radius:8px; background:#f1f5f9; border:1px solid #e2e8f0;">
                Waiting for Candidate ID...
            </div>
            <button id="start-btn" class="btn btn-pri"
                style="width:100%; justify-content:center; padding:15px; font-size:1.1rem;" onclick="startTest()">
                Start Examination ‚ûú
            </button>

            <button class="btn btn-sec" style="width:100%; justify-content:center; margin-top:10px;"
                onclick="openHistory()">
                üìú View Past Attempts
            </button>

            <div style="margin-top: 25px; border-top: 1px dashed #cbd5e1; padding-top: 20px;">
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 10px; font-weight:600;">New Student?</p>
                <a href="https://rzp.io/rzp/xddl5LdV" target="_blank" style="text-decoration: none;">
                    <button class="btn"
                        style="background: #10b981; color: white; width: 100%; justify-content: center; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);">
                        ‚ö° Buy Full Access at just (‚Çπ149)
                    </button>
                </a>
                <div style="font-size:0.75rem; color:#94a3b8; margin-top:5px;">Last 4 digits of your phone will be your
                    ID</div>
            </div>
        </div>
    </div>

    <div id="history-modal">
        <div class="history-card">
            <div class="hist-header">
                <span class="hist-title">üìú Past Attempts</span>
                <button class="hist-close" onclick="closeHistory()">Close</button>
            </div>
            <div id="history-list" class="hist-list"></div>
        </div>
    </div>

    <div id="app-wrapper">
        <nav>
            <div class="header-left-section">
                <div class="logo-box">
                    <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="Logo" />
                </div>
                <div class="candidate-details">
                    <h1 class="candidate-name" id="nav-user">Guest</h1>
                    <div class="test-badge">Karl Marx</div>
                </div>
            </div>
            <div class="timer-badge" id="timer">00:00:00</div>
            <button class="btn btn-sec" style="padding:8px;" onclick="toggleSidebar()" id="mob-menu">‚ò∞</button>
        </nav>

        <div class="container">
            <div class="main-area">
                <div class="q-card" id="q-panel"></div>
            </div>

            <aside class="sidebar" id="sidebar">
                <div
                    style="padding:15px; border-bottom:1px solid #e2e8f0; font-weight:700; color:#334155; display:flex; justify-content:space-between; align-items:center;">
                    <span>Question Map</span>
                    <span onclick="toggleSidebar()" style="cursor:pointer; font-size:1.2rem; display:none;"
                        id="mob-close-sb">‚úï</span>
                </div>
                <div class="sb-grid" id="palette"></div>
                <div style="padding:20px; border-top:1px solid #e2e8f0; margin-top:auto;">
                    <button class="btn btn-danger" style="width:100%; justify-content:center;"
                        onclick="finishTest()">SUBMIT TEST</button>
                </div>
            </aside>
        </div>

        <div class="footer-bar" style="padding:0 10px; gap:5px; height:auto; min-height:72px;">
        <div style="display:flex; gap:5px; flex:1;">
            <button class="btn btn-sec" onclick="clearResp()" style="flex:1; justify-content:center; padding:10px; font-size:0.8rem;">Clear</button>
            <button class="btn btn-rev" onclick="markReview()" id="btn-review" style="flex:1; justify-content:center; padding:10px; font-size:0.8rem;">üö© Review</button>
        </div>
        <div style="display:flex; gap:5px; flex:1.5;">
            <button class="btn btn-sec" onclick="nav(-1)" style="padding:10px;">Prev</button>
            <button class="btn btn-pri" onclick="nav(1)" id="btn-next" style="flex:1; justify-content:center; padding:10px; font-size:0.9rem;">Next ‚ûú</button>
            <button class="btn btn-danger" onclick="finishTest()" style="padding:10px; background:#dc2626; color:white;">Submit</button>
        </div>
    </div>
    </div>

    <div class="overlay" id="result-overlay">
        <div class="res-card">
            <div class="res-header">
                <h2>Assessment Report</h2>
                <div class="score-grid">
                    <div class="score-card-item">
                        <div class="sc-label">Attempted</div>
                        <div class="sc-value" id="disp-att">0</div>
                    </div>
                    <div class="score-card-item"
                        style="background: rgba(220, 252, 231, 0.25); border-color: rgba(220, 252, 231, 0.5);">
                        <div class="sc-label" style="color:#dcfce7;">Correct</div>
                        <div class="sc-value" style="color:#f0fdf4;" id="disp-cor">0</div>
                    </div>
                    <div class="score-card-item"
                        style="background: rgba(254, 226, 226, 0.25); border-color: rgba(254, 226, 226, 0.5);">
                        <div class="sc-label" style="color:#fee2e2;">Wrong</div>
                        <div class="sc-value" style="color:#fef2f2;" id="disp-wro">0</div>
                    </div>
                    <div class="score-card-item">
                        <div class="sc-label">Score</div>
                        <div class="sc-value" id="disp-score">0</div>
                    </div>
                </div>

                <button onclick="showThankYou()" style="margin-top:15px; width:100%; padding:10px; background:#ffffff; color:#1e40af; border:none; border-radius:8px; font-weight:800; cursor:pointer; font-size:0.9rem; box-shadow:0 4px 6px rgba(0,0,0,0.1); transition:transform 0.2s;">
                    Exit & Save Report ‚ûú
                </button>
            </div>

            <div class="res-body">

            <div class="analysis-row">
                    <div class="analysis-box" style="border-left:4px solid #15803d;">
                        <div class="ab-title" style="color:#15803d">üí™ Strongest</div>
                        <div class="ab-val" id="area-strong">--</div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:3px;" id="area-strong-stat">Acc: 0%
                        </div>
                    </div>
                    <div class="analysis-box" style="border-left:4px solid #b91c1c;">
                        <div class="ab-title" style="color:#b91c1c">‚ö†Ô∏è Weakest</div>
                        <div class="ab-val" id="area-weak">--</div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:3px;" id="area-weak-stat">Acc: 0%</div>
                    </div>
                </div>

                <h3
                    style="font-size:0.95rem; font-weight:700; color:#0f172a; margin-bottom:15px; border-bottom:1px solid #e2e8f0; padding-bottom:8px;">
                    Detailed Explanations
                </h3>

                <div id="solution-feed"></div>

                <div style="text-align:center; margin-top:25px;">
                    <button class="btn btn-pri" style="width:100%; justify-content:center; padding:12px;"
                        onclick="showThankYou()">
                        Exit & Save Report
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="overlay" id="ty-screen">
        <div class="ty-card">

            <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="SocioLogic"
                style="height: 140px; width: auto; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 50%;">

            <h1 class="ty-header">Test Submitted!</h1>

            <p class="ty-msg">
                Your performance on <b style="color:#1e40af;">SocioLogic</b> has been recorded.<br>
                You are one step closer to your <b style="color:#d97706;">dream university</b>.
            </p>

            <a href="https://t.me/SocioLogicPYQs" target="_blank"
                style="text-decoration:none; width: 100%; max-width: 400px;">
                <button class="btn btn-pri"
                    style="width:100%; justify-content:center; padding: 16px; font-size: 1.1rem; border-radius: 12px; background: #0088cc;">
                    ‚úàÔ∏è Join Telegram Channel
                </button>
            </a>

            <div style="display: flex; gap: 15px; width: 100%; max-width: 500px; margin-top: 25px; flex-wrap: wrap;">

                <button class="btn btn-sec" onclick="location.reload()"
                    style="flex: 1; min-width: 200px; justify-content: center; padding: 16px; border-radius: 12px; font-weight: 700; border: 2px solid #e2e8f0; color: #475569;">
                    üîÑ Restart Test
                </button>

                <a href="index.html" style="text-decoration: none; flex: 1; min-width: 200px;">
                    <button class="btn btn-pri"
                        style="width: 100%; justify-content: center; padding: 16px; border-radius: 12px; background: #0f172a; color: white; font-weight: 700; box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2);">
                        Main Page
                    </button>
                </a>

            </div>
        </div>
    </div>
    <script>
        /* -------------------------------------------------------------
           PASTE YOUR QUESTION DATA HERE
           const questions = [ ... ];
        ------------------------------------------------------------- */
        const questions = [



            {
                topic: "Marxism üè∑Ô∏è UGC NET 2023",
                text: "According to Karl Marx, the history of all hitherto existing society is the history of:",
                options: ["Technological advancements", "Religious wars", "Class struggles", "Evolutionary adaptation"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: In The Communist Manifesto (1848), Marx and Engels famously declared that history is driven by class struggle‚Äîthe conflict between the oppressors and the oppressed (e.g., Bourgeoisie vs. Proletariat).",
                    others: "Technological advancement is part of the forces of production but the 'struggle' is the engine. Evolutionary adaptation is Darwinian, not Marxist.",
                    trick: "PRO TIP: History = Conflict. Conflict = Class Struggle."
                }
            },
            {
                topic: "Alienation üè∑Ô∏è CUET PG 2022",
                text: "Which of the following is NOT one of the four forms of alienation described by Marx in the 'Economic and Philosophic Manuscripts of 1844'?",
                options: ["Alienation from the product of labor", "Alienation from the act of production", "Alienation from religious beliefs", "Alienation from species-being"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The four types are alienation from: 1. The product, 2. The process (act of labor), 3. Others (fellow workers), and 4. Species-being (human nature/creativity). Religion is considered an 'opiate' or form of false consciousness, not a mode of alienation in this specific framework.",
                    others: "Alienation from religion is not part of the structural economic alienation Marx defined in 1844.",
                    trick: "PRO TIP: Remember 'PPOS' - Product, Process, Others, Species."
                }
            },
            {
                topic: "Modes of Production üè∑Ô∏è JNU MA 2020",
                text: "Identify the correct chronological order of Marx's Modes of Production:",
                options: ["Primitive Communism -> Feudalism -> Ancient -> Capitalism -> Communism", "Primitive Communism -> Ancient -> Feudalism -> Capitalism -> Communism", "Ancient -> Primitive Communism -> Feudalism -> Capitalism -> Communism", "Feudalism -> Ancient -> Primitive Communism -> Capitalism -> Communism"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Marx traced historical materialism through specific stages based on ownership of means of production: Primitive Communism (no classes), Ancient (Masters/Slaves), Feudalism (Lords/Serfs), Capitalism (Bourgeoisie/Proletariat), and finally Communism.",
                    others: "Feudalism comes after Ancient society (Rome/Greece) in European history.",
                    trick: "PRO TIP: PAF-C (Primitive, Ancient, Feudal, Capitalist)."
                }
            },
            {
                topic: "Social Structure üè∑Ô∏è DU MA 2019",
                text: "In Marxist theory, the 'Base' of society consists of:",
                options: ["Legal and political structures", "Religious and philosophical ideas", "Forces and relations of production", "The state and the media"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The 'Base' (infrastructure) comprises the forces of production (tools, tech) and relations of production (class relations). The 'Superstructure' (law, religion, culture) is built upon and shaped by this economic base.",
                    others: "Legal, political, and religious structures belong to the Superstructure.",
                    trick: "PRO TIP: Base = Economics (Production). Superstructure = Ideas/Culture."
                }
            },
            {
                topic: "Class Consciousness üè∑Ô∏è UGC NET 2021",
                text: "What term does Marx use to describe a class that is aware of its own exploitation and organizes to fight for its interests?",
                options: ["Class-in-itself", "Class-for-itself", "Petite Bourgeoisie", "Lumpenproletariat"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: 'Class-in-itself' is a category of people sharing a common economic position but lacking awareness. It becomes a 'Class-for-itself' when they develop class consciousness and unite for political action.",
                    others: "Petite Bourgeoisie are small owners. Lumpenproletariat are the social scum/dropouts.",
                    trick: "PRO TIP: 'In' is just existing. 'For' is fighting FOR a cause."
                }
            },
            {
                topic: "Books üè∑Ô∏è CUET PG 2023",
                text: "Match the Marxist concepts with the works they primarily appear in:\n\nList I:\nA. Commodity Fetishism\nB. Alienation\nC. Ideology as Camera Obscura\n\nList II:\nI. The German Ideology\nII. Das Kapital\nIII. Economic and Philosophic Manuscripts of 1844",
                options: ["A-II, B-III, C-I", "A-I, B-II, C-III", "A-III, B-I, C-II", "A-II, B-I, C-III"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Commodity Fetishism is detailed in 'Das Kapital' (Vol 1). Alienation is the core theme of the '1844 Manuscripts'. The camera obscura metaphor for ideology appears in 'The German Ideology'.",
                    others: "Alienation is associated with the 'Young Marx' (1844), while Fetishism is 'Mature Marx' (Capital).",
                    trick: "PRO TIP: Fetishism = Capital (Money). Alienation = Manuscripts (Philosophy). Camera = Ideology."
                }
            },
            {
                topic: "Key Concepts üè∑Ô∏è JNU MA 2021",
                text: "The concept of 'Surplus Value' refers to:",
                options: ["The value of raw materials used in production", "The excess goods produced by a factory", "The difference between the value created by the worker and the wage they are paid", "The profit made by selling goods abroad"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Surplus value is the core of capitalist exploitation. It is the new value created by workers in excess of their own labor-cost (wages), which is appropriated by the capitalist as profit.",
                    others: "It is not about physical excess goods, but economic value extracted from unpaid labor time.",
                    trick: "PRO TIP: Surplus Value = Value Produced - Wages Paid."
                }
            },
            {
                topic: "Social Groups üè∑Ô∏è BHU PET 2018",
                text: "Which term did Marx use to describe the 'dangerous class' or the social scum, that is, the passively rotting mass thrown off by the lowest layers of old society?",
                options: ["Proletariat", "Bourgeoisie", "Lumpenproletariat", "Peasantry"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Lumpenproletariat (rag-proletariat) includes beggars, criminals, and vagrants who are outside the production process and often reactionary or available as bribed tools of reactionary intrigue.",
                    others: "Proletariat are the workers. Peasantry are rural farmers.",
                    trick: "PRO TIP: Lumpen = Lumps/Rags/Scum."
                }
            },
            {
                topic: "Methodology üè∑Ô∏è UGC NET 2020",
                text: "Marx turned Hegel's dialectic 'right side up'. What does this mean?",
                options: ["He prioritized ideas over matter", "He prioritized material conditions over ideas", "He rejected the concept of conflict", "He supported the Prussian state"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Hegel was an idealist (Spirit drives history). Marx was a materialist. Marx argued that it is not the consciousness of men that determines their being, but their social being that determines their consciousness (Historical Materialism).",
                    others: "Prioritizing ideas is Hegelian. Marx rejected the state as a tool of class rule.",
                    trick: "PRO TIP: Hegel = Head (Ideas). Marx = Material (Matter)."
                }
            },
            {
                topic: "Political Economy üè∑Ô∏è CUET PG 2022",
                text: "According to Marx, what is 'Commodity Fetishism'?",
                options: ["A sexual obsession with goods", "Social relations between people appearing as economic relations between things", "The worship of money in religious temples", "The desire to hoard commodities during a crisis"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Commodity Fetishism occurs when the social labor relations between producers are hidden, making the value of goods appear as an inherent property of the 'things' (commodities) themselves, rather than a result of human labor.",
                    others: "It is not a psychological or sexual fetish, but a sociological mystification of social relations.",
                    trick: "PRO TIP: People relations look like Thing relations."
                }
            },
            {
                topic: "Quotes üè∑Ô∏è DU MA 2021",
                text: "Who said: 'The philosophers have only interpreted the world, in various ways; the point is to change it'?",
                options: ["Friedrich Engels", "G.W.F. Hegel", "Karl Marx", "Max Weber"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: This is the famous 11th Thesis from Marx's 'Theses on Feuerbach' (1845). It emphasizes Praxis‚Äîthe combination of theory and revolutionary action.",
                    others: "Engels co-authored many works, but this specific thesis is attributed to Marx.",
                    trick: "PRO TIP: Interpret vs Change = Theses on Feuerbach (Marx)."
                }
            },
            {
                topic: "Class Theory üè∑Ô∏è UGC NET 2019",
                text: "Which class owns the 'means of production' in a capitalist society?",
                options: ["Proletariat", "Bourgeoisie", "Aristocracy", "Serfs"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Bourgeoisie (capitalist class) owns the means of production (factories, land, capital). The Proletariat (working class) owns only their labor power.",
                    others: "Aristocracy owned land in Feudalism. Serfs were bound to that land.",
                    trick: "PRO TIP: Bourgeoisie = Bosses/Owners."
                }
            },
            {
                topic: "Ideology üè∑Ô∏è JNU MA 2023",
                text: "Marx described religion as the '_______ of the people'.",
                options: ["Soul", "Opium", "Liberator", "Conscience"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: In 'Contribution to the Critique of Hegel's Philosophy of Right', Marx calls religion the 'opium of the people'. It provides temporary pain relief from the suffering of capitalism but prevents them from seeing the real cause of their misery.",
                    others: "He did call it the 'soul of soulless conditions', but 'opium' is the most famous descriptor of its function.",
                    trick: "PRO TIP: Religion = Opium (Painkiller for social misery)."
                }
            },
            {
                topic: "Labor Theory üè∑Ô∏è SET 2018",
                text: "The value of a commodity, according to Marx, is determined by:",
                options: ["Supply and demand", "The utility of the object", "The socially necessary labor time required to produce it", "The price set by the capitalist"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: This is the Labor Theory of Value. The value is objective and based on the average time required to produce the item under normal conditions (Socially Necessary Labor Time).",
                    others: "Supply and demand affect price, not value. Utility refers to use-value.",
                    trick: "PRO TIP: Value = Time (Labor Time)."
                }
            },
            {
                topic: "Concepts üè∑Ô∏è CUET PG 2022",
                text: "What is 'False Consciousness'?",
                options: ["A psychological disorder found in workers", "The inability of the working class to perceive their true class interests due to ideology", "Lying to the factory owner about work hours", "A state of dreaming described by Freud"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: False consciousness describes how the subordinate class adopts the ideology of the ruling class, leading them to act against their own material interests (e.g., believing capitalism is fair).",
                    others: "It is a sociological concept, not a clinical psychological disorder.",
                    trick: "PRO TIP: Thinking like the boss when you are the worker."
                }
            },
            {
                topic: "Transition üè∑Ô∏è UGC NET 2022",
                text: "What is the transitional phase between Capitalism and Communism called?",
                options: ["Social Democracy", "Dictatorship of the Proletariat", "Welfare State", "Anarchy"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Marx argued that after the revolution, the proletariat must seize state power to dismantle the bourgeoisie's resistance and socialize the means of production. This interim state is the Dictatorship of the Proletariat.",
                    others: "Welfare state is a capitalist compromise. Anarchy implies no state immediately.",
                    trick: "PRO TIP: Dictatorship OF the workers, not OVER them (theoretically)."
                }
            },
            {
                topic: "Capitalism üè∑Ô∏è JNU MA 2019",
                text: "The 'Cash Nexus' refers to:",
                options: ["The stock market connections", "The reduction of all human relationships to monetary exchange", "A bank robbery technique", "International trade agreements"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: In the Communist Manifesto, Marx and Engels state that the bourgeoisie has torn away the sentimental veil from the family and reduced family relations to mere money relations (the cash nexus).",
                    others: "It is about social relationships, not banking or stocks.",
                    trick: "PRO TIP: Nexus = Connection. Cash Nexus = Money connecting people."
                }
            },
            {
                topic: "Works üè∑Ô∏è CUET PG 2023",
                text: "Which of the following books was written by Friedrich Engels, which heavily influenced Marx's later views on gender and family?",
                options: ["The Condition of the Working Class in England", "The Origin of the Family, Private Property and the State", "Anti-Duhring", "Socialism: Utopian and Scientific"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: 'The Origin of the Family, Private Property and the State' (1884) links the oppression of women to the rise of private property and class society.",
                    others: "The Condition of the Working Class was Engels' early work on industrial misery.",
                    trick: "PRO TIP: Origin of Family = Engels (Gender & Property)."
                }
            },
            {
                topic: "Marxist Terms üè∑Ô∏è GATE 2021",
                text: "The 'Petite Bourgeoisie' refers to:",
                options: ["The very rich capitalists", "The small business owners and shopkeepers", "The industrial workers", "The aristocracy"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Petite Bourgeoisie are small-scale capitalists (shopkeepers, artisans) who own some means of production but often rely on their own labor. They are caught between the two major classes.",
                    others: "Very rich are Haute Bourgeoisie. Workers are Proletariat.",
                    trick: "PRO TIP: Petite = Small. Small Owners."
                }
            },
            {
                topic: "Dialectics üè∑Ô∏è UGC NET 2020",
                text: "Which of the following is NOT a law of Dialectical Materialism (later formalized by Engels)?",
                options: ["Law of the unity and conflict of opposites", "Law of the passage of quantitative changes into qualitative changes", "Law of natural selection", "Law of the negation of the negation"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The three laws of dialectics are: 1. Unity/Conflict of opposites, 2. Quantity to Quality, 3. Negation of the Negation. Natural selection is Darwin's biological theory.",
                    others: "Marx admired Darwin, but Natural Selection is not a law of dialectical materialism.",
                    trick: "PRO TIP: Dialectics is about change/opposites, not biological selection."
                }
            },
            {
                topic: "Economics üè∑Ô∏è DU MA 2020",
                text: "The 'Organic Composition of Capital' refers to the ratio between:",
                options: ["Constant Capital and Variable Capital", "Profit and Wages", "Land and Labor", "Imports and Exports"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: It is the ratio of Constant Capital (machinery, raw materials - 'dead labor') to Variable Capital (wages/labor power - 'living labor'). As capitalism advances, constant capital tends to increase relative to variable capital.",
                    others: "Profit and wages are outcomes, not the composition of capital investment.",
                    trick: "PRO TIP: C/V (Constant over Variable)."
                }
            },
            {
                topic: "History üè∑Ô∏è CUET PG 2021",
                text: "The process by which the peasantry was dispossessed of their land to create a landless proletariat is called:",
                options: ["Primitive Accumulation", "Socialist Accumulation", "Feudal Reaction", "Industrial Expansion"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Primitive Accumulation (or original accumulation) is the historical process of divorcing the producer from the means of production (e.g., The Enclosure Acts in England).",
                    others: "It is the 'bloody' pre-history of capitalism.",
                    trick: "PRO TIP: Primitive = The start/origin of capitalist wealth (theft of land)."
                }
            },
            {
                topic: "Collaborators üè∑Ô∏è BHU PET 2019",
                text: "Who was Karl Marx's lifelong intellectual partner and benefactor?",
                options: ["Max Weber", "Friedrich Engels", "Vladimir Lenin", "Emile Durkheim"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Friedrich Engels co-authored the Manifesto, edited Capital Vols 2 & 3 after Marx's death, and supported Marx financially.",
                    others: "Weber and Durkheim are the other 'founding fathers' but were not Marx's partners.",
                    trick: "PRO TIP: Marx & Engels = The Dynamic Duo."
                }
            },
            {
                topic: "Concepts üè∑Ô∏è UGC NET 2018",
                text: "The difference between 'Use Value' and 'Exchange Value' is fundamental to Marx's analysis of:",
                options: ["The Commodity", "The Family", "The State", "Religion"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: A commodity has a Use Value (utility/need satisfaction) and an Exchange Value (what it trades for/price). Capitalism prioritizes Exchange Value.",
                    others: "The analysis starts with 'The Commodity' as the cell-form of capitalist society.",
                    trick: "PRO TIP: Use = Utility. Exchange = Money. Both = Commodity."
                }
            },
            {
                topic: "Modes of Production üè∑Ô∏è JNU MA 2018",
                text: "Which Mode of Production did Marx characterize by the 'Asiatic' form, involving strong state control and lack of private land ownership?",
                options: ["Asiatic Mode of Production", "Oriental Despotism", "Feudalism", "Ancient Society"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The AMP (Asiatic Mode of Production) was a controversial concept where Marx suggested Asian societies (India/China) had self-sufficient villages and a despotic state that managed public works (irrigation), preventing the rise of private property.",
                    others: "Oriental Despotism is a related term (Wittfogel) but AMP is Marx's specific category.",
                    trick: "PRO TIP: AMP = Irrigation + Despotic State."
                }
            },
            {
                topic: "Structure üè∑Ô∏è CUET PG 2023",
                text: "'Men make their own history, but they do not make it as they please; they do not make it under self-selected circumstances.' This quote is from:",
                options: ["The 18th Brumaire of Louis Bonaparte", "The Communist Manifesto", "Das Kapital", "The Civil War in France"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: This famous opening line of 'The 18th Brumaire of Louis Bonaparte' (1852) highlights the balance between human agency and structural constraints.",
                    others: "It discusses the coup of Napoleon III.",
                    trick: "PRO TIP: History + Agency + Constraint = 18th Brumaire."
                }
            },
            {
                topic: "Crisis üè∑Ô∏è UGC NET 2021",
                text: "Marx predicted that capitalism would eventually collapse due to:",
                options: ["External invasion", "Internal contradictions (e.g., overproduction)", "Religious revival", "Resource depletion"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Marx argued capitalism has internal contradictions, such as the tendency of the rate of profit to fall and crises of overproduction, leading to revolutionary situations.",
                    others: "It is an internal structural failure, not external.",
                    trick: "PRO TIP: Capitalism digs its own grave (Internal Contradiction)."
                }
            },
            {
                topic: "Neo-Marxism üè∑Ô∏è DU MA 2022",
                text: "Which scholar distinguished between the 'Young Marx' (Humanist) and the 'Mature Marx' (Scientific)?",
                options: ["Antonio Gramsci", "Louis Althusser", "Georg Lukacs", "Theodor Adorno"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Louis Althusser (Structural Marxist) argued for an 'Epistemological Break' between the early philosophical/humanist Marx (1844) and the later scientific Marx (Capital).",
                    others: "Gramsci focused on Hegemony. Lukacs on Reification.",
                    trick: "PRO TIP: Althusser = The Break (Young vs Old)."
                }
            },
            {
                topic: "Labor üè∑Ô∏è CUET PG 2022",
                text: "What does Marx mean by 'Variable Capital'?",
                options: ["Machinery that varies in speed", "Raw materials that spoil", "Capital invested in wages/labor power", "Stocks and bonds"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Variable Capital (v) is the money spent on hiring workers. It is 'variable' because labor power is the only commodity that creates *new* value (surplus) greater than its own cost.",
                    others: "Machinery is Constant Capital (c) because it only transfers its existing value to the product.",
                    trick: "PRO TIP: Variable = Living Labor (Creates value)."
                }
            },
            {
                topic: "Concept üè∑Ô∏è JNU MA 2021",
                text: "The concept of 'Reification' (making social relations into things), closely related to Commodity Fetishism, was further developed by:",
                options: ["Georg Lukacs", "Karl Marx", "Engels", "Lenin"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: While Marx described the phenomenon (fetishism), Georg Lukacs explicitly developed the concept of 'Reification' in 'History and Class Consciousness' (1923).",
                    others: "Marx laid the groundwork, Lukacs coined the specific term/theory in Western Marxism.",
                    trick: "PRO TIP: Reification = Lukacs."
                }
            },
            {
                topic: "State üè∑Ô∏è UGC NET 2019",
                text: "In the Communist Manifesto, the executive of the modern state is described as:",
                options: ["A neutral arbiter of justice", "A committee for managing the common affairs of the whole bourgeoisie", "The protector of the poor", "A divine institution"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Marx famously viewed the State not as neutral, but as a tool of class rule: 'The executive of the modern state is but a committee for managing the common affairs of the whole bourgeoisie.'",
                    others: "The state serves the dominant class (Bourgeoisie), not the poor or justice.",
                    trick: "PRO TIP: State = Committee for the Rich."
                }
            },
            {
                topic: "Evolution üè∑Ô∏è SET 2017",
                text: "Who influenced Marx's materialism, specifically the shift from Hegelian idealism?",
                options: ["Immanuel Kant", "Ludwig Feuerbach", "Adam Smith", "David Ricardo"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Ludwig Feuerbach's materialism (The Essence of Christianity) criticized Hegel's idealism. Marx adopted Feuerbach's materialism but criticized his lack of dialectics/politics.",
                    others: "Smith and Ricardo influenced Marx's economics, not his shift to materialism.",
                    trick: "PRO TIP: Feuerbach = The Bridge (Hegel -> Marx)."
                }
            },
            {
                topic: "Wages üè∑Ô∏è CUET PG 2023",
                text: "According to Marx, the 'Iron Law of Wages' suggests that under capitalism:",
                options: ["Wages will always rise", "Wages tend to gravitate towards the minimum subsistence level", "Wages are determined by the government", "Wages are equal for everyone"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: While the term 'Iron Law' is Lassallean, Marx agreed that the reserve army of labor (unemployed) keeps wages down to the level required for the worker to survive and reproduce (Subsistence).",
                    others: "Capitalism pushes wages down, not up.",
                    trick: "PRO TIP: Wages = Subsistence (Just enough to survive)."
                }
            },
            {
                topic: "Economy üè∑Ô∏è JNU MA 2022",
                text: "The 'Reserve Army of Labour' refers to:",
                options: ["The military forces", "The unemployed and underemployed", "Retired workers", "Child laborers"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Reserve Army of Labour acts as a regulator for wages. When demand is high, they are hired; when low, fired. Their existence ensures employed workers can't demand too much pay (fear of replacement).",
                    others: "It refers to the pool of available workers, not soldiers.",
                    trick: "PRO TIP: Reserve Army = The Unemployed (waiting to work)."
                }
            },
            {
                topic: "Alienation üè∑Ô∏è UGC NET 2020",
                text: "In the state of alienation, the worker's labor becomes:",
                options: ["A source of joy", "An external, forced activity", "A creative expression", "A hobby"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Marx argues that under capitalism, labor is external to the worker. It is not voluntary, but forced labor (coerced by the need to eat). The worker feels at home only when he is not working.",
                    others: "Creative expression is 'Species-being', which is lost in alienation.",
                    trick: "PRO TIP: Work feels like a prison, not a passion."
                }
            },

        ];

        /* --- LOGIC ENGINE --- */
        const MAX_ATTEMPTS = 5;
        const SECONDS_PER_QUESTION = 72;
        const STORAGE_KEY = 'Karl Marx';

        // --- SECURITY CONFIGURATION ---
        // 1. PASTE YOUR GOOGLE SCRIPT URL HERE:
        // 1. PASTE YOUR GOOGLE SCRIPT URL HERE (From your Deployment):
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbye1nUUxpxcbMLQrby3tvyCD043fz6twdCZhueU04ZRsaLdiuX7c-Q3jaivpJf-vuL2/exec";

        // 2. UNIQUE NAME FOR THIS SPECIFIC TEST (Demand #3)
        // Change this string for every new HTML file you create (e.g., "History_2025", "Mock_01")
        const TEST_ID = "Karl Marx";

        // 3. ALLOWED USERS (Optional, since you are using Razorpay automation)
        const ALLOWED_USERS = ["1111", "2025", "9999", "STUDENT1"];

        // ------------------------------
        let globalCloudData = [];
        let responses = new Array(questions.length).fill(null);
        let status = new Array(questions.length).fill(0);
        let timeLeft = 0;
        let timerRef;
        let userName = "Student";
        let history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let isMobile = false;

        // Initialize
        // --- 1. NEW SETUP & VISUALS ---
        let typingTimer;

        // --- 1. NEW WINDOW.ONLOAD (Includes "SocioLogic" Hint) ---
        window.onload = function () {
            if (window.innerWidth < 768) setMode('mobile');
            else setMode('desktop');

            document.getElementById('timer').innerText = "00:00:00";

            // Add Listeners
            document.getElementById('candidateName').addEventListener('input', checkStartConditions);
            document.getElementById('username').addEventListener('keyup', handleIdInput);

            // --- AUTO-SHOW HINT FOR FREE TESTS ---
            if (typeof TEST_ID !== 'undefined' && TEST_ID.toUpperCase().startsWith("FREE")) {
                const idInput = document.getElementById('username');

                // 1. Change Placeholder
                idInput.placeholder = "Enter ID: SocioLogic";

                // 2. Insert Hint Text
                const hintDiv = document.createElement("div");
                hintDiv.innerHTML = "üí° <b>Guest Access:</b> Type <span style='color:#2563eb; font-weight:800;'>SocioLogic</span> as your ID.";
                hintDiv.style.fontSize = "0.85rem";
                hintDiv.style.color = "#64748b";
                hintDiv.style.marginTop = "-10px";
                hintDiv.style.marginBottom = "15px";
                hintDiv.style.background = "#eff6ff";
                hintDiv.style.padding = "8px";
                hintDiv.style.borderRadius = "8px";
                hintDiv.style.border = "1px dashed #bfdbfe";

                // Insert it right after the input box
                idInput.parentNode.insertBefore(hintDiv, idInput.nextSibling);
            }
        };

        // --- 2. KEEP THIS FUNCTION (Do not delete!) ---
        function setMode(mode) {
            isMobile = (mode === 'mobile');
            const dBtn = document.getElementById('btn-desktop');
            const mBtn = document.getElementById('btn-mobile');

            // Safety check in case buttons don't exist yet
            if (dBtn && mBtn) {
                dBtn.className = isMobile ? 'mode-btn' : 'mode-btn active';
                mBtn.className = isMobile ? 'mode-btn active' : 'mode-btn';
            }
        }



        let checkTimer;

        function handleIdInput() {
            const idVal = document.getElementById('username').value.trim();
            const badge = document.getElementById('attempt-badge');
            const btn = document.getElementById('start-btn');

            // 1. Disable Button while typing
            btn.disabled = true;
            btn.style.backgroundColor = "#cbd5e1";
            btn.innerText = "Enter Details to Start";
            btn.style.cursor = "not-allowed";

            clearTimeout(checkTimer);

            // 2. Basic Validation
            if (idVal.length < 4) {
                badge.innerHTML = "Waiting for 4-digit ID...";
                badge.style.background = "#f1f5f9";
                badge.style.color = "#64748b";
                badge.style.borderColor = "#e2e8f0";
                return;
            }

            // 3. Show "Checking..."
            badge.innerHTML = "üîÑ Checking Records...";
            badge.style.background = "#fffbeb";
            badge.style.color = "#d97706";

            checkTimer = setTimeout(() => {
                fetch(SCRIPT_URL + "?type=check&id=" + encodeURIComponent(idVal) + "&test=" + encodeURIComponent(TEST_ID))
                    .then(response => response.text())
                    .then(countText => {
                        // A. Check for Block
                        if (countText.includes("BLOCK_NOT_PAID")) {
                            badge.innerHTML = `‚õî <b>Access Denied: ID not found in Paid List.</b>`;
                            badge.style.background = "#fee2e2";
                            badge.style.color = "#b91c1c";
                            badge.style.borderColor = "#fecaca";
                            return;
                        }

                        // --- B. MAGIC FIX: If Test is FREE, Ignore Limits! ---
                        if (typeof TEST_ID !== 'undefined' && TEST_ID.toUpperCase().startsWith("FREE")) {
                            badge.innerHTML = `‚úÖ <b>Free Access:</b> Unlimited Attempts Allowed`;
                            badge.style.background = "#dcfce7";
                            badge.style.color = "#15803d";
                            badge.style.borderColor = "#86efac";

                            checkStartConditions(); // Unlock immediately
                            return;
                        }
                        // ---------------------------------------------------

                        // C. Normal Logic for Paid Tests
                        const used = parseInt(countText) || 0;
                        const max = 5;
                        const remaining = max - used;

                        if (used >= max) {
                            badge.innerHTML = `‚õî <b>Total: ${max} | Exhausted: ${used} | Remaining: 0</b>`;
                            badge.style.background = "#fee2e2";
                            badge.style.color = "#b91c1c";
                            badge.style.borderColor = "#fecaca";
                        } else {
                            badge.innerHTML = `‚úÖ <b>Total: ${max} | Exhausted: ${used} | Remaining: ${remaining}</b>`;
                            badge.style.background = "#dcfce7";
                            badge.style.color = "#15803d";
                            badge.style.borderColor = "#86efac";
                            checkStartConditions();
                        }
                    })
                    .catch(err => {
                        badge.innerHTML = "‚ùå Connection Error.";
                    });
            }, 800);
        }
        function calculateAndShowAttempts() {
            const idVal = document.getElementById('username').value.trim();
            // Filters history to only count items belonging to the ID entered
            const attemptsUsed = history.filter(rec => rec.userID === idVal).length;

            const attemptsLeft = MAX_ATTEMPTS - attemptsUsed;
            const badge = document.getElementById('attempt-badge');

            if (attemptsUsed >= MAX_ATTEMPTS) {
                badge.innerHTML = `‚ö†Ô∏è <b>Attempts Exhausted</b> (0 remaining)`;
                badge.style.color = "#ef4444";
                badge.style.background = "#fee2e2";
                badge.style.borderColor = "#fecaca";
            } else {
                badge.innerHTML = `‚úÖ <b>Attempt #${attemptsUsed + 1}</b> (${attemptsLeft} remaining)`;
                badge.style.color = "#15803d";
                badge.style.background = "#dcfce7";
                badge.style.borderColor = "#86efac";
            }
            checkStartConditions();
        }

        function checkStartConditions() {
            const name = document.getElementById('candidateName').value.trim();
            const id = document.getElementById('username').value.trim();
            const badgeText = document.getElementById('attempt-badge').innerText;
            const btn = document.getElementById('start-btn');

            // Replace the old "const isBadgeValid = ..." line with this:
            const isBadgeValid = (badgeText.includes("Remaining") || badgeText.includes("Unlimited") || badgeText.includes("Attempt")) && !badgeText.includes("Remaining: 0");
            if (name.length > 0 && id.length >= 4 && isBadgeValid) {
                btn.disabled = false;
                btn.style.backgroundColor = "#2563eb";
                btn.style.cursor = "pointer";
                btn.innerText = "Start Examination ‚ûú";
            }
        }

        // --- 2. THE SECURITY GATEKEEPER (The "Start" Click) ---
        function startTest() {
            const nameInput = document.getElementById('candidateName');
            const idInput = document.getElementById('username');
            const startBtn = document.getElementById('start-btn');

            const nameVal = nameInput.value.trim();
            const idVal = idInput.value.trim();

            // Double Check
            if (!nameVal || !idVal) return;

            // UI Loading
            startBtn.disabled = true;
            startBtn.innerText = "Verifying Access...";

            // SERVER CHECK (Blocks Random IDs)
            const requestUrl = SCRIPT_URL + "?id=" + encodeURIComponent(idVal) +
                "&name=" + encodeURIComponent(nameVal) +
                "&test=" + encodeURIComponent(TEST_ID);

            fetch(requestUrl)
                .then(response => response.text())
                .then(data => {
                    if (data === "ALLOW") {
                        // SUCCESS: User is Paid & Valid
                        userName = nameVal;
                        document.getElementById('nav-user').innerText = userName;

                        document.getElementById('welcome-screen').style.display = 'none';
                        document.getElementById('app-wrapper').style.display = 'flex';

                        // Mobile Setup
                        if (isMobile) {
                            document.body.classList.add('mobile-mode');
                            document.getElementById('mob-menu').style.display = 'block';
                            document.getElementById('mob-close-sb').style.display = 'block';
                            document.getElementById('btn-next').innerText = "Next ‚ûú";
                            document.getElementById('btn-review').innerText = "Review";
                        } else {
                            document.body.classList.remove('mobile-mode');
                            document.getElementById('mob-menu').style.display = 'none';
                            document.getElementById('mob-close-sb').style.display = 'none';
                            document.getElementById('btn-next').innerText = "Save & Next ‚ûú";
                            document.getElementById('btn-review').innerText = "üö© Review";
                        }

                        current = 0;
                        responses = new Array(questions.length).fill(null);
                        status = new Array(questions.length).fill(0);
                        timeLeft = questions.length * SECONDS_PER_QUESTION;

                        initTest();
                    } else if (data === "BLOCK_NOT_PAID") {
                        // BLOCKS RANDOM USERS
                        alert("‚õî ACCESS DENIED: ID '" + idVal + "' not found. Please buy access first.");
                        startBtn.disabled = false;
                        startBtn.innerText = "Start Examination ‚ûú";
                    } else {
                        // BLOCKS LIMIT EXCEEDED
                        alert("‚ö†Ô∏è LIMIT REACHED: ID '" + idVal + "' has used all 5 attempts.");
                        startBtn.disabled = false;
                        startBtn.innerText = "Start Examination ‚ûú";
                    }
                })
                .catch(error => {
                    alert("‚ùå CONNECTION ERROR: Unable to verify. Check internet.");
                    startBtn.disabled = false;
                    startBtn.innerText = "Start Examination ‚ûú";
                });
        }
        function initTest() {
            renderQ(0);
            renderPalette();
            updateTimerDisplay();

            clearInterval(timerRef);
            timerRef = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) finishTest();
            }, 1000);
        }

        function updateTimerDisplay() {
            let h = Math.floor(timeLeft / 3600).toString().padStart(2, '0');
            let m = Math.floor((timeLeft % 3600) / 60).toString().padStart(2, '0');
            let s = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${h}:${m}:${s}`;
        }

        function renderQ(idx) {
            current = idx;
            const q = questions[idx];
            if (status[idx] === 0) { status[idx] = 1; renderPalette(); }

            const optionsHtml = q.options.map((opt, i) => {
                const isSelected = responses[idx] === i;
                const isMarkedReview = (status[idx] === 4 && isSelected);
                let cls = 'option';
                if (isMarkedReview) cls += ' review-marked selected';
                else if (isSelected) cls += ' selected';

                return `
            <div class="${cls}" onclick="selectOpt(${i})">
                <div class="opt-key">${String.fromCharCode(65 + i)}</div>
                <div style="flex:1">${opt}</div>
            </div>`;
            }).join('');

            document.getElementById('q-panel').innerHTML = `
            <div class="q-header">
                <span class="topic-tag">${q.topic}</span>
                <span class="q-counter">Q.${idx + 1} / ${questions.length}</span>
            </div>
            <div class="q-text">${q.text}</div>
            <div>${optionsHtml}</div>
        `;
        }

        function selectOpt(i) {
            responses[current] = i;
            status[current] = (status[current] === 3 || status[current] === 4) ? 4 : 2;
            renderQ(current);
            renderPalette();
        }

        function nav(d) {
            const next = current + d;
            if (next >= 0 && next < questions.length) renderQ(next);
        }

        function renderPalette() {
            document.getElementById('palette').innerHTML = questions.map((_, i) => {
                let cls = 'grid-btn';
                if (i === current) cls += ' st-curr';
                if (status[i] === 2) cls += ' st-ans';
                else if (status[i] === 3) cls += ' st-rev';
                else if (status[i] === 4) cls += ' st-ans-rev';
                return `<div class="${cls}" onclick="renderQ(${i})">${i + 1}</div>`;
            }).join('');
        }

        function markReview() {
            status[current] = responses[current] !== null ? 4 : 3;
            renderQ(current);
            renderPalette();
            nav(1);
        }

        function clearResp() {
            responses[current] = null;
            status[current] = 1;
            renderQ(current);
            renderPalette();
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

        /* --- NEW HISTORY LOGIC --- */
        function openHistory() {
            const list = document.getElementById('history-list');
            const currentID = document.getElementById('username').value.trim();

            if (currentID.length < 4) { alert("Please enter your ID first."); return; }

            // Show loading state (Matches your existing CSS)
            list.innerHTML = `<div style="text-align:center; padding:20px; color:#64748b;">üîÑ Syncing with Cloud...</div>`;
            document.getElementById('history-modal').style.display = 'flex';

            // Fetch from Cloud
            fetch(SCRIPT_URL + "?type=history&id=" + encodeURIComponent(currentID))
                .then(res => res.json())
                .then(cloudData => {
                    globalCloudData = cloudData;
                    list.innerHTML = "";

                    if (cloudData.length === 0) {
                        list.innerHTML = `<div class="hist-empty">No records found for ID: <b>${currentID}</b></div>`;
                    } else {
                        // Render List (Using your EXACT existing CSS classes)
                        cloudData.forEach((rec, i) => {
                            list.innerHTML += `
                                <div class="hist-item" onclick="loadCloudAttempt(${i})">
                                    <div class="h-left">
                                        <span class="h-title">${rec.test}</span>
                                        <span class="h-date">üìÖ ${rec.date}</span>
                                    </div>
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <div class="h-score-badge">${rec.score}</div>
                                        <span style="color:#cbd5e1;">‚ûú</span>
                                    </div>
                                </div>`;
                        });
                    }
                })
                .catch(err => {
                    list.innerHTML = `<div class="hist-empty" style="color:#ef4444">‚ùå Connection Error.</div>`;
                });
        }
        function loadCloudAttempt(index) {
            const rec = globalCloudData[index];
            if (!rec || !rec.resp) {
                alert("Detailed data not available for this attempt.");
                return;
            }

            // Convert cloud data back to local format
            const parsedResponses = rec.resp.split(',').map(val => val === 'N' ? null : parseInt(val));

            const fullRecord = {
                date: rec.date,
                userID: document.getElementById('username').value,
                userResponses: parsedResponses
            };

            // Re-use your existing Result Screen renderer
            renderResultScreen(fullRecord);
            closeHistory();
        }

        // Helper to find the right record when clicked in history
        function reviewAttemptFromHistory(dateId) {
            const record = history.find(r => r.date === dateId);
            if (record) {
                renderResultScreen(record);
                closeHistory();
            }
        }

        function closeHistory() { document.getElementById('history-modal').style.display = 'none'; }
        function reviewAttempt(index) { renderResultScreen(history[index]); closeHistory(); }

        /* --- RESULTS --- */
        function finishTest() {
            clearInterval(timerRef);
            let score = 0, cor = 0, wro = 0;
            responses.forEach((ans, i) => {
                if (ans === questions[i].correct) { score += 4; cor++; }
                else if (ans !== null) { score -= 1; wro++; }
            });

            // 1. Prepare Data
            const finalScore = score + " / " + (questions.length * 4);
            const uName = document.getElementById('candidateName').value.trim();
            const uID = document.getElementById('username').value.trim();

            // Create answer string (e.g. "1,0,N,2")
            const respString = responses.map(r => r === null ? 'N' : r).join(',');

            // 2. SEND TO CLOUD (Silent Backup)
            // This is the ONLY new part. It happens in the background.
            fetch(SCRIPT_URL + "?type=submit&id=" + encodeURIComponent(uID) +
                "&name=" + encodeURIComponent(uName) +
                "&test=" + encodeURIComponent(TEST_ID) +
                "&score=" + encodeURIComponent(finalScore) +
                "&resp=" + encodeURIComponent(respString));

            // 3. Save Locally & Show Result (Your existing logic)
            const record = {
                date: new Date().toLocaleString(),
                userID: uID,
                score: score,
                correct: cor,
                wrong: wro,
                userResponses: [...responses]
            };
            history.push(record);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
            renderResultScreen(record);
        }
        function renderResultScreen(data) {
            // --- SAFETY FIX: Re-calculate stats in case old records miss them ---
            // This ensures even old history opens perfectly.
            let calculatedScore = 0;
            let calculatedCorrect = 0;
            let calculatedWrong = 0;
            let calculatedAtt = 0;

            // Check if userResponses exists (Legacy support)
            const responsesToUse = data.userResponses || new Array(questions.length).fill(null);

            questions.forEach((q, i) => {
                const ans = responsesToUse[i];
                if (ans !== null && ans !== undefined) {
                    calculatedAtt++;
                    if (ans === q.correct) {
                        calculatedScore += 4;
                        calculatedCorrect++;
                    } else {
                        calculatedScore -= 1;
                        calculatedWrong++;
                    }
                }
            });
            // -------------------------------------------------------

            // 1. Calculate Stats
            const totalQ = questions.length;
            const maxMarks = totalQ * 4;

            // 2. Push to HTML (The Score Grid)
            // We check if elements exist before setting them to prevent errors
            if (document.getElementById('disp-att')) document.getElementById('disp-att').innerText = `${calculatedAtt} / ${totalQ}`;
            if (document.getElementById('disp-cor')) document.getElementById('disp-cor').innerText = calculatedCorrect;
            if (document.getElementById('disp-wro')) document.getElementById('disp-wro').innerText = calculatedWrong;
            if (document.getElementById('disp-score')) document.getElementById('disp-score').innerText = `${calculatedScore} / ${maxMarks}`;

            // 3. Switch Screens
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('result-overlay').style.display = 'flex';

            // 4. Generate Detailed List
            let topicData = {};
            const html = questions.map((q, i) => {
                const userAns = responsesToUse[i];
                const isCor = userAns === q.correct;

                if (!topicData[q.topic]) topicData[q.topic] = { total: 0, cor: 0 };
                topicData[q.topic].total++;
                if (isCor) topicData[q.topic].cor++;

                let statIcon = isCor ? '<span class="txt-green">‚úì Correct</span>' : (userAns !== null && userAns !== undefined ? '<span class="txt-red">‚úï Incorrect</span>' : '<span>‚óã Skipped</span>');
                let rowCls = isCor ? 'correct' : (userAns !== null && userAns !== undefined ? 'wrong' : '');

                const optionsList = q.options.map((opt, idx) => {
                    let style = "padding:8px 12px; border-radius:8px; margin-bottom:5px; display:flex; line-height:1.4; border:1px solid #e2e8f0; background:#f8fafc; color:#64748b;";
                    let prefix = `<b style="min-width:25px;">${String.fromCharCode(65 + idx)}.</b>`;
                    if (idx === q.correct) style = "padding:8px 12px; border-radius:8px; margin-bottom:5px; display:flex; line-height:1.4; border:1px solid #bbf7d0; background:#dcfce7; color:#166534; font-weight:600;";
                    else if (idx === userAns && !isCor) style = "padding:8px 12px; border-radius:8px; margin-bottom:5px; display:flex; line-height:1.4; border:1px solid #fecaca; background:#fee2e2; color:#991b1b; font-weight:600;";
                    return `<div style="${style}">${prefix} <span>${opt}</span></div>`;
                }).join('');

                return `
            <div class="exp-row ${rowCls}">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:700;">
                    <span style="color:#64748b; font-size:0.85rem">${q.topic}</span>${statIcon}
                </div>
                <div style="font-weight:600; margin-bottom:15px; font-size:1.1rem; color:#1e293b;">Q${i + 1}: ${q.text}</div>
                <div style="margin-bottom:20px; font-size:0.95rem;">${optionsList}</div>
                <div class="exp-detail">
                    <div class="why-box"><span class="txt-green" style="font-weight:700">‚úÖ Explanation:</span> ${q.expl.correct}</div>
                    <div class="why-box"><span class="txt-red" style="font-weight:700">‚ùå Error Analysis:</span> ${q.expl.others}</div>
                    <div style="background:#fffbeb; padding:10px; border-radius:8px; border:1px dashed #f59e0b; font-size:0.9rem; color:#92400e;">üí° <b>Trick:</b> ${q.expl.trick}</div>
                </div>
            </div>`;
            }).join('');

            document.getElementById('solution-feed').innerHTML = html;

            // 5. Update Weakness/Strength
            let best = { name: "N/A", acc: -1 }, worst = { name: "N/A", acc: 101 };
            for (const [t, d] of Object.entries(topicData)) {
                const acc = (d.cor / d.total) * 100;
                if (acc > best.acc) best = { name: t, acc: acc };
                if (acc < worst.acc) worst = { name: t, acc: acc };
            }
            if (best.acc === -1) { best = { name: "None", acc: 0 }; worst = { name: "None", acc: 0 }; }
            document.getElementById('area-strong').innerText = best.name;
            document.getElementById('area-weak').innerText = worst.name;
            document.getElementById('area-strong-stat').innerText = `Accuracy: ${Math.round(best.acc)}%`;
            document.getElementById('area-weak-stat').innerText = `Accuracy: ${Math.round(worst.acc)}%`;
        }

        function showThankYou() {
            document.getElementById('result-overlay').style.display = 'none';
            document.getElementById('ty-screen').style.display = 'flex';
        }
    </script>
    <style>
        /* 1. Global Select Protection (Stops Copying) */
        body {
            -webkit-user-select: none;
            /* Safari/Chrome */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* IE/Edge */
            user-select: none;
            /* Standard */

            /* MOBILE SPECIFIC: Stop Long-Press Menu */
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Allow typing in input boxes */
        input,
        textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            -webkit-touch-callout: default;
        }

        /* 2. Print Protection (Hides content on Ctrl+P) */
        @media print {
            body {
                display: none !important;
            }

            html::after {
                content: "Taking Screenshots or making PDF of the page is prohibited.";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #fff;
                color: #333;
                font-size: 2rem;
                font-weight: bold;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                text-align: center;
                border: 20px solid #d1d5db;
            }
        }

        /* 3. Blur Filter Class (Used by JS) */
        .blur-content {
            filter: blur(15px);
            pointer-events: none;
            user-select: none;
        }
    </style>

    <script>
        // 4. Block Right Click (Desktop) & Long Press (Mobile)
        document.addEventListener('contextmenu', event => event.preventDefault());

        // 5. Blur Screen on Tab Switch (Anti-Cheating)
        // Professional warning when user minimizes or switches tabs
        document.addEventListener("visibilitychange", function () {
            if (document.hidden) {
                document.body.classList.add("blur-content");
                document.title = "Taking Screenshots or making PDF of the page is prohibited.";
            } else {
                // Add a 0.5s delay punishment before un-blurring
                setTimeout(() => {
                    document.body.classList.remove("blur-content");
                    document.title = "Exam Session Active";
                }, 500);
            }
        });

        // 6. Desktop Keyboard Blocks
        document.addEventListener('keydown', function (e) {
            // Block F12 (DevTools), Ctrl+Shift+I, Ctrl+P (Print), Ctrl+S (Save)
            if (e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.key === 'p') ||
                (e.ctrlKey && e.key === 's')) {
                e.preventDefault();
                return false;
            }

            // Detect PrintScreen Key
            if (e.key === 'PrintScreen') {
                alert("System Warning: Screen capture is disabled. ");
                document.body.classList.add("blur-content");
                setTimeout(() => document.body.classList.remove("blur-content"), 3000); // Punish with 3s blur
            }
        });
    </script>

</body>

</html>