<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YOUR PYQ BATTLE</title>
    <style>
        :root {
            --brand-main: #2563eb;
            --brand-grad: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --bg-grad: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-light: #64748b;
            --success: #15803d;
            --danger: #b91c1c;
            --review: #7c3aed;
            --selected: #eff6ff;
            --radius: 16px;
            --shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-grad);
            color: var(--text-main);
            height: 100vh;
            height: 100dvh;
            /* Mobile Chrome Fix */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- 1. WELCOME SCREEN --- */
        #welcome-screen {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: white;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- UPDATED WELCOME SCREEN (Wider & Premium) --- */
        .welcome-card {
            background: white;
            width: 90%;
            /* Good for Mobile */
            max-width: 700px;
            /* Increased from 450px for Laptop (Wider look) */
            padding: 50px;
            /* More spacious "Grand" feel */
            border-radius: 24px;
            /* Softer corners */
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
            /* Deeper shadow */
            text-align: center;
            border: 1px solid #e2e8f0;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            /* Fixes layout alignment */
            flex-direction: column;
            align-items: center;
            /* Centers everything perfectly */
        }

        /* Ensure input fields don't stretch too ugly on the wide screen */
        .welcome-card .input-field {
            max-width: 500px;
            /* Keeps inputs looking neat */
            width: 100%;
        }

        /* Mobile Adjustment */
        @media(max-width: 600px) {
            .welcome-card {
                width: 95%;
                /* Maximize space on phone */
                padding: 30px 20px;
                /* Slightly tighter padding for small screens */
            }
        }

        .mode-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #64748b;
            font-weight: 600;
        }

        .mode-btn.active {
            border-color: #2563eb;
            background: #eff6ff;
            color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }

        /* --- SCORECARD GRID STYLES --- */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        .score-card-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            text-align: center;
        }

        .sc-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .sc-value {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1.1rem;
            outline: none;
            text-align: center;
            font-weight: 600;
            transition: 0.2s;
        }

        .input-field:focus {
            border-color: #2563eb;
        }

        #attempt-badge {
            display: inline-block;
            background: #fff7ed;
            color: #c2410c;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            border: 1px solid #ffedd5;
            margin-bottom: 20px;
        }

        /* --- 2. MAIN INTERFACE --- */
        #app-wrapper {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        /* Header */
        nav {
            background: var(--brand-grad);
            color: white;
            height: 64px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            z-index: 50;
            flex-shrink: 0;
        }

        .timer-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 8px;
            font-family: monospace;
            font-weight: 700;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
        }

        /* Main Area */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .main-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
        }

        .q-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            max-width: 900px;
            width: 100%;
            height: fit-content;
            border-top: 5px solid #2563eb;
            animation: slideUp 0.3s ease-out;
            margin-bottom: 40px;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .topic-tag {
            background: #eff6ff;
            color: #1e40af;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .q-text {
            font-size: 1.2rem;
            font-weight: 600;
            line-height: 1.6;
            color: var(--text-main);
            margin-bottom: 25px;
        }

        /* Options */
        .option {
            display: flex;
            align-items: flex-start;
            padding: 16px 20px;
            margin-bottom: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            line-height: 1.5;
        }

        .option:hover {
            border-color: #93c5fd;
            background: #f8fafc;
        }

        .option.selected {
            border-color: #2563eb;
            background: var(--selected);
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.1);
        }

        .option.selected .opt-key {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .option.review-marked {
            border-color: var(--review);
            background: #f5f3ff;
        }

        .option.review-marked .opt-key {
            background: var(--review);
            color: white;
            border-color: var(--review);
        }

        .opt-key {
            min-width: 32px;
            height: 32px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #64748b;
            margin-right: 15px;
            font-size: 0.9rem;
        }

        /* Sidebar (Desktop Default) */
        .sidebar {
            width: 340px;
            background: white;
            border-left: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            z-index: 40;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sb-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            overflow-y: auto;
            align-content: start;
        }

        .grid-btn {
            aspect-ratio: 1;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #64748b;
            background: white;
        }

        /* States */
        .st-curr {
            border-color: #2563eb;
            color: #2563eb;
            box-shadow: inset 0 0 0 2px #2563eb;
        }

        .st-ans {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .st-rev {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .st-ans-rev {
            background: var(--review);
            border-color: var(--review);
            color: white;
        }

        /* Footer */
        .footer-bar {
            height: 72px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 30;
            flex-shrink: 0;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            transition: 0.2s;
            white-space: nowrap;
        }

        .btn-pri {
            background: #1e40af;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.2);
        }

        .btn-sec {
            background: white;
            border: 2px solid #e2e8f0;
            color: #475569;
        }

        .btn-rev {
            background: #fffbeb;
            color: #b45309;
            border: 1px solid #fcd34d;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* --- PREMIUM MOBILE/TABLET ADAPTATION --- */
        /* Only activates when 'mobile-mode' class is on body */
        body.mobile-mode .sidebar {
            position: fixed;
            right: 0;
            top: 64px;
            bottom: 0;
            width: 85%;
            max-width: 320px;
            transform: translateX(100%);
            /* Hidden by default */
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.2);
        }

        body.mobile-mode .sidebar.active {
            transform: translateX(0);
        }

        /* Slide in */

        body.mobile-mode .main-area {
            padding: 15px;
        }

        body.mobile-mode .q-card {
            padding: 25px;
            border-radius: 12px;
        }

        /* Bigger Touch Targets for Mobile */
        body.mobile-mode .option {
            padding: 18px 15px;
            margin-bottom: 12px;
        }

        body.mobile-mode .btn {
            padding: 14px 18px;
            font-size: 1rem;
        }

        body.mobile-mode .footer-bar {
            height: 80px;
            padding: 0 15px;
        }

        /* Hide Text Labels on Mobile Footer if needed to fit */
        body.mobile-mode .btn-sec span {
            display: none;
        }

        body.mobile-mode .btn svg {
            display: block;
        }

        /* --- COMPACT RESULT CARD STYLES --- */
        /* --- UPDATED WIDTH FOR RESULT CARD --- */
        .res-card {
            background: #ffffff;
            width: 95%;
            /* Uses 95% screen width on Mobile */
            max-width: 900px;
            /* Increased from 500px to 900px for Laptop */
            max-height: 90vh;
            /* Keeps it fitting vertically */
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .res-header {
            background: var(--brand-grad);
            padding: 20px;
            /* Reduced padding */
            text-align: center;
            color: white;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .res-header h2 {
            font-size: 1.1rem;
            margin: 0 0 15px 0;
            opacity: 0.95;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* Compact Score Grid */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            /* 4 items in one row */
            gap: 8px;
            margin: 0;
        }

        .score-card-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 4px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            text-align: center;
        }

        .sc-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.85;
            margin-bottom: 3px;
            font-weight: 600;
        }

        .sc-value {
            font-size: 1.15rem;
            font-weight: 700;
            line-height: 1.1;
        }

        /* Result Body */
        .res-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            background: #f8fafc;
        }

        /* Analysis Boxes */
        .analysis-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .analysis-box {
            background: white;
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        }

        .ab-title {
            font-size: 0.7rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ab-val {
            font-size: 0.9rem;
            font-weight: 700;
            color: #334155;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- MISSING OVERLAY & EXPLANATION STYLES --- */
        .overlay {
            display: none;
            /* Hidden by default */
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.8);
            /* Dark background */
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        /* Explanation Feed Styling */
        .exp-row {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .exp-row.correct {
            border-left: 5px solid #16a34a;
        }

        .exp-row.wrong {
            border-left: 5px solid #dc2626;
        }

        .exp-detail {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            margin-top: 15px;
            padding-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .why-box {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #334155;
        }

        .txt-green {
            color: #16a34a;
            font-weight: 700;
        }

        .txt-red {
            color: #dc2626;
            font-weight: 700;
        }

        /* Mobile Tweak: Stack scores if screen is too small */
        @media(max-width: 400px) {
            .score-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* --- PREMIUM HISTORY MODAL --- */
        #history-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 250;
            background: rgba(15, 23, 42, 0.7);
            /* Darker blur */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.2s ease-out;
        }

        .history-card {
            background: white;
            width: 90%;
            max-width: 550px;
            max-height: 80vh;
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .hist-header {
            padding: 25px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hist-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1e293b;
            letter-spacing: -0.5px;
        }

        .hist-close {
            background: #fee2e2;
            color: #ef4444;
            border: none;
            padding: 8px 16px;
            border-radius: 99px;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.2s;
        }

        .hist-close:hover {
            background: #fecaca;
            transform: scale(1.05);
        }

        .hist-list {
            padding: 20px;
            overflow-y: auto;
            background: #f8fafc;
            flex: 1;
        }

        /* The Individual Attempt Card */
        .hist-item {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .hist-item:hover {
            transform: translateY(-3px);
            border-color: #3b82f6;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1);
        }

        .h-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .h-title {
            font-weight: 700;
            color: #334155;
            font-size: 1rem;
        }

        .h-date {
            font-size: 0.8rem;
            color: #94a3b8;
            font-weight: 500;
        }

        .h-score-badge {
            background: #eff6ff;
            color: #2563eb;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            border: 1px solid #dbeafe;
        }

        /* Empty State */
        .hist-empty {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
            font-style: italic;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media(max-width: 768px) {
            .analysis-row {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            /* Default hide on small screens until toggled */
            .sidebar.active {
                display: flex;
                position: fixed;
                right: 0;
                top: 64px;
                bottom: 0;
                width: 85%;
                transform: none;
                box-shadow: -10px 0 20px rgba(0, 0, 0, 0.2);
            }
        }


        /* --- NEW HEADER STYLES --- */
        .header-left-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-box {
            background: white;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .logo-box img {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
        }

        .candidate-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
            line-height: 1.2;
        }

        .candidate-name {
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            font-size: 20px;
            /* Bigger Font */
            font-weight: 700;
            /* Bold */
            margin: 0;
            letter-spacing: 0.5px;
            text-transform: capitalize;
        }

        .test-badge {
            color: rgba(255, 255, 255, 0.85);
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 2px;
        }

        /* --- GLOBAL WATERMARK --- */
        body::after {
            content: "";
            position: fixed;
            inset: 0;
            background-image: url('https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50vmin;
            opacity: 0.1;
            z-index: 9999;
            pointer-events: none;
            filter: grayscale(100%);
            mix-blend-mode: multiply;
        }

        /* --- IMPROVED THANK YOU SCREEN --- */
        .ty-card {
            background: white;
            width: 90%;
            max-width: 750px;
            /* Wider on Laptop for grandeur */
            padding: 60px 40px;
            /* Generous spacing for symmetry */
            text-align: center;
            border-radius: 30px;
            box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.4s ease-out;
        }

        .ty-header {
            font-size: 3.5rem;
            /* Very large, clear text */
            font-weight: 800;
            color: #0f172a;
            margin: 20px 0 15px 0;
            line-height: 1.1;
            letter-spacing: -1px;
        }

        .ty-msg {
            font-size: 1.4rem;
            /* Large, easy-to-read body text */
            color: #475569;
            line-height: 1.8;
            /* High readability */
            margin-bottom: 40px;
            max-width: 90%;
            /* Prevents text stretching too wide */
        }

        /* Mobile Adjustments */
        @media(max-width: 600px) {
            .ty-card {
                padding: 40px 20px;
            }

            .ty-header {
                font-size: 2.5rem;
            }

            /* Adjusted for phone screens */
            .ty-msg {
                font-size: 1.15rem;
                line-height: 1.6;
            }
        }

        /* --- RESUME NAVIGATION TOAST --- */
        .resume-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            /* Hidden initially */
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            border: 1px solid #e2e8f0;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 300px;
        }

        .resume-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .rt-text {
            font-size: 0.9rem;
            color: #1e293b;
            flex: 1;
        }

        .rt-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            white-space: nowrap;
        }

        .rt-close {
            background: #f1f5f9;
            color: #64748b;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>

    <div id="instrOverlay"
        style="display:flex; position:fixed; inset:0; background:rgba(255,255,255,0.98); z-index:9999; align-items:center; justify-content:center; font-family:'Segoe UI', sans-serif;">
        <div
            style="width:100%; max-width:600px; background:white; padding:30px; border-radius:20px; box-shadow:0 25px 50px rgba(0,0,0,0.15); border:1px solid #e2e8f0; max-height:90vh; overflow-y:auto; margin:15px;">
            <div style="text-align:center; border-bottom:2px solid #eff6ff; padding-bottom:15px; margin-bottom:20px;">
                <h2 style="margin:0; color:#1e293b; font-size:22px;">üìú Instructions</h2>
                <p style="margin:5px 0 0; color:#64748b; font-size:14px;">Please read the marking scheme carefully</p>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:25px;">
                <div
                    style="background:#f0fdf4; padding:15px; border-radius:12px; border:1px solid #bbf7d0; text-align:center;">
                    <div style="color:#166534; font-size:12px; font-weight:700; text-transform:uppercase;">Correct
                        Answer</div>
                    <div style="font-size:24px; font-weight:800; color:#15803d;">+4</div>
                </div>
                <div
                    style="background:#fef2f2; padding:15px; border-radius:12px; border:1px solid #fecaca; text-align:center;">
                    <div style="color:#991b1b; font-size:12px; font-weight:700; text-transform:uppercase;">Incorrect
                        Answer</div>
                    <div style="font-size:24px; font-weight:800; color:#dc2626;">-1</div>
                </div>
            </div>

            <div
                style="background:#f8fafc; padding:20px; border-radius:12px; margin-bottom:25px; border:1px solid #e2e8f0;">
                <h3 style="margin:0 0 10px 0; font-size:16px; color:#334155;">üéÆ How to Submit:</h3>
                <ul style="margin:0; padding-left:20px; color:#475569; font-size:14px; line-height:1.6;">
                    <li><strong>Smartphone Users:</strong> Use the <span style="color:#dc2626; font-weight:bold;">Red
                            Submit Button</span> in the bottom footer.</li>
                    <li><strong>Laptop Users:</strong> Click 'Submit Test' on the sidebar.</li>
                    <li>You can review and change answers anytime before submitting.</li>
                </ul>
            </div>

            <button onclick="document.getElementById('instrOverlay').style.display='none'"
                style="width:100%; padding:16px; background:#2563eb; color:white; border:none; border-radius:12px; font-size:16px; font-weight:700; cursor:pointer; box-shadow:0 4px 12px rgba(37,99,235,0.2);">I
                am ready to begin ‚ûú</button>
        </div>
    </div>

    <div id="welcome-screen">
        <div class="welcome-card">
            <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="SocioLogic"
                style="height: 120px; width: auto; display: inline-block;">

            <h1 style="color:#1e293b; margin:0; font-size:1.8rem; letter-spacing:-0.5px;">YOUR PYQ BATTLE</h1>
            <p style="color:#64748b; margin-top:5px; margin-bottom:20px;">Indian Pluralism</p>

            <div class="mode-selector">
                <div class="mode-btn active" onclick="setMode('desktop')" id="btn-desktop">
                    <span style="font-size:1.5rem">üíª</span>
                    <span style="font-size:0.9rem">Laptop/Tablet</span>
                </div>
                <div class="mode-btn" onclick="setMode('mobile')" id="btn-mobile">
                    <span style="font-size:1.5rem">üì±</span>
                    <span style="font-size:0.9rem">Mobile</span>
                </div>
            </div>

            <input type="text" id="candidateName" class="input-field" placeholder="Enter Your Name" autocomplete="off"
                style="margin-bottom:10px;">

            <input type="text" id="username" class="input-field" placeholder="Enter Registered Mobile" autocomplete="off">

            <div id="attempt-badge"
                style="margin-bottom:15px; font-size:0.85rem; color:#64748b; font-weight:600; padding:10px; border-radius:8px; background:#f1f5f9; border:1px solid #e2e8f0;">
                Waiting for Candidate ID...
            </div>
            <button id="start-btn" class="btn btn-pri"
                style="width:100%; justify-content:center; padding:15px; font-size:1.1rem;" onclick="startTest()">
                Start Examination ‚ûú
            </button>

            <button class="btn btn-sec" style="width:100%; justify-content:center; margin-top:10px;"
                onclick="openHistory()">
                üìú View Past Attempts
            </button>

            <div style="margin-top: 25px; border-top: 1px dashed #cbd5e1; padding-top: 20px;">
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 10px; font-weight:600;">New Student?</p>
                <a href="https://rzp.io/rzp/xddl5LdV" target="_blank" style="text-decoration: none;">
                    <button class="btn"
                        style="background: #10b981; color: white; width: 100%; justify-content: center; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);">
                        ‚ö° Buy Full Access at just (‚Çπ149)
                    </button>
                </a>
                <div style="font-size:0.75rem; color:#94a3b8; margin-top:5px;">Last 4 digits of your phone will be your
                    ID</div>
            </div>
        </div>
    </div>

    <div id="history-modal">
        <div class="history-card">
            <div class="hist-header">
                <span class="hist-title">üìú Past Attempts</span>
                <button class="hist-close" onclick="closeHistory()">Close</button>
            </div>
            <div id="history-list" class="hist-list"></div>
        </div>
    </div>

    <div id="app-wrapper">
        <nav>
            <div class="header-left-section">
                <div class="logo-box">
                    <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="Logo" />
                </div>
                <div class="candidate-details">
                    <h1 class="candidate-name" id="nav-user">Guest</h1>
                    <div class="test-badge">Indian Pluralism</div>
                </div>
            </div>
            <div class="timer-badge" id="timer">00:00:00</div>
            <button class="btn btn-sec" style="padding:8px;" onclick="toggleSidebar()" id="mob-menu">‚ò∞</button>
        </nav>

        <div class="container">
            <div class="main-area">
                <div class="q-card" id="q-panel"></div>
            </div>

            <aside class="sidebar" id="sidebar">
                <div
                    style="padding:15px; border-bottom:1px solid #e2e8f0; font-weight:700; color:#334155; display:flex; justify-content:space-between; align-items:center;">
                    <span>Question Map</span>
                    <span onclick="toggleSidebar()" style="cursor:pointer; font-size:1.2rem; display:none;"
                        id="mob-close-sb">‚úï</span>
                </div>
                <div class="sb-grid" id="palette"></div>
                <div style="padding:20px; border-top:1px solid #e2e8f0; margin-top:auto;">
                    <button class="btn btn-danger" style="width:100%; justify-content:center;"
                        onclick="finishTest()">SUBMIT TEST</button>
                </div>
            </aside>
        </div>

        <div class="footer-bar" style="padding:0 10px; gap:5px; height:auto; min-height:72px;">
            <div style="display:flex; gap:5px; flex:1;">
                <button class="btn btn-sec" onclick="clearResp()"
                    style="flex:1; justify-content:center; padding:10px; font-size:0.8rem;">Clear</button>
                <button class="btn btn-rev" onclick="markReview()" id="btn-review"
                    style="flex:1; justify-content:center; padding:10px; font-size:0.8rem;">üö© Review</button>
            </div>
            <div style="display:flex; gap:5px; flex:1.5;">
                <button class="btn btn-sec" onclick="nav(-1)" style="padding:10px;">Prev</button>
                <button class="btn btn-pri" onclick="nav(1)" id="btn-next"
                    style="flex:1; justify-content:center; padding:10px; font-size:0.9rem;">Next ‚ûú</button>
                <button class="btn btn-danger" onclick="finishTest()"
                    style="padding:10px; background:#dc2626; color:white;">Submit</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="result-overlay">
        <div class="res-card">
            <div class="res-header">
                <h2>Assessment Report</h2>
                <div class="score-grid">
                    <div class="score-card-item">
                        <div class="sc-label">Attempted</div>
                        <div class="sc-value" id="disp-att">0</div>
                    </div>
                    <div class="score-card-item"
                        style="background: rgba(220, 252, 231, 0.25); border-color: rgba(220, 252, 231, 0.5);">
                        <div class="sc-label" style="color:#dcfce7;">Correct</div>
                        <div class="sc-value" style="color:#f0fdf4;" id="disp-cor">0</div>
                    </div>
                    <div class="score-card-item"
                        style="background: rgba(254, 226, 226, 0.25); border-color: rgba(254, 226, 226, 0.5);">
                        <div class="sc-label" style="color:#fee2e2;">Wrong</div>
                        <div class="sc-value" style="color:#fef2f2;" id="disp-wro">0</div>
                    </div>
                    <div class="score-card-item">
                        <div class="sc-label">Score</div>
                        <div class="sc-value" id="disp-score">0</div>
                    </div>
                </div>

                <button onclick="showThankYou()"
                    style="margin-top:15px; width:100%; padding:10px; background:#ffffff; color:#1e40af; border:none; border-radius:8px; font-weight:800; cursor:pointer; font-size:0.9rem; box-shadow:0 4px 6px rgba(0,0,0,0.1); transition:transform 0.2s;">
                    Exit & Save Report ‚ûú
                </button>
            </div>

            <div class="res-body">

                <div class="analysis-row">
                    <div class="analysis-box" style="border-left:4px solid #15803d;">
                        <div class="ab-title" style="color:#15803d">üí™ Strongest</div>
                        <div class="ab-val" id="area-strong">--</div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:3px;" id="area-strong-stat">Acc: 0%
                        </div>
                    </div>
                    <div class="analysis-box" style="border-left:4px solid #b91c1c;">
                        <div class="ab-title" style="color:#b91c1c">‚ö†Ô∏è Weakest</div>
                        <div class="ab-val" id="area-weak">--</div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:3px;" id="area-weak-stat">Acc: 0%</div>
                    </div>
                </div>

                <h3
                    style="font-size:0.95rem; font-weight:700; color:#0f172a; margin-bottom:15px; border-bottom:1px solid #e2e8f0; padding-bottom:8px;">
                    Detailed Explanations
                </h3>

                <div id="solution-feed"></div>

                <div style="text-align:center; margin-top:25px;">
                    <button class="btn btn-pri" style="width:100%; justify-content:center; padding:12px;"
                        onclick="showThankYou()">
                        Exit & Save Report
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="overlay" id="ty-screen">
        <div class="ty-card">

            <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="SocioLogic"
                style="height: 140px; width: auto; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 50%;">

            <h1 class="ty-header">Test Submitted!</h1>

            <p class="ty-msg">
                Your performance on <b style="color:#1e40af;">SocioLogic</b> has been recorded.<br>
                You are one step closer to your <b style="color:#d97706;">DREAM UNIVERSITY</b>.
            </p>

            <a href="https://t.me/SocioLogicPYQs" target="_blank"
                style="text-decoration:none; width: 100%; max-width: 400px;">
                <button class="btn btn-pri"
                    style="width:100%; justify-content:center; padding: 16px; font-size: 1.1rem; border-radius: 12px; background: #0088cc;">
                    ‚úàÔ∏è Join Telegram Channel
                </button>
            </a>

            <div style="display: flex; gap: 15px; width: 100%; max-width: 500px; margin-top: 25px; flex-wrap: wrap;">

                <button class="btn btn-sec" onclick="location.reload()"
                    style="flex: 1; min-width: 200px; justify-content: center; padding: 16px; border-radius: 12px; font-weight: 700; border: 2px solid #e2e8f0; color: #475569;">
                    üîÑ View Current Page
                </button>

                <a href="index.html" style="text-decoration: none; flex: 1; min-width: 200px;">
                    <button class="btn btn-pri"
                        style="width: 100%; justify-content: center; padding: 16px; border-radius: 12px; background: #0f172a; color: white; font-weight: 700; box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2);">
                        View Main Page
                    </button>
                </a>

            </div>
        </div>
    </div>
    <script>
        /* -------------------------------------------------------------
           PASTE YOUR QUESTION DATA HERE
           const questions = [ ... ];
        ------------------------------------------------------------- */
        const questions = [
            {
                topic: "üè∑Ô∏è Unity in Diversity | üìÖ CUET PG Gen",
                text: "Who among the following described India as a 'geographical unity' but a 'cultural diversity', yet famously coined the phrase 'Unity in Diversity' to describe the Indian Nation-State?",
                options: ["M.K. Gandhi", "Jawaharlal Nehru", "B.R. Ambedkar", "Rabindranath Tagore"],
                correct: 1,
                expl: {
                    correct: "Jawaharlal Nehru in his book 'The Discovery of India' popularized the term 'Unity in Diversity' to describe the synthesis of various cultural, religious, and linguistic elements in India.",
                    others: "Gandhi focused on Swaraj. Ambedkar focused on social justice and caste annihilation. Tagore focused on universal humanism.",
                    trick: "Think of the first Prime Minister and 'The Discovery of India'."
                }
            },
            {
                topic: "üè∑Ô∏è Indian Social Structure | üìÖ JNU MA 2019",
                text: "According to M.N. Srinivas, the distinction between 'Varna' and 'Jati' is crucial. Which of the following statements best represents this distinction?",
                options: ["Varna is the field view, Jati is the book view", "Varna is the textual model (Book View), Jati is the contextual reality (Field View)", "Both are identical concepts found in Vedas", "Varna refers to sub-castes, Jati refers to the four-fold division"],
                correct: 1,
                expl: {
                    correct: "M.N. Srinivas emphasized that Varna is the 'Book View' (textual, four-fold, rigid) while Jati is the 'Field View' (local, thousands of endogamous groups, fluid).",
                    others: "Option A reverses the definitions. Option C is factually incorrect as they differ in function. Option D swaps the definitions.",
                    trick: "Varna = Veda (Book/Text); Jati = Janta (People/Field)."
                }
            },
            {
                topic: "üè∑Ô∏è Ashrama System | üìÖ CUET PG 2022",
                text: "Arrangement of the four stages of life (Ashramas) in the correct chronological order according to Hindu Shastras is:",
                options: ["Grihastha, Brahmacharya, Vanaprastha, Sannyasa", "Brahmacharya, Grihastha, Vanaprastha, Sannyasa", "Brahmacharya, Vanaprastha, Grihastha, Sannyasa", "Sannyasa, Vanaprastha, Grihastha, Brahmacharya"],
                correct: 1,
                expl: {
                    correct: "The order is: 1. Brahmacharya (Student/Celibate), 2. Grihastha (Householder), 3. Vanaprastha (Retired/Forest Dweller), 4. Sannyasa (Renunciate).",
                    others: "Grihastha cannot come before Brahmacharya (education). Sannyasa is the final stage of liberation.",
                    trick: "B-G-V-S: Boy Goes Very Silent."
                }
            },
            {
                topic: "üè∑Ô∏è Racial Classification | üìÖ UGC NET 2015",
                text: "Who provided the first systematic racial classification of the Indian population in the census of 1901, classifying them into seven types?",
                options: ["B.S. Guha", "Herbert Risley", "J.H. Hutton", "D.N. Majumdar"],
                correct: 1,
                expl: {
                    correct: "Sir Herbert Risley provided the first racial classification in the 1901 Census, identifying 7 types including Turko-Iranian, Indo-Aryan, Scytho-Dravidian, etc.",
                    others: "B.S. Guha gave a 6-fold classification later (1931). Hutton worked on the 1931 census focusing on caste. Majumdar critiqued Risley.",
                    trick: "Risley = Race + 1901 Census."
                }
            },
            {
                topic: "üè∑Ô∏è Purusharthas | üìÖ CUET PG Gen",
                text: "Which of the following is NOT one of the four Purusharthas (goals of life) in traditional Hindu social organization?",
                options: ["Dharma", "Artha", "Karma", "Moksha"],
                correct: 2,
                expl: {
                    correct: "The four Purusharthas are Dharma (Duty), Artha (Wealth), Kama (Desire), and Moksha (Liberation). 'Karma' is the law of action, not a goal itself.",
                    others: "Dharma, Artha, and Moksha are standard goals alongside Kama.",
                    trick: "DAKM (Dharma, Artha, Kama, Moksha). Karma is the mechanism, not the destination."
                }
            },
            {
                topic: "üè∑Ô∏è Pluralism | üìÖ HU QP 2021",
                text: "The 'People of India' project, which mapped the cultural and biological diversity of Indian communities, was spearheaded by which anthropologist?",
                options: ["M.N. Srinivas", "K.S. Singh", "S.C. Dube", "N.K. Bose"],
                correct: 1,
                expl: {
                    correct: "K.S. Singh, as the Director General of the Anthropological Survey of India, led the massive 'People of India' project identifying 4635 communities.",
                    others: "Srinivas is known for Sanskritization. Bose for Civilizational view. Dube for Village studies.",
                    trick: "Singh = Survey (People of India)."
                }
            },
            {
                topic: "üè∑Ô∏è Linguistic Diversity | üìÖ CUET PG 2023",
                text: "The Eighth Schedule of the Indian Constitution primarily deals with:",
                options: ["Reservation for SC/STs", "Official Languages of India", "Land Reforms", "Panchayati Raj Institutions"],
                correct: 1,
                expl: {
                    correct: "The Eighth Schedule lists the official languages of the Republic of India. Currently, it recognizes 22 languages.",
                    others: "Reservation is governed by other articles. Land reforms are in the 9th Schedule. Panchayati Raj is 11th Schedule.",
                    trick: "8th Schedule = Languages (8 looks like two loops, like a tongue twisting)."
                }
            },
            {
                topic: "üè∑Ô∏è Indological Perspective | üìÖ DU MA 2020",
                text: "Who is considered the father of the 'Indological' approach in Indian Sociology, emphasizing the study of Indian society through ancient texts?",
                options: ["G.S. Ghurye", "A.R. Desai", "D.P. Mukerji", "Andre Beteille"],
                correct: 0,
                expl: {
                    correct: "G.S. Ghurye is often called the Father of Indian Sociology and used the Indological approach (using scriptures/texts) to study Caste and Race.",
                    others: "A.R. Desai used the Marxist approach. Andre Beteille used the Weberian/Empirical approach.",
                    trick: "Ghurye = Guru of Indian Sociology (Texts/Indology)."
                }
            },
            {
                topic: "üè∑Ô∏è Tribal Integration | üìÖ UGC NET 2018",
                text: "Who referred to the Tribals of India as 'Backward Hindus', arguing against their isolation?",
                options: ["Verrier Elwin", "G.S. Ghurye", "Jawaharlal Nehru", "Thakkar Bapa"],
                correct: 1,
                expl: {
                    correct: "G.S. Ghurye argued that tribes were not separate from Hindus but were merely 'Backward Hindus' who had not yet fully integrated into the caste structure.",
                    others: "Verrier Elwin initially advocated for 'National Parks' (isolation) for tribes. Thakkar Bapa worked for their welfare.",
                    trick: "Ghurye wanted them in the fold (Hindu fold), so 'Backward Hindus'."
                }
            },
            {
                topic: "üè∑Ô∏è Caste Characteristics | üìÖ CUET PG Gen",
                text: "According to G.S. Ghurye, which of the following is NOT a feature of the Caste system?",
                options: ["Segmental Division of Society", "Hierarchy", "Unrestricted social intercourse", "Civil and religious disabilities/privileges"],
                correct: 2,
                expl: {
                    correct: "Ghurye listed 'Restrictions on feeding and social intercourse' as a feature. 'Unrestricted' intercourse is the opposite of the caste system.",
                    others: "Segmental division, Hierarchy, Endogamy, and Lack of unrestricted choice of occupation are key features defined by Ghurye.",
                    trick: "Caste creates boundaries (Restrictions), it does not remove them."
                }
            },
            {
                topic: "üè∑Ô∏è Religious Pluralism | üìÖ Census Data",
                text: "As per the Census of India 2011, which religious group constitutes the second largest majority (largest minority) in India?",
                options: ["Christians", "Sikhs", "Muslims", "Buddhists"],
                correct: 2,
                expl: {
                    correct: "Muslims constitute approximately 14.2% of the population (2011 Census), making them the largest minority group in India.",
                    others: "Christians are approx 2.3%, Sikhs 1.7%, Buddhists 0.7%.",
                    trick: "Hindu > Muslim > Christian > Sikh."
                }
            },
            {
                topic: "üè∑Ô∏è Unity in Diversity | üìÖ AUD MA 2021",
                text: "N.K. Bose proposed a unique model to explain Indian Unity. What was his key concept?",
                options: ["Pyramidal Structure", "Unity in Diversity through 'non-competitive economic interdependence'", "Melting Pot", "Totalitarian Unity"],
                correct: 1,
                expl: {
                    correct: "N.K. Bose argued that India's unity was held together by the caste system's non-competitive, hereditary economic interdependence (Jajmani-like structure).",
                    others: "Pyramidal structure describes the hierarchy. Melting Pot is a US concept.",
                    trick: "Bose = Boss of Economic Interdependence theory."
                }
            },
            {
                topic: "üè∑Ô∏è Concept of Dharma | üìÖ CUET PG Gen",
                text: "In the context of Indian society, 'Svadharma' refers to:",
                options: ["Universal Law", "Individual's specific duty based on caste and stage of life", "The law of the state", "Ritual sacrifice"],
                correct: 1,
                expl: {
                    correct: "Svadharma refers to the specific duties relevant to an individual's Varna (Caste) and Ashrama (Stage of life).",
                    others: "Universal law is often Sanatana Dharma. Law of state is Raj Dharma.",
                    trick: "Sva = Self. Dharma = Duty. Duty of the Self."
                }
            },
            {
                topic: "üè∑Ô∏è Diversity & Stratification | üìÖ JNU MA 2020",
                text: "Louis Dumont in his book 'Homo Hierarchicus' analyzes the Indian caste system based on the binary opposition of:",
                options: ["Wealth and Poverty", "Power and Authority", "Purity and Pollution", "Tradition and Modernity"],
                correct: 2,
                expl: {
                    correct: "Dumont's central thesis is that the caste hierarchy is determined by religious values distinguishing 'Pure' from 'Impure' (Pollution).",
                    others: "Wealth (Class) and Power are secondary to ritual status in Dumont's view.",
                    trick: "Dumont = Purity/Pollution."
                }
            },
            {
                topic: "üè∑Ô∏è Language Families | üìÖ CUET PG Gen",
                text: "The Dravidian language family primarily covers which part of India?",
                options: ["North East India", "Gangetic Plains", "Southern India", "Western India"],
                correct: 2,
                expl: {
                    correct: "The Dravidian language family (Tamil, Telugu, Kannada, Malayalam) is dominant in Southern India.",
                    others: "North/West uses Indo-Aryan. North East uses Tibeto-Burman.",
                    trick: "Dravidian = Down South."
                }
            },
            {
                topic: "üè∑Ô∏è Modernization | üìÖ BHU MA 2018",
                text: "Who authored the book 'Modernization of Indian Tradition', arguing that Indian tradition is not static but adaptive?",
                options: ["Yogendra Singh", "M.N. Srinivas", "S.C. Dube", "Dipankar Gupta"],
                correct: 0,
                expl: {
                    correct: "Yogendra Singh wrote 'Modernization of Indian Tradition', analyzing how Indian social structures adapt to modern forces like democracy and industry.",
                    others: "Srinivas focused on Social Change. Gupta focused on Stratification.",
                    trick: "Yoga adapts body; Yogendra adapts Tradition."
                }
            },
            {
                topic: "üè∑Ô∏è Religious Diversity | üìÖ CUET PG Gen",
                text: "Which religion in India is considered to have no caste system theoretically but practices a form of social stratification in reality?",
                options: ["Hinduism", "Islam", "Christianity", "All of the above"],
                correct: 3,
                expl: {
                    correct: "While Caste is scriptural in Hinduism, sociological studies (e.g., Imtiaz Ahmad) show that Indian Muslims and Christians also practice caste-like endogamy and stratification.",
                    others: "Sociologists agree that caste pervades all major religious groups in the Indian subcontinent.",
                    trick: "Caste is a 'pan-Indian' phenomenon, not just Hindu."
                }
            },
            {
                topic: "üè∑Ô∏è Ashrama System | üìÖ CUET PG Gen",
                text: "The 'Grihastha' ashrama is considered vital in the Hindu social system because:",
                options: ["It is the stage of complete renunciation", "It supports the other three ashramas through production and reproduction", "It is the stage of childhood learning", "It involves living in the forest"],
                correct: 1,
                expl: {
                    correct: "Grihastha (Householder) is the backbone of society as it generates wealth (Artha) and progeny (Kama), supporting the student (Brahmacharya) and the renunciates.",
                    others: "Renunciation is Sannyasa. Learning is Brahmacharya. Forest is Vanaprastha.",
                    trick: "Grihastha = House = Economy = Support."
                }
            },
            {
                topic: "üè∑Ô∏è Evolution of Society | üìÖ UGC NET 2021",
                text: "Which concept did McKim Marriott use to explain the interaction between local diversities and the greater Indian tradition?",
                options: ["Westernization and Modernization", "Universalization and Parochialization", "Sanskritization and De-sanskritization", "Little and Great Traditions"],
                correct: 1,
                expl: {
                    correct: "McKim Marriott introduced 'Universalization' (local elements becoming part of Great Tradition) and 'Parochialization' (Great Tradition elements becoming localized).",
                    others: "Redfield coined Little/Great Traditions; Marriott added the dynamic processes (Universalization/Parochialization).",
                    trick: "Marriott = Motion between traditions (Universal/Parochial)."
                }
            },
            {
                topic: "üè∑Ô∏è Caste System | üìÖ CUET PG Gen",
                text: "The concept of 'Jajmani System' refers to:",
                options: ["A system of religious worship", "A system of economic and ritual exchange of goods and services between castes", "A political alliance between clans", "A marriage ritual"],
                correct: 1,
                expl: {
                    correct: "The Jajmani system was the traditional village economic system where 'Jajmans' (patrons) exchanged grain for services from 'Kamins' (service castes).",
                    others: "It is essentially an economic-ritual relationship, not just religious or political.",
                    trick: "Jajman = Patron; Jajmani = Exchange System."
                }
            },
            {
                topic: "üè∑Ô∏è Tribal Classification | üìÖ CUET PG 2022",
                text: "Geographically, the tribal population of India is most concentrated in which zone?",
                options: ["Northern Zone", "Central Zone", "Southern Zone", "Island Zone"],
                correct: 1,
                expl: {
                    correct: "The Central Zone (Madhya Pradesh, Jharkhand, Chhattisgarh, Odisha) contains the largest concentration of India's tribal population.",
                    others: "While North East has a high *percentage*, the absolute *concentration* is highest in the Central belt.",
                    trick: "Central India = Heart of Tribal India."
                }
            },
            {
                topic: "üè∑Ô∏è Indian Society | üìÖ CUET PG Gen",
                text: "The 'Three-Language Formula' was an attempt to address which aspect of Indian pluralism?",
                options: ["Religious conflicts", "Linguistic diversity and national integration", "Caste based discrimination", "Regional economic disparity"],
                correct: 1,
                expl: {
                    correct: "The Three-Language Formula (Hindi, English, Regional Language) was devised to bridge linguistic diversity and promote national integration.",
                    others: "It specifically addresses language, not religion or caste.",
                    trick: "Language Formula = Linguistic Diversity."
                }
            },
            {
                topic: "üè∑Ô∏è Race & Caste | üìÖ JNU MA 2018",
                text: "B.R. Ambedkar rejected the 'Aryan Invasion Theory' as the origin of the Caste system. What was his primary argument regarding the Shudras?",
                options: ["They were a separate race", "They were originally Kshatriyas who lost their status due to denial of Upanayana", "They were the original inhabitants of India", "They were imported slaves"],
                correct: 1,
                expl: {
                    correct: "In 'Who Were the Shudras?', Ambedkar argued that Shudras were originally Kshatriyas who were degraded by Brahmins (denied the sacred thread/Upanayana) due to conflict.",
                    others: "He rejected the racial theory that Shudras were non-Aryans or a different race.",
                    trick: "Ambedkar: Shudras = Fallen Kshatriyas (Social, not Racial)."
                }
            },
            {
                topic: "üè∑Ô∏è Social Change | üìÖ CUET PG Gen",
                text: "M.N. Srinivas preferred the term 'Sanskritization' over 'Brahmanization' because:",
                options: ["Brahmin customs were too difficult to follow", "Lower castes imitated not just Brahmins but any dominant 'twice-born' caste", "Sanskritization is a political term", "Brahmanization was a colonial term"],
                correct: 1,
                expl: {
                    correct: "Srinivas realized that lower castes often imitated the dominant caste of their region (which could be Kshatriya or Vaishya), not just Brahmins.",
                    others: "Sanskritization is a broader cultural imitation of the 'Great Tradition'.",
                    trick: "Sanskritization > Brahmanization (Broader scope)."
                }
            },
            {
                topic: "üè∑Ô∏è Marriage Rules | üìÖ CUET PG 2023",
                text: "In the context of North Indian kinship and caste, which rule strictly prohibits marriage within the same village?",
                options: ["Village Endogamy", "Village Exogamy", "Gotra Endogamy", "Caste Exogamy"],
                correct: 1,
                expl: {
                    correct: "North Indian villages typically practice Village Exogamy (marrying outside the village), treating village women as sisters.",
                    others: "Caste is always Endogamous (marrying within). South India often allows Village Endogamy.",
                    trick: "North = Out (Exogamy) of Village."
                }
            },
            {
                topic: "üè∑Ô∏è Indological View | üìÖ CUET PG Gen",
                text: "The concept of 'Rina' (Debt) in the Hindu social system implies that every individual is born with debts to:",
                options: ["The State and King", "Gods, Sages, and Ancestors", "The Landlord", "The Caste Council"],
                correct: 1,
                expl: {
                    correct: "Traditional Hindu belief cites three debts (Rinas): Deva Rina (Gods), Rishi Rina (Sages), and Pitra Rina (Ancestors).",
                    others: "Debts to state or landlords are secular/economic, not the scriptural 'Rina'.",
                    trick: "Rina = Spiritual Debt (Gods, Gurus, Grandfathers)."
                }
            },
            {
                topic: "üè∑Ô∏è Unity in Diversity | üìÖ HCU MA 2019",
                text: "Which Indian sociologist argued that 'Caste' has actually strengthened in modern politics rather than disappearing, calling it the 'politicization of caste'?",
                options: ["G.S. Ghurye", "Rajni Kothari", "M.N. Srinivas", "Andre Beteille"],
                correct: 1,
                expl: {
                    correct: "Rajni Kothari, in 'Caste in Indian Politics', argued that democratic politics has provided a new lease of life to caste associations.",
                    others: "Srinivas talked about dominant caste. Ghurye focused on culture. Beteille focused on class/power.",
                    trick: "Kothari = Politics of Caste."
                }
            },
            {
                topic: "üè∑Ô∏è Pluralism | üìÖ CUET PG Gen",
                text: "The distinction between 'Little Tradition' (folk/local) and 'Great Tradition' (elites/Sanskritic) in the Indian context helps us understand:",
                options: ["Economic Disparity", "Cultural Diversity and Civilizational Unity", "Political Voting Behavior", "Urbanization"],
                correct: 1,
                expl: {
                    correct: "These concepts explain how local diverse cultures (Little) interact with the pan-Indian unified culture (Great), maintaining diversity within unity.",
                    others: "It is primarily a cultural/anthropological framework.",
                    trick: "Little + Great = Cultural Continuum."
                }
            },
            {
                topic: "üè∑Ô∏è Racial Groups | üìÖ UGC NET 2016",
                text: "Which racial group is primarily found in the North-East region of India?",
                options: ["Negrito", "Proto-Australoid", "Mongoloid", "Nordic"],
                correct: 2,
                expl: {
                    correct: "The Mongoloid racial element is dominant in North-East India and the Himalayan border regions.",
                    others: "Negritos are in Andaman. Proto-Australoids are central tribal belts. Nordics are in North-West.",
                    trick: "North East = East Asian features = Mongoloid."
                }
            },
            {
                topic: "üè∑Ô∏è Caste Ideology | üìÖ CUET PG Gen",
                text: "Which of the following is an example of 'hierarchical' rather than 'stratified' inequality in the Indian context, according to Louis Dumont?",
                options: ["Class System", "Caste System", "Gender System", "Race System"],
                correct: 1,
                expl: {
                    correct: "Dumont argues Caste is a special type of 'Homo Hierarchicus' based on religious values, distinct from Western 'stratification' based on power/wealth.",
                    others: "Dumont specifically contrasts Caste hierarchy with Western stratification.",
                    trick: "Dumont = Caste is unique hierarchy."
                }
            },
            {
                topic: "üè∑Ô∏è Ashrama System | üìÖ CUET PG Gen",
                text: "The transition from Brahmacharya to Grihastha is traditionally marked by which Samskara (ritual)?",
                options: ["Upanayana", "Samavartana (Snana)", "Antyeshti", "Namakarana"],
                correct: 1,
                expl: {
                    correct: "Samavartana is the graduation bath/ceremony marking the end of student life and readiness for marriage (Grihastha).",
                    others: "Upanayana starts Brahmacharya. Antyeshti is funeral. Namakarana is naming.",
                    trick: "Samavartana = Summer Vacation ends, real life (marriage) begins."
                }
            },
            {
                topic: "üè∑Ô∏è Diversity Framework | üìÖ CUET PG Gen",
                text: "Who among the following sociologists used the 'Dialectical Approach' (Marxist) to study the evolution of Indian society?",
                options: ["M.N. Srinivas", "A.R. Desai", "G.S. Ghurye", "Irawati Karve"],
                correct: 1,
                expl: {
                    correct: "A.R. Desai (e.g., 'Social Background of Indian Nationalism') applied Marxist/Dialectical historical materialism to understand Indian social changes.",
                    others: "Srinivas (Structural-Functional). Ghurye (Indological). Karve (Kinship/Indological).",
                    trick: "Desai = Dialectical (Marxist)."
                }
            },
            {
                topic: "üè∑Ô∏è National Integration | üìÖ CUET PG 2023",
                text: "The 'Mandal Commission' report, which highlighted the diversity of Other Backward Classes (OBCs), recommended reservation primarily based on:",
                options: ["Economic criteria only", "Social and Educational backwardness", "Religious minority status", "Gender discrimination"],
                correct: 1,
                expl: {
                    correct: "The Mandal Commission (BP Mandal) used indicators of Social, Educational, and Economic backwardness, but the constitutional basis is Social and Educational.",
                    others: "Economic criteria alone was not the basis (EWS came later). Religion is not a basis for reservation.",
                    trick: "SEBC = Socially and Educationally Backward Classes."
                }
            },
            {
                topic: "üè∑Ô∏è Cultural Unity | üìÖ CUET PG Gen",
                text: "Which term did L.P. Vidyarthi coin to describe the network of pilgrimage centers that binds India culturally?",
                options: ["Sacred Complex", "Sanskritization", "Cultural Zone", "Religious Network"],
                correct: 0,
                expl: {
                    correct: "L.P. Vidyarthi studied Gaya and coined 'Sacred Complex' to describe the interaction of Sacred Geography, Sacred Specialists, and Sacred Performances.",
                    others: "Sanskritization is Srinivas. Cultural Zone is Cohn/Bose.",
                    trick: "Vidyarthi studied the Holy places = Sacred Complex."
                }
            },
            {
                topic: "üè∑Ô∏è Family & Diversity | üìÖ CUET PG Gen",
                text: "The 'Taravad' is a matrilineal joint family system found in which part of India?",
                options: ["West Bengal", "Kerala", "Rajasthan", "Punjab"],
                correct: 1,
                expl: {
                    correct: "The Taravad is the traditional matrilineal joint family of the Nairs in Kerala.",
                    others: "West Bengal has Dayabhaga law but is patrilineal. Rajasthan/Punjab are strongly patrilineal.",
                    trick: "Taravad = Kerala (Nairs)."
                }
            }


        ];

        //
        // 'Indian Pluralism';

        // --- SECURITY CONFIGURATION ---
        // 1. PASTE YOUR GOOGLE SCRIPT URL HERE:
        // 1. PASTE YOUR GOOGLE SCRIPT URL HERE (From your Deployment):
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwUHQCJgKTEWw72qdMkFC9oftmTB7gpYzlrPHfm3Nx0zJ1EsQFB0fl9U2B_UOhcYsBimQ/exec";

        // 2. UNIQUE NAME FOR THIS SPECIFIC TEST (Demand #3)
        // Change this string for every new HTML file you create (e.g., "History_2025", "Mock_01")
        const TEST_ID = "Indian Pluralism";

        // 2. SETTINGS
        const MAX_ATTEMPTS = 5;
        const SECONDS_PER_QUESTION = 72;

        // 3. VARIABLES
        let responses = new Array(questions.length).fill(null);
        let status = new Array(questions.length).fill(0);
        let timeLeft = questions.length * SECONDS_PER_QUESTION;
        let timerRef, checkTimer, isMobile;
        let userName = "Student";
        let history = []; // Local session history

        // --- INITIALIZATION ---
        window.onload = function () {
            isMobile = window.innerWidth < 768;
            if (isMobile) setMode('mobile'); else setMode('desktop');

            document.getElementById('timer').innerText = formatTime(timeLeft);

            // Listeners
            document.getElementById('candidateName').addEventListener('input', checkStartConditions);
            document.getElementById('username').addEventListener('keyup', handleIdInput);

            // Auto-Fill from Dashboard
            const savedID = localStorage.getItem('socio_user_id');
            const savedName = localStorage.getItem('socio_user_name');
            if (savedID) {
                document.getElementById('username').value = savedID;
                document.getElementById('candidateName').value = savedName || "";
                handleIdInput();
            }

            // FEATURE: Guest Hint & Placeholder for Free Tests
            if (typeof TEST_ID !== 'undefined' && TEST_ID.toUpperCase().startsWith("FREE")) {
                const idBox = document.getElementById('username');
                idBox.placeholder = "Enter ID: SocioLogic";

                // Avoid duplicate hint if already exists
                if (!idBox.parentNode.querySelector('.guest-hint')) {
                    const hint = document.createElement("div");
                    hint.className = "guest-hint";
                    hint.innerHTML = "üí° <b>Guest Access:</b> Type <span style='color:#2563eb; font-weight:800;'>SocioLogic</span>";
                    hint.style.cssText = "font-size:0.85rem; color:#64748b; margin:-10px 0 15px 0; background:#eff6ff; padding:8px; border-radius:8px; border:1px dashed #bfdbfe;";
                    idBox.parentNode.insertBefore(hint, idBox.nextSibling);
                }
            }
        };

        function formatTime(s) {
            let h = Math.floor(s / 3600).toString().padStart(2, '0');
            let m = Math.floor((s % 3600) / 60).toString().padStart(2, '0');
            let sec = (s % 60).toString().padStart(2, '0');
            return `${h}:${m}:${sec}`;
        }

        function setMode(mode) {
            isMobile = (mode === 'mobile');
            const dBtn = document.getElementById('btn-desktop');
            const mBtn = document.getElementById('btn-mobile');
            if (dBtn && mBtn) {
                dBtn.className = isMobile ? 'mode-btn' : 'mode-btn active';
                mBtn.className = isMobile ? 'mode-btn active' : 'mode-btn';
            }
        }

        // --- ID CHECK (RESTORED MAGIC FIX) ---
        function handleIdInput() {
            const idVal = document.getElementById('username').value.trim();
            const badge = document.getElementById('attempt-badge');
            const btn = document.getElementById('start-btn');

            // Disable button while typing
            btn.disabled = true;
            btn.style.backgroundColor = "#cbd5e1";
            btn.style.cursor = "not-allowed";

            clearTimeout(checkTimer);

            // 1. Basic Length Check
            if (idVal.length < 10 && idVal.toUpperCase() !== "SOCIOLOGIC") {
                badge.innerHTML = "Enter 10-digit Mobile...";
                badge.style.background = "#f1f5f9"; badge.style.color = "#64748b"; badge.style.borderColor = "#e2e8f0";
                return;
            }

            // --- MAGIC FIX: IMMEDIATE UNLOCK FOR FREE TESTS ---
            if (typeof TEST_ID !== 'undefined' && TEST_ID.toUpperCase().startsWith("FREE")) {
                badge.innerHTML = `‚úÖ <b>Free Access:</b> Unlimited Attempts Allowed`;
                badge.style.background = "#dcfce7"; badge.style.color = "#15803d"; badge.style.borderColor = "#86efac";
                checkStartConditions(); // Unlock immediately
                return;
            }
            // --------------------------------------------------

            // 2. Paid Tests: Check Cloud
            badge.innerHTML = "üîÑ Checking Cloud Records...";
            badge.style.background = "#fffbeb"; badge.style.color = "#d97706";

            checkTimer = setTimeout(() => {
                fetch(SCRIPT_URL + "?type=check&id=" + encodeURIComponent(idVal) + "&test=" + encodeURIComponent(TEST_ID))
                    .then(res => res.text())
                    .then(data => {
                        if (data === "BLOCK_NOT_PAID") {
                            badge.innerHTML = "‚õî <b>ID Not Authorized.</b> Please buy access.";
                            badge.style.background = "#fee2e2"; badge.style.color = "#b91c1c"; badge.style.borderColor = "#fecaca";
                        } else {
                            const used = parseInt(data) || 0;
                            if (used >= MAX_ATTEMPTS) {
                                badge.innerHTML = `‚ö†Ô∏è <b>Limit Reached</b> (Used: ${used}/${MAX_ATTEMPTS})`;
                                badge.style.background = "#fee2e2"; badge.style.color = "#b91c1c"; badge.style.borderColor = "#fecaca";
                            } else {
                                badge.innerHTML = `‚úÖ <b>Attempt ${used + 1} Available</b> (${MAX_ATTEMPTS - used} left)`;
                                badge.style.background = "#dcfce7"; badge.style.color = "#15803d"; badge.style.borderColor = "#86efac";
                                checkStartConditions();
                            }
                        }
                    })
                    .catch(() => {
                        badge.innerHTML = "‚ùå Network Error";
                        // Fallback: Allow start if network fails? Better to block to prevent bypass.
                    });
            }, 800);
        }

        function checkStartConditions() {
            const name = document.getElementById('candidateName').value.trim();
            const id = document.getElementById('username').value.trim();
            const badgeText = document.getElementById('attempt-badge').innerText;
            const btn = document.getElementById('start-btn');

            if (name.length > 0 && id.length >= 4 && (badgeText.includes("‚úÖ") || badgeText.includes("Unlimited"))) {
                btn.disabled = false;
                btn.style.backgroundColor = "#2563eb";
                btn.style.cursor = "pointer";
                btn.innerText = "Start Examination ‚ûú";
            }
        }

        // --- START TEST (TRACKING) ---
        function startTest() {
            const nameVal = document.getElementById('candidateName').value.trim();
            const idVal = document.getElementById('username').value.trim();

            userName = nameVal;
            document.getElementById('nav-user').innerText = userName.split(' ')[0];

            // Track Attempt (Only if NOT Free/Guest)
            if (!TEST_ID.toUpperCase().startsWith("FREE")) {
                fetch(SCRIPT_URL + "?type=track&id=" + encodeURIComponent(idVal) + "&test=" + encodeURIComponent(TEST_ID) + "&name=" + encodeURIComponent(nameVal));
            }

            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'flex';

            if (isMobile) {
                document.body.classList.add('mobile-mode');
                document.getElementById('mob-menu').style.display = 'block';
                document.getElementById('mob-close-sb').style.display = 'block';
            } else {
                document.body.classList.remove('mobile-mode');
                document.getElementById('mob-menu').style.display = 'none';
            }

            initTest();
        }

        // --- TEST ENGINE ---
        let current = 0;
        function initTest() {
            renderQ(0);
            renderPalette();
            clearInterval(timerRef);
            timerRef = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = formatTime(timeLeft);
                if (timeLeft <= 0) finishTest();
            }, 1000);
        }

        function renderQ(idx) {
            current = idx;
            const q = questions[idx];
            if (status[idx] === 0) { status[idx] = 1; renderPalette(); }

            const optionsHtml = q.options.map((opt, i) => {
                const isSelected = responses[idx] === i;
                let cls = isSelected ? 'option selected' : 'option';
                if (status[idx] === 4 && isSelected) cls += ' review-marked';

                return `<div class="${cls}" onclick="selectOpt(${i})">
                <div class="opt-key">${String.fromCharCode(65 + i)}</div>
                <div style="flex:1">${opt}</div>
            </div>`;
            }).join('');

            document.getElementById('q-panel').innerHTML = `
            <div class="q-header"><span class="topic-tag">${q.topic}</span><span>Q.${idx + 1}/${questions.length}</span></div>
            <div class="q-text">${q.text}</div>
            <div>${optionsHtml}</div>`;
        }

        function selectOpt(i) {
            responses[current] = i;
            status[current] = (status[current] >= 3) ? 4 : 2;
            renderQ(current); renderPalette();
        }

        function nav(d) {
            let next = current + d;
            if (next >= 0 && next < questions.length) renderQ(next);
        }

        function renderPalette() {
            document.getElementById('palette').innerHTML = questions.map((_, i) => {
                let cls = 'grid-btn';
                if (i === current) cls += ' st-curr';
                if (status[i] === 2) cls += ' st-ans';
                else if (status[i] === 3) cls += ' st-rev';
                else if (status[i] === 4) cls += ' st-ans-rev';
                return `<div class="${cls}" onclick="renderQ(${i})">${i + 1}</div>`;
            }).join('');
        }

        function markReview() {
            status[current] = (responses[current] !== null) ? 4 : 3;
            renderPalette(); nav(1);
        }

        function clearResp() { responses[current] = null; status[current] = 1; renderQ(current); renderPalette(); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

        // --- SUBMIT & SYNC ---
        function finishTest() {
            clearInterval(timerRef);
            let s = 0, c = 0, w = 0;
            responses.forEach((ans, i) => {
                if (ans === questions[i].correct) { s += 4; c++; }
                else if (ans !== null && ans !== undefined) { s -= 1; w++; }
            });

            const id = document.getElementById('username').value.trim();
            const name = document.getElementById('candidateName').value.trim();

            // Show Result Immediately
            renderResultScreen({ userResponses: [...responses] });

            // Cloud Sync (Skip if Free Test & using dummy ID)
            if (!TEST_ID.toUpperCase().startsWith("FREE") || id.toUpperCase() !== "SOCIOLOGIC") {
                const resStr = responses.map(r => (r === null || r === undefined) ? '' : r).join(",");
                const url = SCRIPT_URL + "?type=submit&id=" + encodeURIComponent(id) + "&test=" + encodeURIComponent(TEST_ID) + "&score=" + s + "&name=" + encodeURIComponent(name) + "&resp=" + encodeURIComponent(resStr);
                fetch(url, { mode: 'no-cors' });
            }
        }

        // --- ANALYSIS SCREEN ---
        function renderResultScreen(data) {
            let s = 0, c = 0, w = 0, att = 0;
            const resps = data.userResponses || [];

            questions.forEach((q, i) => {
                const ans = resps[i];
                if (ans !== null && ans !== undefined) {
                    att++;
                    if (ans === q.correct) { s += 4; c++; } else { s -= 1; w++; }
                }
            });

            const max = questions.length * 4;

            // Update DOM
            if (document.getElementById('disp-att')) document.getElementById('disp-att').innerText = `${att}/${questions.length}`;
            if (document.getElementById('disp-cor')) document.getElementById('disp-cor').innerText = c;
            if (document.getElementById('disp-wro')) document.getElementById('disp-wro').innerText = w;
            if (document.getElementById('disp-score')) document.getElementById('disp-score').innerText = `${s}/${max}`;

            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'none';
            document.getElementById('result-overlay').style.display = 'flex';

            // Analysis Feed
            const feed = document.getElementById('solution-feed');
            if (feed) {
                let html = "", topicStats = {};
                questions.forEach((q, i) => {
                    const ans = resps[i], isCor = (ans === q.correct);
                    if (!topicStats[q.topic]) topicStats[q.topic] = { t: 0, c: 0 };
                    topicStats[q.topic].t++; if (isCor) topicStats[q.topic].c++;

                    let statusIcon = isCor ? '<span class="txt-green">‚úì Correct</span>' : (ans !== null && ans !== undefined ? '<span class="txt-red">‚úï Incorrect</span>' : '<span>‚óã Skipped</span>');
                    let rowClass = isCor ? 'correct' : (ans !== null && ans !== undefined ? 'wrong' : '');

                    const opts = q.options.map((opt, idx) => {
                        let style = "padding:8px 12px; border-radius:8px; margin-bottom:5px; border:1px solid #e2e8f0; background:#f8fafc; color:#64748b;";
                        if (idx === q.correct) style = "padding:8px; border-radius:8px; margin-bottom:5px; border:1px solid #bbf7d0; background:#dcfce7; color:#166534; font-weight:600;";
                        else if (idx === ans && !isCor) style = "padding:8px; border-radius:8px; margin-bottom:5px; border:1px solid #fecaca; background:#fee2e2; color:#991b1b; font-weight:600;";
                        return `<div style="${style}"><b>${String.fromCharCode(65 + idx)}.</b> ${opt}</div>`;
                    }).join('');

                    html += `<div class="exp-row ${rowClass}">
                    <div style="display:flex; justify-content:space-between; font-weight:700;">
                        <span style="color:#64748b; font-size:0.8rem">${q.topic}</span>${statusIcon}
                    </div>
                    <div style="font-weight:600; margin:10px 0;">Q${i + 1}: ${q.text}</div>
                    <div style="margin-bottom:20px; font-size:0.95rem;">${opts}</div>
                    <div class="exp-detail">
                        <div class="why-box"><span class="txt-green">‚úÖ Solution:</span> ${q.expl.correct}</div>
                        <div class="why-box"><span class="txt-red">‚ùå Error Analysis:</span> ${q.expl.others}</div>
                        <div style="background:#fffbeb; padding:10px; border:1px dashed #f59e0b; border-radius:8px; margin-top:8px;">üí° <b>Trick:</b> ${q.expl.trick}</div>
                    </div>
                </div>`;
                });
                feed.innerHTML = html;

                // Weak/Strong
                let best = { n: '-', v: -1 }, worst = { n: '-', v: 101 };
                for (let t in topicStats) {
                    let acc = (topicStats[t].c / topicStats[t].t) * 100;
                    if (acc > best.v) best = { n: t, v: acc };
                    if (acc < worst.v) worst = { n: t, v: acc };
                }
                if (document.getElementById('area-strong')) document.getElementById('area-strong').innerText = best.n;
                if (document.getElementById('area-weak')) document.getElementById('area-weak').innerText = worst.n;
            }
        }

        function showThankYou() {
            document.getElementById('result-overlay').style.display = 'none';
            document.getElementById('ty-screen').style.display = 'flex';
        }

        // --- CLOUD HISTORY & REVIEW ---
        function openHistory() {
            const id = document.getElementById('username').value.trim();
            const list = document.getElementById('history-list');
            if (id.length < 4) { alert("Enter ID first."); return; }

            document.getElementById('history-modal').style.display = 'flex';
            list.innerHTML = `<div style="padding:30px; text-align:center;">üîÑ Loading Cloud Records...</div>`;

            fetch(SCRIPT_URL + "?type=history&id=" + encodeURIComponent(id))
                .then(r => r.json())
                .then(data => {
                    list.innerHTML = "";
                    const myData = data.filter(d => d.test === TEST_ID).reverse();
                    if (myData.length === 0) list.innerHTML = `<div class="hist-empty">No records found.</div>`;
                    else {
                        myData.forEach((rec, i) => {
                            list.innerHTML += `<div class="hist-item" onclick="loadCloudReview('${rec.resp || ""}')" style="cursor:pointer;">
                            <div class="h-left"><span class="h-title">Attempt #${myData.length - i}</span><span class="h-date">${rec.date}</span></div>
                            <div style="display:flex; align-items:center; gap:10px;"><span style="font-size:0.75rem; color:#2563eb; text-decoration:underline;">Review</span><div class="h-score-badge">${rec.score} Marks</div></div>
                        </div>`;
                        });
                    }
                })
                .catch(() => list.innerHTML = `<div style="padding:30px; text-align:center; color:red;">Connection Failed</div>`);
        }

        function closeHistory() { document.getElementById('history-modal').style.display = 'none'; }
        function loadCloudReview(respStr) {
            if (!respStr) { alert("Data unavailable."); return; }
            const arr = respStr.split(',').map(x => x === '' ? null : parseInt(x));
            closeHistory();
            document.getElementById('welcome-screen').style.display = 'none';
            renderResultScreen({ userResponses: arr });
        }
    </script>

</body>

</html>