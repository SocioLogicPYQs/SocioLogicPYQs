<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YOUR PYQ BATTLE</title>
    <style>
        :root {
            --brand-main: #2563eb;
            --brand-grad: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --bg-grad: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-light: #64748b;
            --success: #15803d;
            --danger: #b91c1c;
            --review: #7c3aed;
            --selected: #eff6ff;
            --radius: 16px;
            --shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-grad);
            color: var(--text-main);
            height: 100vh;
            height: 100dvh;
            /* Mobile Chrome Fix */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- 1. WELCOME SCREEN --- */
        #welcome-screen {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: white;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- UPDATED WELCOME SCREEN (Wider & Premium) --- */
        .welcome-card {
            background: white;
            width: 90%;
            /* Good for Mobile */
            max-width: 700px;
            /* Increased from 450px for Laptop (Wider look) */
            padding: 50px;
            /* More spacious "Grand" feel */
            border-radius: 24px;
            /* Softer corners */
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
            /* Deeper shadow */
            text-align: center;
            border: 1px solid #e2e8f0;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            /* Fixes layout alignment */
            flex-direction: column;
            align-items: center;
            /* Centers everything perfectly */
        }

        /* Ensure input fields don't stretch too ugly on the wide screen */
        .welcome-card .input-field {
            max-width: 500px;
            /* Keeps inputs looking neat */
            width: 100%;
        }

        /* Mobile Adjustment */
        @media(max-width: 600px) {
            .welcome-card {
                width: 95%;
                /* Maximize space on phone */
                padding: 30px 20px;
                /* Slightly tighter padding for small screens */
            }
        }

        .mode-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #64748b;
            font-weight: 600;
        }

        .mode-btn.active {
            border-color: #2563eb;
            background: #eff6ff;
            color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }

        /* --- SCORECARD GRID STYLES --- */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        .score-card-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            text-align: center;
        }

        .sc-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .sc-value {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1.1rem;
            outline: none;
            text-align: center;
            font-weight: 600;
            transition: 0.2s;
        }

        .input-field:focus {
            border-color: #2563eb;
        }

        #attempt-badge {
            display: inline-block;
            background: #fff7ed;
            color: #c2410c;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            border: 1px solid #ffedd5;
            margin-bottom: 20px;
        }

        /* --- 2. MAIN INTERFACE --- */
        #app-wrapper {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        /* Header */
        nav {
            background: var(--brand-grad);
            color: white;
            height: 64px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            z-index: 50;
            flex-shrink: 0;
        }

        .timer-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 8px;
            font-family: monospace;
            font-weight: 700;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
        }

        /* Main Area */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .main-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
        }

        .q-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            max-width: 900px;
            width: 100%;
            height: fit-content;
            border-top: 5px solid #2563eb;
            animation: slideUp 0.3s ease-out;
            margin-bottom: 40px;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .topic-tag {
            background: #eff6ff;
            color: #1e40af;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .q-text {
            font-size: 1.2rem;
            font-weight: 600;
            line-height: 1.6;
            color: var(--text-main);
            margin-bottom: 25px;
        }

        /* Options */
        .option {
            display: flex;
            align-items: flex-start;
            padding: 16px 20px;
            margin-bottom: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            line-height: 1.5;
        }

        .option:hover {
            border-color: #93c5fd;
            background: #f8fafc;
        }

        .option.selected {
            border-color: #2563eb;
            background: var(--selected);
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.1);
        }

        .option.selected .opt-key {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .option.review-marked {
            border-color: var(--review);
            background: #f5f3ff;
        }

        .option.review-marked .opt-key {
            background: var(--review);
            color: white;
            border-color: var(--review);
        }

        .opt-key {
            min-width: 32px;
            height: 32px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #64748b;
            margin-right: 15px;
            font-size: 0.9rem;
        }

        /* Sidebar (Desktop Default) */
        .sidebar {
            width: 340px;
            background: white;
            border-left: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            z-index: 40;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sb-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            overflow-y: auto;
            align-content: start;
        }

        .grid-btn {
            aspect-ratio: 1;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #64748b;
            background: white;
        }

        /* States */
        .st-curr {
            border-color: #2563eb;
            color: #2563eb;
            box-shadow: inset 0 0 0 2px #2563eb;
        }

        .st-ans {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .st-rev {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .st-ans-rev {
            background: var(--review);
            border-color: var(--review);
            color: white;
        }

        /* Footer */
        .footer-bar {
            height: 72px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 30;
            flex-shrink: 0;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            transition: 0.2s;
            white-space: nowrap;
        }

        .btn-pri {
            background: #1e40af;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.2);
        }

        .btn-sec {
            background: white;
            border: 2px solid #e2e8f0;
            color: #475569;
        }

        .btn-rev {
            background: #fffbeb;
            color: #b45309;
            border: 1px solid #fcd34d;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* --- PREMIUM MOBILE/TABLET ADAPTATION --- */
        /* Only activates when 'mobile-mode' class is on body */
        body.mobile-mode .sidebar {
            position: fixed;
            right: 0;
            top: 64px;
            bottom: 0;
            width: 85%;
            max-width: 320px;
            transform: translateX(100%);
            /* Hidden by default */
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.2);
        }

        body.mobile-mode .sidebar.active {
            transform: translateX(0);
        }

        /* Slide in */

        body.mobile-mode .main-area {
            padding: 15px;
        }

        body.mobile-mode .q-card {
            padding: 25px;
            border-radius: 12px;
        }

        /* Bigger Touch Targets for Mobile */
        body.mobile-mode .option {
            padding: 18px 15px;
            margin-bottom: 12px;
        }

        body.mobile-mode .btn {
            padding: 14px 18px;
            font-size: 1rem;
        }

        body.mobile-mode .footer-bar {
            height: 80px;
            padding: 0 15px;
        }

        /* Hide Text Labels on Mobile Footer if needed to fit */
        body.mobile-mode .btn-sec span {
            display: none;
        }

        body.mobile-mode .btn svg {
            display: block;
        }

        /* --- COMPACT RESULT CARD STYLES --- */
        /* --- UPDATED WIDTH FOR RESULT CARD --- */
        .res-card {
            background: #ffffff;
            width: 95%;
            /* Uses 95% screen width on Mobile */
            max-width: 900px;
            /* Increased from 500px to 900px for Laptop */
            max-height: 90vh;
            /* Keeps it fitting vertically */
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .res-header {
            background: var(--brand-grad);
            padding: 20px;
            /* Reduced padding */
            text-align: center;
            color: white;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .res-header h2 {
            font-size: 1.1rem;
            margin: 0 0 15px 0;
            opacity: 0.95;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* Compact Score Grid */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            /* 4 items in one row */
            gap: 8px;
            margin: 0;
        }

        .score-card-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 4px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            text-align: center;
        }

        .sc-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.85;
            margin-bottom: 3px;
            font-weight: 600;
        }

        .sc-value {
            font-size: 1.15rem;
            font-weight: 700;
            line-height: 1.1;
        }

        /* Result Body */
        .res-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            background: #f8fafc;
        }

        /* Analysis Boxes */
        .analysis-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .analysis-box {
            background: white;
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        }

        .ab-title {
            font-size: 0.7rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ab-val {
            font-size: 0.9rem;
            font-weight: 700;
            color: #334155;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- MISSING OVERLAY & EXPLANATION STYLES --- */
        .overlay {
            display: none;
            /* Hidden by default */
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.8);
            /* Dark background */
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        /* Explanation Feed Styling */
        .exp-row {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .exp-row.correct {
            border-left: 5px solid #16a34a;
        }

        .exp-row.wrong {
            border-left: 5px solid #dc2626;
        }

        .exp-detail {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            margin-top: 15px;
            padding-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .why-box {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #334155;
        }

        .txt-green {
            color: #16a34a;
            font-weight: 700;
        }

        .txt-red {
            color: #dc2626;
            font-weight: 700;
        }

        /* Mobile Tweak: Stack scores if screen is too small */
        @media(max-width: 400px) {
            .score-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* --- PREMIUM HISTORY MODAL --- */
        #history-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 250;
            background: rgba(15, 23, 42, 0.7);
            /* Darker blur */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.2s ease-out;
        }

        .history-card {
            background: white;
            width: 90%;
            max-width: 550px;
            max-height: 80vh;
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .hist-header {
            padding: 25px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hist-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1e293b;
            letter-spacing: -0.5px;
        }

        .hist-close {
            background: #fee2e2;
            color: #ef4444;
            border: none;
            padding: 8px 16px;
            border-radius: 99px;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.2s;
        }

        .hist-close:hover {
            background: #fecaca;
            transform: scale(1.05);
        }

        .hist-list {
            padding: 20px;
            overflow-y: auto;
            background: #f8fafc;
            flex: 1;
        }

        /* The Individual Attempt Card */
        .hist-item {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .hist-item:hover {
            transform: translateY(-3px);
            border-color: #3b82f6;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1);
        }

        .h-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .h-title {
            font-weight: 700;
            color: #334155;
            font-size: 1rem;
        }

        .h-date {
            font-size: 0.8rem;
            color: #94a3b8;
            font-weight: 500;
        }

        .h-score-badge {
            background: #eff6ff;
            color: #2563eb;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            border: 1px solid #dbeafe;
        }

        /* Empty State */
        .hist-empty {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
            font-style: italic;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media(max-width: 768px) {
            .analysis-row {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            /* Default hide on small screens until toggled */
            .sidebar.active {
                display: flex;
                position: fixed;
                right: 0;
                top: 64px;
                bottom: 0;
                width: 85%;
                transform: none;
                box-shadow: -10px 0 20px rgba(0, 0, 0, 0.2);
            }
        }


        /* --- NEW HEADER STYLES --- */
        .header-left-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-box {
            background: white;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .logo-box img {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
        }

        .candidate-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
            line-height: 1.2;
        }

        .candidate-name {
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            font-size: 20px;
            /* Bigger Font */
            font-weight: 700;
            /* Bold */
            margin: 0;
            letter-spacing: 0.5px;
            text-transform: capitalize;
        }

        .test-badge {
            color: rgba(255, 255, 255, 0.85);
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 2px;
        }

        /* --- GLOBAL WATERMARK --- */
        body::after {
            content: "";
            position: fixed;
            inset: 0;
            background-image: url('https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50vmin;
            opacity: 0.1;
            z-index: 9999;
            pointer-events: none;
            filter: grayscale(100%);
            mix-blend-mode: multiply;
        }

        /* --- IMPROVED THANK YOU SCREEN --- */
        .ty-card {
            background: white;
            width: 90%;
            max-width: 750px;
            /* Wider on Laptop for grandeur */
            padding: 60px 40px;
            /* Generous spacing for symmetry */
            text-align: center;
            border-radius: 30px;
            box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.4s ease-out;
        }

        .ty-header {
            font-size: 3.5rem;
            /* Very large, clear text */
            font-weight: 800;
            color: #0f172a;
            margin: 20px 0 15px 0;
            line-height: 1.1;
            letter-spacing: -1px;
        }

        .ty-msg {
            font-size: 1.4rem;
            /* Large, easy-to-read body text */
            color: #475569;
            line-height: 1.8;
            /* High readability */
            margin-bottom: 40px;
            max-width: 90%;
            /* Prevents text stretching too wide */
        }

        /* Mobile Adjustments */
        @media(max-width: 600px) {
            .ty-card {
                padding: 40px 20px;
            }

            .ty-header {
                font-size: 2.5rem;
            }

            /* Adjusted for phone screens */
            .ty-msg {
                font-size: 1.15rem;
                line-height: 1.6;
            }
        }

        /* --- RESUME NAVIGATION TOAST --- */
        .resume-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            /* Hidden initially */
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            border: 1px solid #e2e8f0;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 300px;
        }

        .resume-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .rt-text {
            font-size: 0.9rem;
            color: #1e293b;
            flex: 1;
        }

        .rt-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            white-space: nowrap;
        }

        .rt-close {
            background: #f1f5f9;
            color: #64748b;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>

<div id="instrOverlay" style="display:flex; position:fixed; inset:0; background:rgba(255,255,255,0.98); z-index:9999; align-items:center; justify-content:center; font-family:'Segoe UI', sans-serif;">
    <div style="width:100%; max-width:600px; background:white; padding:30px; border-radius:20px; box-shadow:0 25px 50px rgba(0,0,0,0.15); border:1px solid #e2e8f0; max-height:90vh; overflow-y:auto; margin:15px;">
        <div style="text-align:center; border-bottom:2px solid #eff6ff; padding-bottom:15px; margin-bottom:20px;">
            <h2 style="margin:0; color:#1e293b; font-size:22px;">üìú Instructions</h2>
            <p style="margin:5px 0 0; color:#64748b; font-size:14px;">Please read the marking scheme carefully</p>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:25px;">
            <div style="background:#f0fdf4; padding:15px; border-radius:12px; border:1px solid #bbf7d0; text-align:center;">
                <div style="color:#166534; font-size:12px; font-weight:700; text-transform:uppercase;">Correct Answer</div>
                <div style="font-size:24px; font-weight:800; color:#15803d;">+4</div>
            </div>
            <div style="background:#fef2f2; padding:15px; border-radius:12px; border:1px solid #fecaca; text-align:center;">
                <div style="color:#991b1b; font-size:12px; font-weight:700; text-transform:uppercase;">Incorrect Answer</div>
                <div style="font-size:24px; font-weight:800; color:#dc2626;">-1</div>
            </div>
        </div>

        <div style="background:#f8fafc; padding:20px; border-radius:12px; margin-bottom:25px; border:1px solid #e2e8f0;">
            <h3 style="margin:0 0 10px 0; font-size:16px; color:#334155;">üéÆ How to Submit:</h3>
            <ul style="margin:0; padding-left:20px; color:#475569; font-size:14px; line-height:1.6;">
                <li><strong>Smartphone Users:</strong> Use the <span style="color:#dc2626; font-weight:bold;">Red Submit Button</span> in the bottom footer.</li>
                <li><strong>Laptop Users:</strong> Click 'Submit Test' on the sidebar.</li>
                <li>You can review and change answers anytime before submitting.</li>
            </ul>
        </div>

        <button onclick="document.getElementById('instrOverlay').style.display='none'" style="width:100%; padding:16px; background:#2563eb; color:white; border:none; border-radius:12px; font-size:16px; font-weight:700; cursor:pointer; box-shadow:0 4px 12px rgba(37,99,235,0.2);">I am ready to begin ‚ûú</button>
    </div>
</div>

    <div id="welcome-screen">
        <div class="welcome-card">
            <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="SocioLogic"
                style="height: 120px; width: auto; display: inline-block;">

            <h1 style="color:#1e293b; margin:0; font-size:1.8rem; letter-spacing:-0.5px;">SUBTOPIC WISE PYQ </h1>
            <p style="color:#64748b; margin-top:5px; margin-bottom:20px;">Basic Concepts in Sociology Part 1</p>

            <div class="mode-selector">
                <div class="mode-btn active" onclick="setMode('desktop')" id="btn-desktop">
                    <span style="font-size:1.5rem">üíª</span>
                    <span style="font-size:0.9rem">Laptop/Tablet</span>
                </div>
                <div class="mode-btn" onclick="setMode('mobile')" id="btn-mobile">
                    <span style="font-size:1.5rem">üì±</span>
                    <span style="font-size:0.9rem">Mobile</span>
                </div>
            </div>

            <input type="text" id="candidateName" class="input-field" placeholder="Enter Your Name" autocomplete="off"
                style="margin-bottom:10px;">

            <input type="text" id="username" class="input-field" placeholder="Enter Registered Mobile" autocomplete="off">

            <div id="attempt-badge"
                style="margin-bottom:15px; font-size:0.85rem; color:#64748b; font-weight:600; padding:10px; border-radius:8px; background:#f1f5f9; border:1px solid #e2e8f0;">
                Waiting for Candidate ID...
            </div>
            <button id="start-btn" class="btn btn-pri"
                style="width:100%; justify-content:center; padding:15px; font-size:1.1rem;" onclick="startTest()">
                Start Examination ‚ûú
            </button>

            <button class="btn btn-sec" style="width:100%; justify-content:center; margin-top:10px;"
                onclick="openHistory()">
                üìú View Past Attempts
            </button>

            <div style="margin-top: 25px; border-top: 1px dashed #cbd5e1; padding-top: 20px;">
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 10px; font-weight:600;">New Student?</p>
                <a href="https://rzp.io/rzp/xddl5LdV" target="_blank" style="text-decoration: none;">
                    <button class="btn"
                        style="background: #10b981; color: white; width: 100%; justify-content: center; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);">
                        ‚ö° Buy Full Access at just (‚Çπ99)
                    </button>
                </a>
                <div style="font-size:0.75rem; color:#94a3b8; margin-top:5px;">Last 4 digits of your phone will be your
                    ID</div>
            </div>
        </div>
    </div>

    <div id="history-modal">
        <div class="history-card">
            <div class="hist-header">
                <span class="hist-title">üìú Past Attempts</span>
                <button class="hist-close" onclick="closeHistory()">Close</button>
            </div>
            <div id="history-list" class="hist-list"></div>
        </div>
    </div>

    <div id="app-wrapper">
        <nav>
            <div class="header-left-section">
                <div class="logo-box">
                    <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="Logo" />
                </div>
                <div class="candidate-details">
                    <h1 class="candidate-name" id="nav-user">Guest</h1>
                    <div class="test-badge">Basic Concepts in Sociology Part 1</div>
                </div>
            </div>
            <div class="timer-badge" id="timer">00:00:00</div>
            <button class="btn btn-sec" style="padding:8px;" onclick="toggleSidebar()" id="mob-menu">‚ò∞</button>
        </nav>

        <div class="container">
            <div class="main-area">
                <div class="q-card" id="q-panel"></div>
            </div>

            <aside class="sidebar" id="sidebar">
                <div
                    style="padding:15px; border-bottom:1px solid #e2e8f0; font-weight:700; color:#334155; display:flex; justify-content:space-between; align-items:center;">
                    <span>Question Map</span>
                    <span onclick="toggleSidebar()" style="cursor:pointer; font-size:1.2rem; display:none;"
                        id="mob-close-sb">‚úï</span>
                </div>
                <div class="sb-grid" id="palette"></div>
                <div style="padding:20px; border-top:1px solid #e2e8f0; margin-top:auto;">
                    <button class="btn btn-danger" style="width:100%; justify-content:center;"
                        onclick="finishTest()">SUBMIT TEST</button>
                </div>
            </aside>
        </div>

        <div class="footer-bar" style="padding:0 10px; gap:5px; height:auto; min-height:72px;">
        <div style="display:flex; gap:5px; flex:1;">
            <button class="btn btn-sec" onclick="clearResp()" style="flex:1; justify-content:center; padding:10px; font-size:0.8rem;">Clear</button>
            <button class="btn btn-rev" onclick="markReview()" id="btn-review" style="flex:1; justify-content:center; padding:10px; font-size:0.8rem;">üö© Review</button>
        </div>
        <div style="display:flex; gap:5px; flex:1.5;">
            <button class="btn btn-sec" onclick="nav(-1)" style="padding:10px;">Prev</button>
            <button class="btn btn-pri" onclick="nav(1)" id="btn-next" style="flex:1; justify-content:center; padding:10px; font-size:0.9rem;">Next ‚ûú</button>
            <button class="btn btn-danger" onclick="finishTest()" style="padding:10px; background:#dc2626; color:white;">Submit</button>
        </div>
    </div>
    </div>

    <div class="overlay" id="result-overlay">
        <div class="res-card">
            <div class="res-header">
                <h2>Assessment Report</h2>
                <div class="score-grid">
                    <div class="score-card-item">
                        <div class="sc-label">Attempted</div>
                        <div class="sc-value" id="disp-att">0</div>
                    </div>
                    <div class="score-card-item"
                        style="background: rgba(220, 252, 231, 0.25); border-color: rgba(220, 252, 231, 0.5);">
                        <div class="sc-label" style="color:#dcfce7;">Correct</div>
                        <div class="sc-value" style="color:#f0fdf4;" id="disp-cor">0</div>
                    </div>
                    <div class="score-card-item"
                        style="background: rgba(254, 226, 226, 0.25); border-color: rgba(254, 226, 226, 0.5);">
                        <div class="sc-label" style="color:#fee2e2;">Wrong</div>
                        <div class="sc-value" style="color:#fef2f2;" id="disp-wro">0</div>
                    </div>
                    <div class="score-card-item">
                        <div class="sc-label">Score</div>
                        <div class="sc-value" id="disp-score">0</div>
                    </div>
                </div>

                <button onclick="showThankYou()" style="margin-top:15px; width:100%; padding:10px; background:#ffffff; color:#1e40af; border:none; border-radius:8px; font-weight:800; cursor:pointer; font-size:0.9rem; box-shadow:0 4px 6px rgba(0,0,0,0.1); transition:transform 0.2s;">
                    Exit & Save Report ‚ûú
                </button>
            </div>

            <div class="res-body">

            <div class="analysis-row">
                    <div class="analysis-box" style="border-left:4px solid #15803d;">
                        <div class="ab-title" style="color:#15803d">üí™ Strongest</div>
                        <div class="ab-val" id="area-strong">--</div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:3px;" id="area-strong-stat">Acc: 0%
                        </div>
                    </div>
                    <div class="analysis-box" style="border-left:4px solid #b91c1c;">
                        <div class="ab-title" style="color:#b91c1c">‚ö†Ô∏è Weakest</div>
                        <div class="ab-val" id="area-weak">--</div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:3px;" id="area-weak-stat">Acc: 0%</div>
                    </div>
                </div>

                <h3
                    style="font-size:0.95rem; font-weight:700; color:#0f172a; margin-bottom:15px; border-bottom:1px solid #e2e8f0; padding-bottom:8px;">
                    Detailed Explanations
                </h3>

                <div id="solution-feed"></div>

                <div style="text-align:center; margin-top:25px;">
                    <button class="btn btn-pri" style="width:100%; justify-content:center; padding:12px;"
                        onclick="showThankYou()">
                        Exit & Save Report
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="overlay" id="ty-screen">
        <div class="ty-card">

            <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="SocioLogic"
                style="height: 140px; width: auto; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 50%;">

            <h1 class="ty-header">Test Submitted!</h1>

            <p class="ty-msg">
                Your performance on <b style="color:#1e40af;">SocioLogic</b> has been recorded.<br>
                You are one step closer to your <b style="color:#d97706;">DREAM UNIVERSITY</b>.
            </p>

            <a href="https://t.me/SocioLogicPYQs" target="_blank"
                style="text-decoration:none; width: 100%; max-width: 400px;">
                <button class="btn btn-pri"
                    style="width:100%; justify-content:center; padding: 16px; font-size: 1.1rem; border-radius: 12px; background: #0088cc;">
                    ‚úàÔ∏è Join Telegram Channel
                </button>
            </a>

            <div style="display: flex; gap: 15px; width: 100%; max-width: 500px; margin-top: 25px; flex-wrap: wrap;">

                <button class="btn btn-sec" onclick="location.reload()"
                    style="flex: 1; min-width: 200px; justify-content: center; padding: 16px; border-radius: 12px; font-weight: 700; border: 2px solid #e2e8f0; color: #475569;">
                    üîÑ View Current Page
                </button>

                <a href="index.html" style="text-decoration: none; flex: 1; min-width: 200px;">
                    <button class="btn btn-pri"
                        style="width: 100%; justify-content: center; padding: 16px; border-radius: 12px; background: #0f172a; color: white; font-weight: 700; box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2);">
                        View Main Page
                    </button>
                </a>

            </div>
        </div>
    </div>
    <script>
        /* -------------------------------------------------------------
           PASTE YOUR QUESTION DATA HERE
           const questions = [ ... ];
        ------------------------------------------------------------- */
        const questions = [



            {
                topic: "Sociology Definition",
                text: "Who said society is a web of social relationship?",
                options: ["MacIver", "Max Weber", "Karl Marx", "Herbert Spencer"],
                correct: 0,
                expl: {
                    correct: "R.M. MacIver defined society as a 'web of social relationships' in his work 'Society: An Introductory Analysis'.",
                    others: "Weber focused on social action; Marx on class conflict; Spencer on social evolution.",
                    trick: "MacIver = Web (Spider Mac)."
                }
            },
            {
                topic: "Sociological Imagination",
                text: "Who among the following authored Sociological Imaginations?",
                options: ["C.W. Mills", "V. Pareto", "R.K. Merton", "Edward Tylor"],
                correct: 0,
                expl: {
                    correct: "C. Wright Mills coined the term 'Sociological Imagination' to describe the ability to connect personal troubles with public issues.",
                    others: "Pareto is known for circulation of elites; Merton for functionalism; Tylor for culture.",
                    trick: "Mills = Mills of the mind (Imagination)."
                }
            },
            {
                topic: "Social Groups",
                text: "Who among the following classified groups into in-groups and out-groups?",
                options: ["C.H. Cooley", "W.H. Sumner", "R.K. Merton", "Ferdinand Tonnies"],
                correct: 1,
                expl: {
                    correct: "William Graham Sumner introduced the distinction between in-groups (we-groups) and out-groups (they-groups) in his book 'Folkways'.",
                    others: "Cooley gave primary/secondary groups; Tonnies gave Gemeinschaft/Gesellschaft.",
                    trick: "Sumner = Sum of 'us' vs 'them'."
                }
            },
            {
                topic: "Social Distance",
                text: "Who gave the concept of Social Distance?",
                options: ["W.G. Sumner", "R.K. Merton", "Bogardus", "Veblen"],
                correct: 2,
                expl: {
                    correct: "Emory S. Bogardus developed the Social Distance Scale to measure the perceived willingness of people to interact with members of different groups.",
                    others: "Veblen is famous for 'Conspicuous Consumption'.",
                    trick: "Bogardus = Barometer of Distance."
                }
            },
            {
                topic: "Status and Role",
                text: "________________ is a socially defined position in a society.",
                options: ["Role", "Status", "Norm", "Institution"],
                correct: 1,
                expl: {
                    correct: "Status is a static position in the social structure, whereas Role is the dynamic aspect (behavior) associated with that position.",
                    others: "Norms are rules; Institutions are systems of norms.",
                    trick: "Status = Standing (Position)."
                }
            },
            {
                topic: "Role Strain",
                text: "The difficulty people face in meeting their role obligations is called :",
                options: ["Status Inconsistency", "Role Conflict", "Role Strain", "Role Failure"],
                correct: 2,
                expl: {
                    correct: "Role Strain occurs when there are conflicting demands within a single role. Role Conflict implies incompatible demands between two different roles.",
                    others: "Status Inconsistency is a mismatch between different status markers (e.g., high education, low income).",
                    trick: "Strain = Same role stress."
                }
            },
            {
                topic: "Culture Definition",
                text: "Who defined culture as 'the sum total of knowledge, belief, art morals, law, customs and any other capabilities and habits acquired by man as a member of society.'",
                options: ["Makinowski", "Spencer", "Tylor", "Radcliffe Brown"],
                correct: 2,
                expl: {
                    correct: "Edward Burnett Tylor gave this classic definition of Culture in his book 'Primitive Culture' (1871).",
                    others: "The option 'Makinowski' is a misspelling of Malinowski found in the source text.",
                    trick: "Tylor = Total (Sum total definition)."
                }
            },
            {
                topic: "Socialization",
                text: "Name the life long process through which an individual acquires a sense of identity and becomes a member of society.",
                options: ["Sanskritization", "Globalization", "Socialization", "Colonization"],
                correct: 2,
                expl: {
                    correct: "Socialization is the process of internalizing the norms and ideologies of society, enabling participation in social life.",
                    others: "Sanskritization is a specific mobility process in India; Globalization is economic/cultural integration.",
                    trick: "Socialization = Society-ization (Becoming a member)."
                }
            },
            {
                topic: "Mead's Socialization",
                text: "Which of the following does not belong to G.H. Mead's conception of Socialization?",
                options: ["Play Stage", "Game Stage", "Role Taking", "Adolescence"],
                correct: 3,
                expl: {
                    correct: "Mead's theory of the self involves the Preparatory, Play, and Game stages. Adolescence is a general life stage, not a specific component of Mead's theoretical model.",
                    others: "Play and Game stages are central to Mead's development of the 'Me'.",
                    trick: "Mead didn't study teenagers (Adolescence)."
                }
            },
            {
                topic: "Institutions",
                text: "Which of the following is not a characteristic of an Institution?",
                options: ["It is a system of norms", "It meets certain basic needs", "It comprises of a group of people", "Ideologies or values"],
                correct: 2,
                expl: {
                    correct: "In sociology, an Institution is a system of established procedures/norms (e.g., Marriage, Law), not the group of people itself (which is an Association).",
                    others: "Institutions are defined by norms, satisfy needs, and embody values.",
                    trick: "Institution = Rules; Association = People."
                }
            },
            {
                topic: "Association vs Institution",
                text: "Which of the following does not include members?",
                options: ["Association", "Group", "Community", "Institution"],
                correct: 3,
                expl: {
                    correct: "An Institution (like marriage or education) is a set of rules/norms. It does not have members; Associations (like a club or political party) have members.",
                    others: "Groups and Communities consist of people (members).",
                    trick: "You belong to a College (Association), you follow Education (Institution)."
                }
            },
            {
                topic: "Rural-Urban Continuum",
                text: "Who coined the concept of Rural-Urban Continuum?",
                options: ["Robert Redfield", "E. Burgess", "Lewis Wirth", "Robert Park"],
                correct: 0,
                expl: {
                    correct: "Robert Redfield introduced the Rural-Urban Continuum to describe the gradual transition from folk to urban societies.",
                    others: "Wirth wrote 'Urbanism as a Way of Life'; Burgess is known for the Concentric Zone model.",
                    trick: "Redfield = Field (Rural) to City."
                }
            },
            {
                topic: "Comte's Stages",
                text: "Which is not true matched example with respect to August Comte's theory of intellectual development in stages?",
                options: ["Theological stage - example of church in the middle age", "Metaphysical Stage-Example of the enlightenment era and the philosophical ideas", "Metaphysical Stage- how world is explained in terms of gods, spirits, and magic", "Scientific Stage-it began with the work of early scientists (astronomer, physicist)"],
                correct: 2,
                expl: {
                    correct: "Explaining the world via gods, spirits, and magic characterizes the Theological Stage, not the Metaphysical Stage.",
                    others: "The Metaphysical stage relies on abstract forces/philosophy.",
                    trick: "Gods = Theology, not Metaphysics."
                }
            },
            {
                topic: "Durkheim Solidarity",
                text: "What is E.Durkheim's organic solidarity?",
                options: ["It has a form of simplicity and similarity within society", "It is unspecialized, original", "It is very complex and diverse", "It is based on collective conscience that helps for societal cooperation"],
                correct: 2,
                expl: {
                    correct: "Organic Solidarity arises in modern, industrial societies characterized by high division of labor, complexity, and difference (interdependence).",
                    others: "Simplicity and strong collective conscience are features of Mechanical Solidarity.",
                    trick: "Organic = Organism (Complex parts working together)."
                }
            },
            {
                topic: "Anomie",
                text: "The concept Anomie popularised by Durkheim was introduced in his book________.",
                options: ["The Division of Labour in the Society", "Suicide", "The Rules of Sociological Method", "The Elementary Forms of Religious Life"],
                correct: 0,
                expl: {
                    correct: "Durkheim first introduced Anomie in 'The Division of Labour in Society' (1893) to describe deregulation during rapid social change.",
                    others: "He famously applied it to suicide later, but the *introduction* was in Division of Labour.",
                    trick: "Anomie arrived with the Division of Labor."
                }
            },
            {
                topic: "Weber's Status",
                text: "Which is true about status dimension of stratification as explained by Max Weber?",
                options: ["Unlike classes, status groups are communities", "Status grouping does not explain one's social prestige and social power", "Community of individuals who does not share common style of life and prestige", "Status groups cannot compete, coexist and overlap with class-base groupings"],
                correct: 0,
                expl: {
                    correct: "Weber argued that while classes are economic aggregates, status groups are normally communities held together by a common lifestyle and social honor.",
                    others: "Status is defined specifically by social prestige and lifestyle.",
                    trick: "Status = Style & Community."
                }
            },
            {
                topic: "Sociology as Science",
                text: "Sociology is a science because:",
                options: ["The theories are supported by empirical evidence.", "Sociologist collects data in an objective and empirical manner", "All new findings are shared and scrutinized by a community of sociologists and researchers.", "All of the above"],
                correct: 3,
                expl: {
                    correct: "Sociology uses scientific methods including empirical observation, objectivity, and peer review.",
                    others: "All listed options are hallmarks of the scientific method.",
                    trick: "Science = Evidence + Objectivity."
                }
            },
            {
                topic: "Concept of Ethnos",
                text: "What is the meaning of 'ethnos'?",
                options: ["Ethnicity", "Nation", "Ethnic Group", "Nationhood"],
                correct: 1,
                expl: {
                    correct: "The root word 'ethnos' (Greek) refers to a people, nation, or class of people.",
                    others: "It is the etymological root of ethnicity, but strictly means 'people' or 'nation'.",
                    trick: "Ethnos = People/Nation."
                }
            },
            {
                topic: "Restitutive Law",
                text: "What is restitutive law according to Durkheim?",
                options: ["It reflects a solidarity that implies that individuals resemble each other.", "It is civil law and restores back to normal", "It does not allows individuals to maintain their rights", "It punishes those who deviate from common conscience"],
                correct: 1,
                expl: {
                    correct: "Restitutive law aims to restore the status quo (return things to how they were) and is typical of Organic Solidarity.",
                    others: "Punishing deviation (Repressive law) is typical of Mechanical Solidarity.",
                    trick: "Restitutive = Restore."
                }
            },
            {
                topic: "Alienation",
                text: "According Marx alienation from the product means",
                options: ["Workers do not own what they produce", "Workers what produce is not owned by the Capitalists", "Disconnecting workers from their true human essence", "Workers do not contribute toward profit for Capitalist growth"],
                correct: 0,
                expl: {
                    correct: "Alienation from the product occurs because the worker creates the object, but it is owned and disposed of by the capitalist, confronting the worker as an alien power.",
                    others: "Option C is alienation from species-being; Marx identifies 4 types of alienation total.",
                    trick: "Product isn't yours = Alienation from product."
                }
            },
            {
                topic: "Environment Etymology",
                text: "The word environment is derived from which of the following language ?",
                options: ["English", "French", "German", "Portuguese"],
                correct: 1,
                expl: {
                    correct: "It is derived from the French word 'Environner', meaning to encircle or surround.",
                    others: "Logic: Many academic English terms come from French/Latin.",
                    trick: "Environment = Environs (French)."
                }
            },
            {
                topic: "Kinship & Property",
                text: "In which type of inheritance women have right over property ?",
                options: ["Mitakhshara", "Illom", "Daya Bhag", "Tarwad"],
                correct: 3,
                expl: {
                    correct: "Tarwad is the matrilineal joint family system of the Nayars in Kerala, where descent and property pass through the female line.",
                    others: "Mitakhshara and Dayabhaga are generally patrilineal Hindu legal schools.",
                    trick: "Tarwad = Matrilineal (Women own)."
                }
            },
            {
                topic: "Matrilineal Authority",
                text: "The eldest member of the Tarwad entrusted with the management of the property is known as________.",
                options: ["Patriarch", "Matriarch", "Karta", "Karnavan"],
                correct: 3,
                expl: {
                    correct: "The Karnavan is the senior male (mother's brother) who manages the property in a matrilineal Tarwad, despite the descent being female.",
                    others: "Karta is the head of the North Indian Joint Family.",
                    trick: "Kerala = Karnavan."
                }
            },
            {
                topic: "Hindu Marriage",
                text: "Who defines Hindu marriage as a religious sacrament ?",
                options: ["R.N. Sharma", "K.M. Kapadia", "P.N. Prabhu", "Iravati Karve"],
                correct: 1,
                expl: {
                    correct: "K.M. Kapadia, in 'Marriage and Family in India', emphasized Hindu marriage as a sacrament (Sanskara), not a contract.",
                    others: "Iravati Karve is famous for Kinship organization.",
                    trick: "Kapadia = Kanyadaan (Sacrament)."
                }
            },
            {
                topic: "Sorokin's Change",
                text: "Which one of the following types of culture P.A. Sorokin explains in his cyclical theory of social change ?",
                options: ["Ideational, Idealist and Sensate", "Ideational, Instrumental and Ethical", "Idealist, Moral and Sensate", "Idealist, Ethical and Modern"],
                correct: 0,
                expl: {
                    correct: "Sorokin classified cultures into three types based on their value systems: Ideational (spiritual), Sensate (material), and Idealist (mixed).",
                    others: "These are the specific terms used in his book 'Social and Cultural Dynamics'.",
                    trick: "Sorokin saw the pendulum swing between Idea and Sense."
                }
            },
        ];

        //
        // 'Basic Concept 1';

        // --- SECURITY CONFIGURATION ---
        // 1. PASTE YOUR GOOGLE SCRIPT URL HERE:
        // 1. PASTE YOUR GOOGLE SCRIPT URL HERE (From your Deployment):
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxLOznQI6LSDWDsM5IvSJxKDpYUQNmM1dzB1VSQns2tkSs4k4d9FxhbF3Za1K-vkEMdIg/exec";

        // 2. UNIQUE NAME FOR THIS SPECIFIC TEST (Demand #3)
        // Change this string for every new HTML file you create (e.g., "History_2025", "Mock_01")
        const TEST_ID = "Basic Concepts in Sociology Part 1";

        // 2. SETTINGS
        const MAX_ATTEMPTS = 5;
        const SECONDS_PER_QUESTION = 72;

        // 3. VARIABLES
        let responses = new Array(questions.length).fill(null);
        let status = new Array(questions.length).fill(0);
        let timeLeft = questions.length * SECONDS_PER_QUESTION;
        let timerRef, checkTimer, isMobile;
        let userName = "Student";
        let history = []; // Local session history

        // --- INITIALIZATION ---
        window.onload = function () {
            isMobile = window.innerWidth < 768;
            if (isMobile) setMode('mobile'); else setMode('desktop');

            document.getElementById('timer').innerText = formatTime(timeLeft);

            // Listeners
            document.getElementById('candidateName').addEventListener('input', checkStartConditions);
            document.getElementById('username').addEventListener('keyup', handleIdInput);

            // Auto-Fill from Dashboard
            const savedID = localStorage.getItem('socio_user_id');
            const savedName = localStorage.getItem('socio_user_name');
            if (savedID) {
                document.getElementById('username').value = savedID;
                document.getElementById('candidateName').value = savedName || "";
                handleIdInput();
            }

            // FEATURE: Guest Hint & Placeholder for Free Tests
            if (typeof TEST_ID !== 'undefined' && TEST_ID.toUpperCase().startsWith("FREE")) {
                const idBox = document.getElementById('username');
                idBox.placeholder = "Enter ID: SocioLogic";

                // Avoid duplicate hint if already exists
                if (!idBox.parentNode.querySelector('.guest-hint')) {
                    const hint = document.createElement("div");
                    hint.className = "guest-hint";
                    hint.innerHTML = "üí° <b>Guest Access:</b> Type <span style='color:#2563eb; font-weight:800;'>SocioLogic</span>";
                    hint.style.cssText = "font-size:0.85rem; color:#64748b; margin:-10px 0 15px 0; background:#eff6ff; padding:8px; border-radius:8px; border:1px dashed #bfdbfe;";
                    idBox.parentNode.insertBefore(hint, idBox.nextSibling);
                }
            }
        };

        function formatTime(s) {
            let h = Math.floor(s / 3600).toString().padStart(2, '0');
            let m = Math.floor((s % 3600) / 60).toString().padStart(2, '0');
            let sec = (s % 60).toString().padStart(2, '0');
            return `${h}:${m}:${sec}`;
        }

        function setMode(mode) {
            isMobile = (mode === 'mobile');
            const dBtn = document.getElementById('btn-desktop');
            const mBtn = document.getElementById('btn-mobile');
            if (dBtn && mBtn) {
                dBtn.className = isMobile ? 'mode-btn' : 'mode-btn active';
                mBtn.className = isMobile ? 'mode-btn active' : 'mode-btn';
            }
        }

        // --- ID CHECK (RESTORED MAGIC FIX) ---
        function handleIdInput() {
            const idVal = document.getElementById('username').value.trim();
            const badge = document.getElementById('attempt-badge');
            const btn = document.getElementById('start-btn');

            // Disable button while typing
            btn.disabled = true;
            btn.style.backgroundColor = "#cbd5e1";
            btn.style.cursor = "not-allowed";

            clearTimeout(checkTimer);

            // 1. Basic Length Check
            if (idVal.length < 10 && idVal.toUpperCase() !== "SOCIOLOGIC") {
                badge.innerHTML = "Enter 10-digit Mobile...";
                badge.style.background = "#f1f5f9"; badge.style.color = "#64748b"; badge.style.borderColor = "#e2e8f0";
                return;
            }

            // --- MAGIC FIX: IMMEDIATE UNLOCK FOR FREE TESTS ---
            if (typeof TEST_ID !== 'undefined' && TEST_ID.toUpperCase().startsWith("FREE")) {
                badge.innerHTML = `‚úÖ <b>Free Access:</b> Unlimited Attempts Allowed`;
                badge.style.background = "#dcfce7"; badge.style.color = "#15803d"; badge.style.borderColor = "#86efac";
                checkStartConditions(); // Unlock immediately
                return;
            }
            // --------------------------------------------------

            // 2. Paid Tests: Check Cloud
            badge.innerHTML = "üîÑ Checking Cloud Records...";
            badge.style.background = "#fffbeb"; badge.style.color = "#d97706";

            checkTimer = setTimeout(() => {
                fetch(SCRIPT_URL + "?type=check&id=" + encodeURIComponent(idVal) + "&test=" + encodeURIComponent(TEST_ID))
                    .then(res => res.text())
                    .then(data => {
                        if (data === "BLOCK_NOT_PAID") {
                            badge.innerHTML = "‚õî <b>ID Not Authorized.</b> Please buy access.";
                            badge.style.background = "#fee2e2"; badge.style.color = "#b91c1c"; badge.style.borderColor = "#fecaca";
                        } else {
                            const used = parseInt(data) || 0;
                            if (used >= MAX_ATTEMPTS) {
                                badge.innerHTML = `‚ö†Ô∏è <b>Limit Reached</b> (Used: ${used}/${MAX_ATTEMPTS})`;
                                badge.style.background = "#fee2e2"; badge.style.color = "#b91c1c"; badge.style.borderColor = "#fecaca";
                            } else {
                                badge.innerHTML = `‚úÖ <b>Attempt ${used + 1} Available</b> (${MAX_ATTEMPTS - used} left)`;
                                badge.style.background = "#dcfce7"; badge.style.color = "#15803d"; badge.style.borderColor = "#86efac";
                                checkStartConditions();
                            }
                        }
                    })
                    .catch(() => {
                        badge.innerHTML = "‚ùå Network Error";
                        // Fallback: Allow start if network fails? Better to block to prevent bypass.
                    });
            }, 800);
        }

        function checkStartConditions() {
            const name = document.getElementById('candidateName').value.trim();
            const id = document.getElementById('username').value.trim();
            const badgeText = document.getElementById('attempt-badge').innerText;
            const btn = document.getElementById('start-btn');

            if (name.length > 0 && id.length >= 4 && (badgeText.includes("‚úÖ") || badgeText.includes("Unlimited"))) {
                btn.disabled = false;
                btn.style.backgroundColor = "#2563eb";
                btn.style.cursor = "pointer";
                btn.innerText = "Start Examination ‚ûú";
            }
        }

        // --- START TEST (TRACKING) ---
        function startTest() {
            const nameVal = document.getElementById('candidateName').value.trim();
            const idVal = document.getElementById('username').value.trim();

            userName = nameVal;
            document.getElementById('nav-user').innerText = userName.split(' ')[0];

            // Track Attempt (Only if NOT Free/Guest)
            if (!TEST_ID.toUpperCase().startsWith("FREE")) {
                fetch(SCRIPT_URL + "?type=track&id=" + encodeURIComponent(idVal) + "&test=" + encodeURIComponent(TEST_ID) + "&name=" + encodeURIComponent(nameVal));
            }

            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'flex';

            if (isMobile) {
                document.body.classList.add('mobile-mode');
                document.getElementById('mob-menu').style.display = 'block';
                document.getElementById('mob-close-sb').style.display = 'block';
            } else {
                document.body.classList.remove('mobile-mode');
                document.getElementById('mob-menu').style.display = 'none';
            }

            initTest();
        }

        // --- TEST ENGINE ---
        let current = 0;
        function initTest() {
            renderQ(0);
            renderPalette();
            clearInterval(timerRef);
            timerRef = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = formatTime(timeLeft);
                if (timeLeft <= 0) finishTest();
            }, 1000);
        }

        function renderQ(idx) {
            current = idx;
            const q = questions[idx];
            if (status[idx] === 0) { status[idx] = 1; renderPalette(); }

            const optionsHtml = q.options.map((opt, i) => {
                const isSelected = responses[idx] === i;
                let cls = isSelected ? 'option selected' : 'option';
                if (status[idx] === 4 && isSelected) cls += ' review-marked';

                return `<div class="${cls}" onclick="selectOpt(${i})">
                <div class="opt-key">${String.fromCharCode(65 + i)}</div>
                <div style="flex:1">${opt}</div>
            </div>`;
            }).join('');

            document.getElementById('q-panel').innerHTML = `
            <div class="q-header"><span class="topic-tag">${q.topic}</span><span>Q.${idx + 1}/${questions.length}</span></div>
            <div class="q-text">${q.text}</div>
            <div>${optionsHtml}</div>`;
        }

        function selectOpt(i) {
            responses[current] = i;
            status[current] = (status[current] >= 3) ? 4 : 2;
            renderQ(current); renderPalette();
        }

        function nav(d) {
            let next = current + d;
            if (next >= 0 && next < questions.length) renderQ(next);
        }

        function renderPalette() {
            document.getElementById('palette').innerHTML = questions.map((_, i) => {
                let cls = 'grid-btn';
                if (i === current) cls += ' st-curr';
                if (status[i] === 2) cls += ' st-ans';
                else if (status[i] === 3) cls += ' st-rev';
                else if (status[i] === 4) cls += ' st-ans-rev';
                return `<div class="${cls}" onclick="renderQ(${i})">${i + 1}</div>`;
            }).join('');
        }

        function markReview() {
            status[current] = (responses[current] !== null) ? 4 : 3;
            renderPalette(); nav(1);
        }

        function clearResp() { responses[current] = null; status[current] = 1; renderQ(current); renderPalette(); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

        // --- SUBMIT & SYNC ---
        function finishTest() {
            clearInterval(timerRef);
            let s = 0, c = 0, w = 0;
            responses.forEach((ans, i) => {
                if (ans === questions[i].correct) { s += 4; c++; }
                else if (ans !== null && ans !== undefined) { s -= 1; w++; }
            });

            const id = document.getElementById('username').value.trim();
            const name = document.getElementById('candidateName').value.trim();

            // Show Result Immediately
            renderResultScreen({ userResponses: [...responses] });

            // Cloud Sync (Skip if Free Test & using dummy ID)
            if (!TEST_ID.toUpperCase().startsWith("FREE") || id.toUpperCase() !== "SOCIOLOGIC") {
                const resStr = responses.map(r => (r === null || r === undefined) ? '' : r).join(",");
                const url = SCRIPT_URL + "?type=submit&id=" + encodeURIComponent(id) + "&test=" + encodeURIComponent(TEST_ID) + "&score=" + s + "&name=" + encodeURIComponent(name) + "&resp=" + encodeURIComponent(resStr);
                fetch(url, { mode: 'no-cors' });
            }
        }

        // --- ANALYSIS SCREEN ---
        function renderResultScreen(data) {
            let s = 0, c = 0, w = 0, att = 0;
            const resps = data.userResponses || [];

            questions.forEach((q, i) => {
                const ans = resps[i];
                if (ans !== null && ans !== undefined) {
                    att++;
                    if (ans === q.correct) { s += 4; c++; } else { s -= 1; w++; }
                }
            });

            const max = questions.length * 4;

            // Update DOM
            if (document.getElementById('disp-att')) document.getElementById('disp-att').innerText = `${att}/${questions.length}`;
            if (document.getElementById('disp-cor')) document.getElementById('disp-cor').innerText = c;
            if (document.getElementById('disp-wro')) document.getElementById('disp-wro').innerText = w;
            if (document.getElementById('disp-score')) document.getElementById('disp-score').innerText = `${s}/${max}`;

            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('app-wrapper').style.display = 'none';
            document.getElementById('result-overlay').style.display = 'flex';

            // Analysis Feed
            const feed = document.getElementById('solution-feed');
            if (feed) {
                let html = "", topicStats = {};
                questions.forEach((q, i) => {
                    const ans = resps[i], isCor = (ans === q.correct);
                    if (!topicStats[q.topic]) topicStats[q.topic] = { t: 0, c: 0 };
                    topicStats[q.topic].t++; if (isCor) topicStats[q.topic].c++;

                    let statusIcon = isCor ? '<span class="txt-green">‚úì Correct</span>' : (ans !== null && ans !== undefined ? '<span class="txt-red">‚úï Incorrect</span>' : '<span>‚óã Skipped</span>');
                    let rowClass = isCor ? 'correct' : (ans !== null && ans !== undefined ? 'wrong' : '');

                    const opts = q.options.map((opt, idx) => {
                        let style = "padding:8px 12px; border-radius:8px; margin-bottom:5px; border:1px solid #e2e8f0; background:#f8fafc; color:#64748b;";
                        if (idx === q.correct) style = "padding:8px; border-radius:8px; margin-bottom:5px; border:1px solid #bbf7d0; background:#dcfce7; color:#166534; font-weight:600;";
                        else if (idx === ans && !isCor) style = "padding:8px; border-radius:8px; margin-bottom:5px; border:1px solid #fecaca; background:#fee2e2; color:#991b1b; font-weight:600;";
                        return `<div style="${style}"><b>${String.fromCharCode(65 + idx)}.</b> ${opt}</div>`;
                    }).join('');

                    html += `<div class="exp-row ${rowClass}">
                    <div style="display:flex; justify-content:space-between; font-weight:700;">
                        <span style="color:#64748b; font-size:0.8rem">${q.topic}</span>${statusIcon}
                    </div>
                    <div style="font-weight:600; margin:10px 0;">Q${i + 1}: ${q.text}</div>
                    <div style="margin-bottom:20px; font-size:0.95rem;">${opts}</div>
                    <div class="exp-detail">
                        <div class="why-box"><span class="txt-green">‚úÖ Solution:</span> ${q.expl.correct}</div>
                        <div class="why-box"><span class="txt-red">‚ùå Error Analysis:</span> ${q.expl.others}</div>
                        <div style="background:#fffbeb; padding:10px; border:1px dashed #f59e0b; border-radius:8px; margin-top:8px;">üí° <b>Trick:</b> ${q.expl.trick}</div>
                    </div>
                </div>`;
                });
                feed.innerHTML = html;

                // Weak/Strong
                let best = { n: '-', v: -1 }, worst = { n: '-', v: 101 };
                for (let t in topicStats) {
                    let acc = (topicStats[t].c / topicStats[t].t) * 100;
                    if (acc > best.v) best = { n: t, v: acc };
                    if (acc < worst.v) worst = { n: t, v: acc };
                }
                if (document.getElementById('area-strong')) document.getElementById('area-strong').innerText = best.n;
                if (document.getElementById('area-weak')) document.getElementById('area-weak').innerText = worst.n;
            }
        }

        function showThankYou() {
            document.getElementById('result-overlay').style.display = 'none';
            document.getElementById('ty-screen').style.display = 'flex';
        }

        // --- CLOUD HISTORY & REVIEW ---
        function openHistory() {
            const id = document.getElementById('username').value.trim();
            const list = document.getElementById('history-list');
            if (id.length < 4) { alert("Enter ID first."); return; }

            document.getElementById('history-modal').style.display = 'flex';
            list.innerHTML = `<div style="padding:30px; text-align:center;">üîÑ Loading Cloud Records...</div>`;

            fetch(SCRIPT_URL + "?type=history&id=" + encodeURIComponent(id))
                .then(r => r.json())
                .then(data => {
                    list.innerHTML = "";
                    const myData = data.filter(d => d.test === TEST_ID).reverse();
                    if (myData.length === 0) list.innerHTML = `<div class="hist-empty">No records found.</div>`;
                    else {
                        myData.forEach((rec, i) => {
                            list.innerHTML += `<div class="hist-item" onclick="loadCloudReview('${rec.resp || ""}')" style="cursor:pointer;">
                            <div class="h-left"><span class="h-title">Attempt #${myData.length - i}</span><span class="h-date">${rec.date}</span></div>
                            <div style="display:flex; align-items:center; gap:10px;"><span style="font-size:0.75rem; color:#2563eb; text-decoration:underline;">Review</span><div class="h-score-badge">${rec.score} Marks</div></div>
                        </div>`;
                        });
                    }
                })
                .catch(() => list.innerHTML = `<div style="padding:30px; text-align:center; color:red;">Connection Failed</div>`);
        }

        function closeHistory() { document.getElementById('history-modal').style.display = 'none'; }
        function loadCloudReview(respStr) {
            if (!respStr) { alert("Data unavailable."); return; }
            const arr = respStr.split(',').map(x => x === '' ? null : parseInt(x));
            closeHistory();
            document.getElementById('welcome-screen').style.display = 'none';
            renderResultScreen({ userResponses: arr });
        }
    </script>

</body>

</html>