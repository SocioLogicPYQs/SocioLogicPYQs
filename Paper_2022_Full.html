<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YOUR PYQ BATTLE</title>
    <style>
        :root {
            --brand-main: #2563eb;
            --brand-grad: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            --bg-grad: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-light: #64748b;
            --success: #15803d;
            --danger: #b91c1c;
            --review: #7c3aed;
            --selected: #eff6ff;
            --radius: 16px;
            --shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-grad);
            color: var(--text-main);
            height: 100vh;
            height: 100dvh;
            /* Mobile Chrome Fix */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- 1. WELCOME SCREEN --- */
        #welcome-screen {
            position: fixed;
            inset: 0;
            z-index: 200;
            background: white;
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 24px 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- UPDATED WELCOME SCREEN (Wider & Premium) --- */
        .welcome-card {
            background: white;
            width: 90%;
            /* Good for Mobile */
            max-width: 700px;
            /* Increased from 450px for Laptop (Wider look) */
            padding: 50px;
            /* More spacious "Grand" feel */
            border-radius: 24px;
            /* Softer corners */
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.15);
            /* Deeper shadow */
            text-align: center;
            border: 1px solid #e2e8f0;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            /* Fixes layout alignment */
            flex-direction: column;
            align-items: center;
            /* Centers everything perfectly */
        }

        /* Ensure input fields don't stretch too ugly on the wide screen */
        .welcome-card .input-field {
            max-width: 500px;
            /* Keeps inputs looking neat */
            width: 100%;
        }

        /* Mobile Adjustment */
        @media(max-width: 600px) {
            .welcome-card {
                width: 95%;
                /* Maximize space on phone */
                padding: 30px 20px;
                /* Slightly tighter padding for small screens */
            }
        }

        .mode-selector {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.2s;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: #64748b;
            font-weight: 600;
        }

        .mode-btn.active {
            border-color: #2563eb;
            background: #eff6ff;
            color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }

        /* --- SCORECARD GRID STYLES --- */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        .score-card-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            text-align: center;
        }

        .sc-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.9;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .sc-value {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .input-field {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1.1rem;
            outline: none;
            text-align: center;
            font-weight: 600;
            transition: 0.2s;
        }

        .input-field:focus {
            border-color: #2563eb;
        }

        #attempt-badge {
            display: inline-block;
            background: #fff7ed;
            color: #c2410c;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            border: 1px solid #ffedd5;
            margin-bottom: 20px;
        }

        /* --- 2. MAIN INTERFACE --- */
        #app-wrapper {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        /* Header */
        nav {
            background: var(--brand-grad);
            color: white;
            height: 64px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            z-index: 50;
            flex-shrink: 0;
        }

        .timer-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 8px;
            font-family: monospace;
            font-weight: 700;
            font-size: 1.1rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
        }

        /* Main Area */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .main-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
        }

        .q-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            max-width: 900px;
            width: 100%;
            height: fit-content;
            border-top: 5px solid #2563eb;
            animation: slideUp 0.3s ease-out;
            margin-bottom: 40px;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .q-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .topic-tag {
            background: #eff6ff;
            color: #1e40af;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .q-text {
            font-size: 1.2rem;
            font-weight: 600;
            line-height: 1.6;
            color: var(--text-main);
            margin-bottom: 25px;
        }

        /* Options */
        .option {
            display: flex;
            align-items: flex-start;
            padding: 16px 20px;
            margin-bottom: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            line-height: 1.5;
        }

        .option:hover {
            border-color: #93c5fd;
            background: #f8fafc;
        }

        .option.selected {
            border-color: #2563eb;
            background: var(--selected);
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.1);
        }

        .option.selected .opt-key {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .option.review-marked {
            border-color: var(--review);
            background: #f5f3ff;
        }

        .option.review-marked .opt-key {
            background: var(--review);
            color: white;
            border-color: var(--review);
        }

        .opt-key {
            min-width: 32px;
            height: 32px;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #64748b;
            margin-right: 15px;
            font-size: 0.9rem;
        }

        /* Sidebar (Desktop Default) */
        .sidebar {
            width: 340px;
            background: white;
            border-left: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            z-index: 40;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sb-grid {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            overflow-y: auto;
            align-content: start;
        }

        .grid-btn {
            aspect-ratio: 1;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            color: #64748b;
            background: white;
        }

        /* States */
        .st-curr {
            border-color: #2563eb;
            color: #2563eb;
            box-shadow: inset 0 0 0 2px #2563eb;
        }

        .st-ans {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .st-rev {
            background: #f59e0b;
            border-color: #f59e0b;
            color: white;
        }

        .st-ans-rev {
            background: var(--review);
            border-color: var(--review);
            color: white;
        }

        /* Footer */
        .footer-bar {
            height: 72px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 30;
            flex-shrink: 0;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 700;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            transition: 0.2s;
            white-space: nowrap;
        }

        .btn-pri {
            background: #1e40af;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(30, 64, 175, 0.2);
        }

        .btn-sec {
            background: white;
            border: 2px solid #e2e8f0;
            color: #475569;
        }

        .btn-rev {
            background: #fffbeb;
            color: #b45309;
            border: 1px solid #fcd34d;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* --- PREMIUM MOBILE/TABLET ADAPTATION --- */
        /* Only activates when 'mobile-mode' class is on body */
        body.mobile-mode .sidebar {
            position: fixed;
            right: 0;
            top: 64px;
            bottom: 0;
            width: 85%;
            max-width: 320px;
            transform: translateX(100%);
            /* Hidden by default */
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.2);
        }

        body.mobile-mode .sidebar.active {
            transform: translateX(0);
        }

        /* Slide in */

        body.mobile-mode .main-area {
            padding: 15px;
        }

        body.mobile-mode .q-card {
            padding: 25px;
            border-radius: 12px;
        }

        /* Bigger Touch Targets for Mobile */
        body.mobile-mode .option {
            padding: 18px 15px;
            margin-bottom: 12px;
        }

        body.mobile-mode .btn {
            padding: 14px 18px;
            font-size: 1rem;
        }

        body.mobile-mode .footer-bar {
            height: 80px;
            padding: 0 15px;
        }

        /* Hide Text Labels on Mobile Footer if needed to fit */
        body.mobile-mode .btn-sec span {
            display: none;
        }

        body.mobile-mode .btn svg {
            display: block;
        }

        /* --- COMPACT RESULT CARD STYLES --- */
        /* --- UPDATED WIDTH FOR RESULT CARD --- */
        .res-card {
            background: #ffffff;
            width: 95%;
            /* Uses 95% screen width on Mobile */
            max-width: 900px;
            /* Increased from 500px to 900px for Laptop */
            max-height: 90vh;
            /* Keeps it fitting vertically */
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .res-header {
            background: var(--brand-grad);
            padding: 20px;
            /* Reduced padding */
            text-align: center;
            color: white;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .res-header h2 {
            font-size: 1.1rem;
            margin: 0 0 15px 0;
            opacity: 0.95;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* Compact Score Grid */
        .score-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            /* 4 items in one row */
            gap: 8px;
            margin: 0;
        }

        .score-card-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 4px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            text-align: center;
        }

        .sc-label {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.85;
            margin-bottom: 3px;
            font-weight: 600;
        }

        .sc-value {
            font-size: 1.15rem;
            font-weight: 700;
            line-height: 1.1;
        }

        /* Result Body */
        .res-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
            background: #f8fafc;
        }

        /* Analysis Boxes */
        .analysis-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .analysis-box {
            background: white;
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        }

        .ab-title {
            font-size: 0.7rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .ab-val {
            font-size: 0.9rem;
            font-weight: 700;
            color: #334155;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- MISSING OVERLAY & EXPLANATION STYLES --- */
        .overlay {
            display: none;
            /* Hidden by default */
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.8);
            /* Dark background */
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        /* Explanation Feed Styling */
        .exp-row {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .exp-row.correct {
            border-left: 5px solid #16a34a;
        }

        .exp-row.wrong {
            border-left: 5px solid #dc2626;
        }

        .exp-detail {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            margin-top: 15px;
            padding-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .why-box {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #334155;
        }

        .txt-green {
            color: #16a34a;
            font-weight: 700;
        }

        .txt-red {
            color: #dc2626;
            font-weight: 700;
        }

        /* Mobile Tweak: Stack scores if screen is too small */
        @media(max-width: 400px) {
            .score-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* --- PREMIUM HISTORY MODAL --- */
        #history-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 250;
            background: rgba(15, 23, 42, 0.7);
            /* Darker blur */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.2s ease-out;
        }

        .history-card {
            background: white;
            width: 90%;
            max-width: 550px;
            max-height: 80vh;
            border-radius: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .hist-header {
            padding: 25px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hist-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: #1e293b;
            letter-spacing: -0.5px;
        }

        .hist-close {
            background: #fee2e2;
            color: #ef4444;
            border: none;
            padding: 8px 16px;
            border-radius: 99px;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.2s;
        }

        .hist-close:hover {
            background: #fecaca;
            transform: scale(1.05);
        }

        .hist-list {
            padding: 20px;
            overflow-y: auto;
            background: #f8fafc;
            flex: 1;
        }

        /* The Individual Attempt Card */
        .hist-item {
            background: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .hist-item:hover {
            transform: translateY(-3px);
            border-color: #3b82f6;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.1);
        }

        .h-left {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .h-title {
            font-weight: 700;
            color: #334155;
            font-size: 1rem;
        }

        .h-date {
            font-size: 0.8rem;
            color: #94a3b8;
            font-weight: 500;
        }

        .h-score-badge {
            background: #eff6ff;
            color: #2563eb;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 1.1rem;
            border: 1px solid #dbeafe;
        }

        /* Empty State */
        .hist-empty {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
            font-style: italic;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media(max-width: 768px) {
            .analysis-row {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            /* Default hide on small screens until toggled */
            .sidebar.active {
                display: flex;
                position: fixed;
                right: 0;
                top: 64px;
                bottom: 0;
                width: 85%;
                transform: none;
                box-shadow: -10px 0 20px rgba(0, 0, 0, 0.2);
            }
        }


        /* --- NEW HEADER STYLES --- */
        .header-left-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-box {
            background: white;
            width: 45px;
            height: 45px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .logo-box img {
            max-width: 80%;
            max-height: 80%;
            object-fit: contain;
        }

        .candidate-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
            line-height: 1.2;
        }

        .candidate-name {
            color: #ffffff;
            font-family: 'Segoe UI', sans-serif;
            font-size: 20px;
            /* Bigger Font */
            font-weight: 700;
            /* Bold */
            margin: 0;
            letter-spacing: 0.5px;
            text-transform: capitalize;
        }

        .test-badge {
            color: rgba(255, 255, 255, 0.85);
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 2px;
        }

        /* --- GLOBAL WATERMARK --- */
        body::after {
            content: "";
            position: fixed;
            inset: 0;
            background-image: url('https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50vmin;
            opacity: 0.1;
            z-index: 9999;
            pointer-events: none;
            filter: grayscale(100%);
            mix-blend-mode: multiply;
        }

        /* --- IMPROVED THANK YOU SCREEN --- */
        .ty-card {
            background: white;
            width: 90%;
            max-width: 750px;
            /* Wider on Laptop for grandeur */
            padding: 60px 40px;
            /* Generous spacing for symmetry */
            text-align: center;
            border-radius: 30px;
            box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: slideUp 0.4s ease-out;
        }

        .ty-header {
            font-size: 3.5rem;
            /* Very large, clear text */
            font-weight: 800;
            color: #0f172a;
            margin: 20px 0 15px 0;
            line-height: 1.1;
            letter-spacing: -1px;
        }

        .ty-msg {
            font-size: 1.4rem;
            /* Large, easy-to-read body text */
            color: #475569;
            line-height: 1.8;
            /* High readability */
            margin-bottom: 40px;
            max-width: 90%;
            /* Prevents text stretching too wide */
        }

        /* Mobile Adjustments */
        @media(max-width: 600px) {
            .ty-card {
                padding: 40px 20px;
            }

            .ty-header {
                font-size: 2.5rem;
            }

            /* Adjusted for phone screens */
            .ty-msg {
                font-size: 1.15rem;
                line-height: 1.6;
            }
        }

        /* --- RESUME NAVIGATION TOAST --- */
        .resume-toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            /* Hidden initially */
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            border: 1px solid #e2e8f0;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 300px;
        }

        .resume-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .rt-text {
            font-size: 0.9rem;
            color: #1e293b;
            flex: 1;
        }

        .rt-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            white-space: nowrap;
        }

        .rt-close {
            background: #f1f5f9;
            color: #64748b;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>

    <div id="welcome-screen">
        <div class="welcome-card">
            <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="SocioLogic"
                style="height: 120px; width: auto; display: inline-block;">

            <h1 style="color:#1e293b; margin:0; font-size:1.8rem; letter-spacing:-0.5px;">YOUR PYQ BATTLE</h1>
            <p style="color:#64748b; margin-top:5px; margin-bottom:20px;">CUET PG Sociology 2022 Full Paper</p>

            <div class="mode-selector">
                <div class="mode-btn active" onclick="setMode('desktop')" id="btn-desktop">
                    <span style="font-size:1.5rem">üíª</span>
                    <span style="font-size:0.9rem">Laptop/Tablet</span>
                </div>
                <div class="mode-btn" onclick="setMode('mobile')" id="btn-mobile">
                    <span style="font-size:1.5rem">üì±</span>
                    <span style="font-size:0.9rem">Mobile</span>
                </div>
            </div>

            <input type="text" id="candidateName" class="input-field" placeholder="Enter Your Name" autocomplete="off"
                style="margin-bottom:10px;">

            <input type="text" id="username" class="input-field" placeholder="Enter 4-Digit ID" autocomplete="off">

            <div id="attempt-badge"
                style="margin-bottom:15px; font-size:0.85rem; color:#64748b; font-weight:600; padding:10px; border-radius:8px; background:#f1f5f9; border:1px solid #e2e8f0;">
                Waiting for Candidate ID...
            </div>
            <button id="start-btn" class="btn btn-pri"
                style="width:100%; justify-content:center; padding:15px; font-size:1.1rem;" onclick="startTest()">
                Start Examination ‚ûú
            </button>

            <button class="btn btn-sec" style="width:100%; justify-content:center; margin-top:10px;"
                onclick="openHistory()">
                üìú View Past Attempts
            </button>

            <div style="margin-top: 25px; border-top: 1px dashed #cbd5e1; padding-top: 20px;">
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 10px; font-weight:600;">New Student?</p>
                <a href="https://rzp.io/rzp/xddl5LdV" target="_blank" style="text-decoration: none;">
                    <button class="btn"
                        style="background: #10b981; color: white; width: 100%; justify-content: center; box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);">
                        ‚ö° Buy Full Access at just (‚Çπ149)
                    </button>
                </a>
                <div style="font-size:0.75rem; color:#94a3b8; margin-top:5px;">Last 4 digits of your phone will be your
                    ID</div>
            </div>
        </div>
    </div>

    <div id="history-modal">
        <div class="history-card">
            <div class="hist-header">
                <span class="hist-title">üìú Past Attempts</span>
                <button class="hist-close" onclick="closeHistory()">Close</button>
            </div>
            <div id="history-list" class="hist-list"></div>
        </div>
    </div>

    <div id="app-wrapper">
        <nav>
            <div class="header-left-section">
                <div class="logo-box">
                    <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="Logo" />
                </div>
                <div class="candidate-details">
                    <h1 class="candidate-name" id="nav-user">Guest</h1>
                    <div class="test-badge">CUET PG SOCIOLOGY 2023 Full Paper</div>
                </div>
            </div>
            <div class="timer-badge" id="timer">00:00:00</div>
            <button class="btn btn-sec" style="padding:8px;" onclick="toggleSidebar()" id="mob-menu">‚ò∞</button>
        </nav>

        <div class="container">
            <div class="main-area">
                <div class="q-card" id="q-panel"></div>
            </div>

            <aside class="sidebar" id="sidebar">
                <div
                    style="padding:15px; border-bottom:1px solid #e2e8f0; font-weight:700; color:#334155; display:flex; justify-content:space-between; align-items:center;">
                    <span>Question Map</span>
                    <span onclick="toggleSidebar()" style="cursor:pointer; font-size:1.2rem; display:none;"
                        id="mob-close-sb">‚úï</span>
                </div>
                <div class="sb-grid" id="palette"></div>
                <div style="padding:20px; border-top:1px solid #e2e8f0; margin-top:auto;">
                    <button class="btn btn-danger" style="width:100%; justify-content:center;"
                        onclick="finishTest()">SUBMIT TEST</button>
                </div>
            </aside>
        </div>

        <div class="footer-bar">
            <div style="display:flex; gap:10px;">
                <button class="btn btn-sec" onclick="clearResp()">Clear</button>
                <button class="btn btn-rev" onclick="markReview()" id="btn-review">üö© Review</button>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-sec" onclick="nav(-1)">Prev</button>
                <button class="btn btn-pri" onclick="nav(1)" id="btn-next">Save & Next ‚ûú</button>
            </div>
        </div>
    </div>

    <div class="overlay" id="result-overlay">
        <div class="res-card">
            <div class="res-header">
                <h2>Assessment Report</h2>
                <div class="score-grid">
                    <div class="score-card-item">
                        <div class="sc-label">Attempted</div>
                        <div class="sc-value" id="disp-att">0</div>
                    </div>
                    <div class="score-card-item"
                        style="background: rgba(220, 252, 231, 0.25); border-color: rgba(220, 252, 231, 0.5);">
                        <div class="sc-label" style="color:#dcfce7;">Correct</div>
                        <div class="sc-value" style="color:#f0fdf4;" id="disp-cor">0</div>
                    </div>
                    <div class="score-card-item"
                        style="background: rgba(254, 226, 226, 0.25); border-color: rgba(254, 226, 226, 0.5);">
                        <div class="sc-label" style="color:#fee2e2;">Wrong</div>
                        <div class="sc-value" style="color:#fef2f2;" id="disp-wro">0</div>
                    </div>
                    <div class="score-card-item">
                        <div class="sc-label">Score</div>
                        <div class="sc-value" id="disp-score">0</div>
                    </div>
                </div>
            </div>

            <div class="res-body">
                <div class="analysis-row">
                    <div class="analysis-box" style="border-left:4px solid #15803d;">
                        <div class="ab-title" style="color:#15803d">üí™ Strongest</div>
                        <div class="ab-val" id="area-strong">--</div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:3px;" id="area-strong-stat">Acc: 0%
                        </div>
                    </div>
                    <div class="analysis-box" style="border-left:4px solid #b91c1c;">
                        <div class="ab-title" style="color:#b91c1c">‚ö†Ô∏è Weakest</div>
                        <div class="ab-val" id="area-weak">--</div>
                        <div style="font-size:0.75rem; color:#94a3b8; margin-top:3px;" id="area-weak-stat">Acc: 0%</div>
                    </div>
                </div>

                <h3
                    style="font-size:0.95rem; font-weight:700; color:#0f172a; margin-bottom:15px; border-bottom:1px solid #e2e8f0; padding-bottom:8px;">
                    Detailed Explanations
                </h3>

                <div id="solution-feed"></div>

                <div style="text-align:center; margin-top:25px;">
                    <button class="btn btn-pri" style="width:100%; justify-content:center; padding:12px;"
                        onclick="showThankYou()">
                        Exit & Save Report
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="overlay" id="ty-screen">
        <div class="ty-card">

            <img src="https://i.ibb.co/fYNNzJYS/Gemini-Generated-Image-fb7rm1fb7rm1fb7r.png" alt="SocioLogic"
                style="height: 140px; width: auto; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 50%;">

            <h1 class="ty-header">Test Submitted!</h1>

            <p class="ty-msg">
                Your performance on <b style="color:#1e40af;">SocioLogic</b> has been recorded.<br>
                You are one step closer to your <b style="color:#d97706;">dream university</b>.
            </p>

            <a href="https://t.me/SocioLogicPYQs" target="_blank"
                style="text-decoration:none; width: 100%; max-width: 400px;">
                <button class="btn btn-pri"
                    style="width:100%; justify-content:center; padding: 16px; font-size: 1.1rem; border-radius: 12px; background: #0088cc;">
                    ‚úàÔ∏è Join Telegram Channel
                </button>
            </a>

            <div style="display: flex; gap: 15px; width: 100%; max-width: 500px; margin-top: 25px; flex-wrap: wrap;">

                <button class="btn btn-sec" onclick="location.reload()"
                    style="flex: 1; min-width: 200px; justify-content: center; padding: 16px; border-radius: 12px; font-weight: 700; border: 2px solid #e2e8f0; color: #475569;">
                    üîÑ Restart Test
                </button>

                <a href="index.html" style="text-decoration: none; flex: 1; min-width: 200px;">
                    <button class="btn btn-pri"
                        style="width: 100%; justify-content: center; padding: 16px; border-radius: 12px; background: #0f172a; color: white; font-weight: 700; box-shadow: 0 4px 12px rgba(15, 23, 42, 0.2);">
                        üè† Dashboard
                    </button>
                </a>

            </div>
        </div>
    </div>
    <script>
        /* -------------------------------------------------------------
           PASTE YOUR QUESTION DATA HERE
           const questions = [ ... ];
        ------------------------------------------------------------- */
        const questions = [



            {
                topic: "üè∑Ô∏è Demography üìÑ 2022",
                text: "Life expectancy refers to:-",
                options: ["The estimated number of years that an average person is expected to survive", "Total number of live births that a hypothetical woman would have if she lived through the reproductive age", "Difference between birth rate and death rate", "The number of live births per 1000 women in the child bearing age group"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Life expectancy is defined as the average number of years a person is expected to live based on current mortality rates. It is a key indicator of the health and well-being of a population.",
                    others: "Option B defines Total Fertility Rate (TFR). Option C refers to the rate of natural increase. Option D refers to the general fertility rate.",
                    trick: "PRO TIP: 'Expectancy' = 'Expected to survive'."
                }
            },
            {
                topic: "üè∑Ô∏è Demography üìÑ 2022",
                text: "A situation where a large cohort of women of reproductive age will fuel population growth over the next generation, even if each woman has fewer children than previous generation did is called:",
                options: ["Fertility Rate", "Total Fertility Rate", "Population Momentum", "Population Growth"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Population momentum describes the tendency for population growth to continue beyond the time that replacement-level fertility has been achieved because of the relatively high concentration of people in the childbearing years.",
                    others: "Fertility rate is a general term. TFR is the average number of children per woman. Population growth is the generic increase.",
                    trick: "PRO TIP: Think of 'momentum'‚Äîa heavy car keeps moving even after you hit the brakes (low fertility) because of its weight (young population)."
                }
            },
            {
                topic: "üè∑Ô∏è Demography üìÑ 2022",
                text: "The type of demography that enquires into the wider causes and consequences of social Structures and processes on population is called:",
                options: ["Social Demography", "Formal Demography", "Arithmetic Progression", "Geometric Progression"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Social demography examines demographic data within a social context, analyzing how social processes, structures, and institutions influence and are influenced by population dynamics.",
                    others: "Formal demography deals with quantitative measurement and statistical analysis. Arithmetic/Geometric progressions are mathematical concepts used by Malthus.",
                    trick: "PRO TIP: 'Social Structures' in the question -> 'Social Demography'."
                }
            },
            {
                topic: "üè∑Ô∏è Malthusian Theory üìÑ 2022",
                text: "Famines and diseases are nature's way of dealing with the imbalance of food supply vis-a-vis increase in population.\nMalthus identified this as:",
                options: ["Preventive checks", "Positive checks", "Negative checks", "Promotive checks"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Thomas Malthus distinguished between 'preventive checks' (moral restraint, late marriage) and 'positive checks' (famines, disease, war) which increase the death rate to restore balance between population and resources.",
                    others: "Preventive checks reduce the birth rate. Negative/Promotive checks are not standard Malthusian terms.",
                    trick: "PRO TIP: Positive checks = 'Positively' painful (death, disease)."
                }
            },
            {
                topic: "üè∑Ô∏è Demography üìÑ 2022",
                text: "Sex ratio refers to the:",
                options: ["Number of females per 100 males in a given area at a specified time period.", "Number of males per 1000 females in a given area at a specified time period.", "Number of females per 1000 males in a given area at a specified time period.", "Number of females per 1000 males in a given area at a non-specified time period."],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: In the Indian census context, Sex Ratio is strictly defined as the number of females per 1000 males in the population. (Note: International standards sometimes use males per 100 females, but the Indian standard is F/1000 M).",
                    others: "Option A is often used internationally but not the standard Indian definition. Option B is the inverse. Option D lacks a specific time period.",
                    trick: "PRO TIP: India counts Females per Thousand Men."
                }
            },
            {
                topic: "üè∑Ô∏è Communities üìÑ 2022",
                text: "Match List I with List II\n\nList I\nA. Jatavas\nB. Multani Lohars\nC. Khasis\nD. Vokkaligas\n\nList II\nI. Muslim Community\nII. Meghalaya\nIII. Karnataka\nIV. Uttar Pradesh",
                options: ["A-IV, B-I, C-III, D-II", "A-IV, B-I. C-II, D-III", "A-IV, B-III, C-II, D-I", "A-IV, B-II, C-III, D-I"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Jatavas are a major Dalit community in UP (IV). Multani Lohars are often associated with Muslim artisan communities (I). Khasis are a matrilineal tribe in Meghalaya (II). Vokkaligas are a dominant caste in Karnataka (III).",
                    others: "Only Option B correctly matches all pairs.",
                    trick: "PRO TIP: Vokkaligas = Karnataka; Khasis = Meghalaya."
                }
            },
            {
                topic: "üè∑Ô∏è Social Reformers üìÑ 2022",
                text: "Match List I with List II\n\nList I-Contribution\nA. Brahmo Samaj\nB. Widow remarriage\nC. Country's first school for girls\nD. Anti Caste Movement\n\nList II - Important Personalities\nI. M. G. Ranade\nII. Raja Ram Mohan Roy\nIII. Jyotiba Phule\nIV. Savitri Bai Phule",
                options: ["A-II, B-1, C-III, D-IV", "A-I, B-II, C-IV, D-III", "A-II, B-I, C-IV, D-III", "A-IV, B-I, C-III, D-II"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Brahmo Samaj = Raja Ram Mohan Roy (II). Widow Remarriage = M.G. Ranade (I) (supported the act/movement). First school for girls = Savitribai Phule (IV). Anti Caste Movement (Satya Shodhak Samaj) = Jyotiba Phule (III).",
                    others: "Option C is the most accurate historical match provided.",
                    trick: "PRO TIP: Raja Ram Mohan Roy = Brahmo Samaj. Savitribai = Education/Girls School."
                }
            },
            {
                topic: "üè∑Ô∏è Social Legislation üìÑ 2022",
                text: "The legal provisions against violence and humiliation to Dalits and Adivasis strengthened by:",
                options: ["Government of India Act, 1935", "Scheduled Castes and Tribes Act, 1989", "93rd Constitutional Amendment, 2006", "Article 17, Constitution of India 1950"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Scheduled Castes and the Scheduled Tribes (Prevention of Atrocities) Act, 1989, specifically addresses violence and humiliation (atrocities) against these groups, strengthening earlier provisions.",
                    others: "Article 17 abolished Untouchability but the 1989 Act provided the penal framework for atrocities. GoI Act 1935 is pre-independence. 93rd Amendment relates to education reservation.",
                    trick: "PRO TIP: 'Prevention of Atrocities' = 1989 Act."
                }
            },
            {
                topic: "üè∑Ô∏è Caste System üìÑ 2022",
                text: "Which of the following is not the characteristic of Caste?",
                options: ["Social and Religious hierarchy", "Segmental Division of Society", "Unrestricted Choice of Occupation", "Restrictions on feeding and Social Intercourse"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Caste is characterized by a hereditary restriction on occupation. Members of a caste are traditionally expected to follow the caste occupation. 'Unrestricted choice' is a feature of class, not caste.",
                    others: "Hierarchy, Segmental Division (Ghurye's features), and Restrictions on feeding are core characteristics of the caste system.",
                    trick: "PRO TIP: Caste = Fixed job (Traditional). Unrestricted = Class."
                }
            },
            {
                topic: "üè∑Ô∏è Kinship üìÑ 2022",
                text: "The terms 'Matrilineal' and 'Patrilineal' are associated with:",
                options: ["Residence of family", "Line of descent", "Nature of marriage rules", "Structure of family"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: These terms refer to Desecent. Patrilineal traces descent through the father's line; Matrilineal traces descent through the mother's line.",
                    others: "Residence is Patrilocal/Matrilocal. Marriage rules are Exogamy/Endogamy. Structure is Nuclear/Joint.",
                    trick: "PRO TIP: Lineal = Line (Descent)."
                }
            },
            {
                topic: "üè∑Ô∏è Sociological Thinkers üìÑ 2022",
                text: "Who wrote the book 'The Wealth of Nations'?",
                options: ["John Smith", "David Ricardo", "Adam Smith", "Emile Durkheim"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Adam Smith wrote 'The Wealth of Nations' (1776), a foundational text in classical economics.",
                    others: "Durkheim is a sociologist (Division of Labour). Ricardo is an economist (Principles of Political Economy). John Smith is a generic name/early explorer.",
                    trick: "PRO TIP: Adam Smith = Father of Economics = Wealth of Nations."
                }
            },
            {
                topic: "üè∑Ô∏è Economic Sociology üìÑ 2022",
                text: "Liberalisation can be understood as:",
                options: ["Privatisation and Marketisation", "Government regulations for industry", "Promoting government investment", "Increasing import duties on goods"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Liberalization refers to the relaxation of government restrictions, usually in areas of social and economic policy. It often accompanies privatization (selling state assets) and marketisation (opening markets).",
                    others: "It involves reducing regulations (not increasing), reducing government investment in favor of private, and decreasing import duties.",
                    trick: "PRO TIP: Liberalisation = Setting the market 'Free' (Liberal)."
                }
            },
            {
                topic: "üè∑Ô∏è Social Stratification üìÑ 2022",
                text: "'Other Backward Class' refers to:",
                options: ["Socially and educationally backward class", "Part of SC, ST", "Dominant Caste", "Economically and politically powerful classes"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Constitution of India refers to OBCs as 'Socially and Educationally Backward Classes' (SEBC). They are distinct from SCs and STs.",
                    others: "They are not SC/ST. While some dominant castes may claim OBC status, the definition focuses on backwardness.",
                    trick: "PRO TIP: OBC = SEBC (Socially & Educationally Backward)."
                }
            },
            {
                topic: "üè∑Ô∏è Gender & Society üìÑ 2022",
                text: "Match List I with List II\n\nList I Concept\nA. Third gender\nB. Apartheid\nC. Adivasis\nD. Transgender\n\nList II Characteristics\nI. Separation of races\nII. Social category of persons who are neither male nor female\nIII. Conversion of gender status of body into opposite gender by choice\nIV. Indigenous population, identity struggles",
                options: ["A-II, B-1, C-IV, D-III", "A-I, B-II, C-III, D-IV", "A-IV, B-III, C-I, D-II", "A-IV, B-II, C-I, D-III"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Third Gender = Neither male nor female (II). Apartheid = Racial separation (I). Adivasis = Indigenous (IV). Transgender = Crossing gender boundaries/conversion (III).",
                    others: "Option A is the only correct sequence.",
                    trick: "PRO TIP: Apartheid = Race. Adivasi = Indigenous."
                }
            },
            {
                topic: "üè∑Ô∏è Social Psychology üìÑ 2022",
                text: "The term that literally means 'pre-judgement', that is, an opinion formed in advance of any familiarity with the subject, before considering any available evidence is:",
                options: ["Stratification", "Discrimination", "Prejudice", "Stereotypes"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Prejudice (Pre-Judgment) is an attitude/opinion, usually negative, formed without knowledge or examination of the facts.",
                    others: "Discrimination is action/behavior. Stereotypes are fixed images/generalizations. Stratification is ranking.",
                    trick: "PRO TIP: Pre-judgement = Prejudice."
                }
            },
            {
                topic: "üè∑Ô∏è Literature & Society üìÑ 2022",
                text: "Match List I with List II\n\nList I Books\nA. Stree Purush Tulana\nB. Three Sermons on Human nature\nC. Sultana's Dream\nD. The texts of the Hindu law\n\nList II Authors\nI. M. G. Ranade\nII. Tarabai Shinde\nIII. Bishop Joseph Butler\nIV. Begum Rukkaiyah Hossain",
                options: ["A-III, B-II, C-I, D-IV", "A-II, B-III, –°-IV, D-I", "A-IV, B-III, C-II, D-I", "–ê-II, –í-I, C-III, D-IV"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Stree Purush Tulana = Tarabai Shinde (II). Three Sermons = Bishop Joseph Butler (III) (Not a standard sociology text, but Butler is a moral philosopher). Sultana's Dream = Begum Rokeya (IV). Ranade wrote on Hindu Law (I).",
                    others: "Option B provides the correct authorship matching.",
                    trick: "PRO TIP: Stree Purush Tulana = Tarabai Shinde."
                }
            },
            {
                topic: "üè∑Ô∏è Nation & State üìÑ 2022",
                text: "Indian nationalism is inclusive because it recognises:",
                options: ["Diversity", "Majority groups", "Regionalism", "Has one national language"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Indian nationalism is defined by 'Unity in Diversity'. It accommodates various linguistic, religious, and cultural groups rather than imposing a single identity.",
                    others: "It does not rely on one language (unlike European models) or strictly majority rule.",
                    trick: "PRO TIP: India = Unity in Diversity."
                }
            },
            {
                topic: "üè∑Ô∏è Secularism üìÑ 2022",
                text: "Which of the following is NOT correct?",
                options: ["There is separation of religious and political authority in Western Secularism", "In Indian Context, Secularism goes hand in hand with Communalism", "Secular Indian state respect all religion", "A Secular state does not favour any religion"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Secularism and Communalism are antithetical. Secularism promotes separation of religion from state or equal respect, while Communalism involves using religious identity for political mobilization and conflict.",
                    others: "Western secularism implies strict separation (Wall of Separation). Indian secularism implies 'Sarva Dharma Sambhava' (Equal respect).",
                    trick: "PRO TIP: Secularism opposes Communalism."
                }
            },
            {
                topic: "üè∑Ô∏è Community üìÑ 2022",
                text: "Community Identity is based on:",
                options: ["Birth and belongingness", "Qualification and achievements", "Choice and competency", "Competency and negotiation"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Community identity is 'ascriptive'‚Äîbased on birth, kinship, and a sense of belonging, rather than achieved status like qualification or competency.",
                    others: "Qualification, choice, and competency are features of modern associative or professional identities, not traditional community identity.",
                    trick: "PRO TIP: You are born into a community, you don't 'achieve' it."
                }
            },
            {
                topic: "üè∑Ô∏è Political Sociology üìÑ 2022",
                text: "Identify the correct statement:",
                options: ["During emergency, people experienced authoritarian rule", "During elections, immediately after the emergency, people voted overwhelmingly for Congress party", "The Civil liberties of people remain unaffected during the emergency", "Press was given freedom of speech during emergency"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The 1975-77 Emergency was characterized by the suspension of civil liberties, censorship of the press, and authoritarian governance.",
                    others: "The Congress party lost the post-emergency election (1977). Civil liberties and press freedom were severely curtailed.",
                    trick: "PRO TIP: Emergency = Authoritarianism."
                }
            },
            {
                topic: "üè∑Ô∏è Sanskritisation üìÑ 2022",
                text: "Which of the following is not Sanskritisation?",
                options: ["Exaggerate social mobility", "Improve positional status for individuals", "Rests on purity and pollution", "Dalit Culture eroded"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Sanskritisation is a *group* process, not an individual one. An individual cannot sanskritise alone; the whole caste group must adopt the practices to claim higher status. Also, it improves 'positional' status for the group, not structural change.",
                    others: "Critics argue it exaggerates mobility (Option A). It rests on purity/pollution (Option C). It erodes Dalit culture (Option D).",
                    trick: "PRO TIP: Sanskritisation is a Team Sport (Group), not individual."
                }
            },
            {
                topic: "üè∑Ô∏è Colonialism üìÑ 2022",
                text: "Colonialism had a deep impact on structure of the Indian Society. Which of the following is not true regarding colonialism in India?",
                options: ["Britishers interfered with Indian markets to ensure greater profits", "They altered the way of production", "They implemented Forest Act which changed the lives of pastoralists", "They benefited from continuous flow of tribute without interference in economic base"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Colonialism fundamentally *altered* the economic base (land revenue systems, agriculture, de-industrialization) to ensure the flow of tribute. They did not leave the economic base static.",
                    others: "They heavily interfered in markets, production (cash crops), and forest laws.",
                    trick: "PRO TIP: Colonialism = Active Interference (not passive tribute)."
                }
            },
            {
                topic: "üè∑Ô∏è Urbanisation üìÑ 2022",
                text: "Cities play a key role in economic systems of the empires. Which of the following is not one of them?",
                options: ["Goods can be cheaply imported", "Concrete expression of Global Capitalism", "Link between margins of Colonized India and Britain", "To maintain the traditional values"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Colonial cities (like Calcutta, Bombay) were engines of capitalism and colonial administration, often serving as conduits for raw materials and markets. They were centers of modernity, often eroding rather than maintaining traditional values.",
                    others: "They facilitated trade (A), represented capitalism (B), and linked the colony to the metropole (C).",
                    trick: "PRO TIP: Colonial Cities = Modernity/Trade, NOT Tradition."
                }
            },
            {
                topic: "üè∑Ô∏è Industrialisation üìÑ 2022",
                text: "The first society to undergo industrialization was",
                options: ["Germany", "India", "America (USA)", "Britain"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Industrial Revolution began in Great Britain in the late 18th century.",
                    others: "Other nations followed later.",
                    trick: "PRO TIP: Industrial Revolution = Britain (Steam Engine)."
                }
            },
            {
                topic: "üè∑Ô∏è Secularisation üìÑ 2022",
                text: "A process of decline in the influence of religions is called:-",
                options: ["Communalism", "Modernization", "Regionalism", "Secularization"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Secularization refers to the declining influence of religion in social institutions and everyday life, as defined by sociologists like Bryan Wilson.",
                    others: "Modernization is a broader concept. Communalism is the politicization of religion.",
                    trick: "PRO TIP: Decline of Religion = Secularization."
                }
            },
            {
                topic: "üè∑Ô∏è Panchayati Raj üìÑ 2022",
                text: "Which of the following Statements is not power and responsibility delegated to the Panchayats?",
                options: ["To prepare plans and schemes for economic development", "To promote skills that will enhance social justice", "To levy, collect and appropriate taxes, duties, tolls and fees", "To make sure that endogamy is practiced amongst rural youth"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The 73rd Amendment delegates powers related to economic development, social justice, and local taxation (Article 243G/H). Enforcing 'endogamy' (marrying within caste) is a social restriction often associated with Khap Panchayats, not the constitutional Gram Panchayats.",
                    others: "Preparing plans, social justice schemes, and collecting specific taxes are valid constitutional functions.",
                    trick: "PRO TIP: Constitution promotes Liberty, not Endogamy."
                }
            },
            {
                topic: "üè∑Ô∏è Panchayati Raj üìÑ 2022",
                text: "The Panchayat that has the authority to hear some petty, civil and criminal cases is:-",
                options: ["Zila Panchayat", "Gram Panchayat", "Nyaya Panchayat", "Gram Sabhas"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Nyaya Panchayats (Justice Panchayats) are distinct institutions established in some states to resolve petty civil and criminal disputes at the village level, providing affordable and speedy justice.",
                    others: "Gram Panchayat is the executive body. Gram Sabha is the general assembly. Zila Panchayat is at the district level.",
                    trick: "PRO TIP: Nyaya = Justice."
                }
            },
            {
                topic: "üè∑Ô∏è Green Revolution üìÑ 2022",
                text: "Which of the following is not a change due to green revolution?",
                options: ["Shift from payment in kind to payment in cash", "Commercialization of agriculture", "Rise of rural elites", "Increasing bonded labour"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Green Revolution accelerated the transition to a capitalist agrarian economy, characterized by 'free' wage labor and cash payments. This typically led to a decline in traditional feudal 'bonded labor' (unfree labor), replacing it with casual/migrant wage labor (though often under distressed conditions).",
                    others: "It caused a shift to cash (A), commercialization (B), and the rise of rich farmers/rural elites (C).",
                    trick: "PRO TIP: Green Revolution = Capitalism = Wage Labor (Not Bonded)."
                }
            },
            {
                topic: "üè∑Ô∏è Agrarian Society üìÑ 2022",
                text: "Commercialization of agriculture does not lead to:",
                options: ["Regional inequality", "Integration of rural to wider economy", "Development of rural infrastructure", "Increase in organic farming"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Commercialization (especially Green Revolution style) relies heavily on chemical fertilizers, pesticides, and high-yield seeds, often discouraging organic farming in favor of intensive chemical agriculture.",
                    others: "It leads to regional inequality (rich zones vs poor zones), integrates villages into national markets, and spurs infrastructure.",
                    trick: "PRO TIP: Commercial = Chemicals (Not Organic)."
                }
            },
            {
                topic: "üè∑Ô∏è Caste System üìÑ 2022",
                text: "Washermen, Potters, Goldsmiths, Oil-pressures are known as:",
                options: ["Dalits", "Service Castes", "Labourers", "Vaishyas"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: In the traditional Jajmani system, these occupational groups provided specialized services to the village community and were known as 'Service Castes' (Kamin/Praja).",
                    others: "They are not necessarily Dalits (though some may be lower caste). 'Labourers' is a class term. 'Vaishyas' are traders.",
                    trick: "PRO TIP: They provide a 'Service' -> Service Castes."
                }
            },
            {
                topic: "üè∑Ô∏è Agrarian Crisis üìÑ 2022",
                text: "Farmers suicide can be linked to 'agrarian distress caused by structural changes in agriculture. These include:\nA. Liberalization policies\nB. Declining State Support\nC. High Cost inputs\nD. Community involvement increased in agricultural operations\nE. Changing Crop pattern\n\nChoose the correct answer from the options given below:",
                options: ["A. C. D. E", "A. B. C. E", "A. B. D. E", "B. C. D. E"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Agrarian distress is driven by Liberalization (market volatility), Declining State Support (subsidy cuts), High Cost inputs (seeds/chemicals), and Changing Crop patterns (cash crops). Community involvement (D) has generally *decreased* leading to individualization of risk.",
                    others: "Option B excludes D, which is the correct exclusion.",
                    trick: "PRO TIP: Distress is lonely (No community involvement)."
                }
            },
            {
                topic: "üè∑Ô∏è Green Revolution üìÑ 2022",
                text: "Which of the following statement is NOT true about the second phase of green revolution?",
                options: ["Increasing dependence on market", "Farmers switched to Multi-crop system from Mono-crop system", "Green revolution resulted in increased regional inequalities", "Increased risks for farmers"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The Green Revolution encourages Mono-cropping (planting a single cash crop) for efficiency and market sale, rather than Multi-cropping. This reduces biodiversity and increases vulnerability.",
                    others: "Dependence on the market, regional inequalities, and risks are all well-documented consequences.",
                    trick: "PRO TIP: Markets like 1 thing in bulk (Mono-crop)."
                }
            },
            {
                topic: "üè∑Ô∏è Sociology of Work üìÑ 2022",
                text: "Match the Concepts/Sociologists given in List I with their Characteristics given below in List II\n\nList I Concepts/Sociologists\nA. Alienation\nB. Convergence thesis\nC. Scientific Management\nD. Harry Braverman\n\nList II Characteristics\nI. Work broken into small repetitive elements to increase efficiency\nII. When workers do not enjoy work and task becomes repetitive and exhausting\nIII. All countries follow same path to modernization\nIV. Machinery actually de skills workers",
                options: ["A-III, B-II, C-IV, D-I", "A-II, B-III, C-I, D-IV", "A-I, B-IV, C-II, D-III", "A-I, B-II, C-III, D-IV"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Alienation = Workers do not enjoy work/repetitive (Marx) (II). Convergence Thesis = All countries follow same modernization path (Kerr et al.) (III). Scientific Management = Taylorism/Repetitive elements (I). Harry Braverman = Deskilling thesis (IV).",
                    others: "Option B matches these correctly.",
                    trick: "PRO TIP: Braverman = Deskilling. Taylor = Scientific Management."
                }
            },
            {
                topic: "üè∑Ô∏è Informal Sector üìÑ 2022",
                text: "Arrange in sequence the process of Bidi making,\nA. Dampening the tender leaves\nB. Contractor sells bidi to manufacturer\nC. Filling tobacco evenly and trying them with thread.\nD. Manufacturer sells to distributor.\nE. Villagers picks up tender leaves and sell them to forest department",
                options: ["E, C, A, B, D", "E, A, C, B, D", "E, B, C, A, D", "A, C, B, D, E"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The logical production chain: 1. Raw Material (Villagers pick leaves - E). 2. Preparation (Dampening leaves - A). 3. Production (Filling/Tying - C). 4. Collection (Contractor sells finished bidi to manufacturer - B). 5. Sale (Manufacturer to Distributor - D).",
                    others: "Dampening (A) must happen before Filling (C) to make leaves pliable.",
                    trick: "PRO TIP: Pick -> Wet -> Fill -> Sell."
                }
            },
            {
                topic: "üè∑Ô∏è Economy üìÑ 2022",
                text: "When government sells its share to several public sector companies. This process is known as",
                options: ["Deinvestment", "Uninvestment", "Laissez-faire", "Disinvestment"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Disinvestment (or Divestment) is the specific economic term for the government selling its equity/stakes in Public Sector Enterprises (PSEs).",
                    others: "Laissez-faire is a policy of non-interference. The other terms are not standard economic vocabulary.",
                    trick: "PRO TIP: Selling 'D'istinct shares = 'D'isinvestment."
                }
            },
            {
                topic: "üè∑Ô∏è Market & Economy üìÑ 2022",
                text: "Retail chains are a threat to Indian market because",
                options: ["They promote the policy of liberalization", "They provide more job opportunity", "Small local chains (grocery stores) will be destroyed", "Retail sector is attractive"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: A major sociological and economic critique of large retail chains (FDI in retail) in India is the displacement of small, unorganized retailers (Kirana stores) who cannot compete with the economies of scale of large chains.",
                    others: "Job creation (B) is an argument *for* them. A and D are descriptions, not threats.",
                    trick: "PRO TIP: Big Fish eat Small Fish (Kirana stores)."
                }
            },
            {
                topic: "üè∑Ô∏è Industry & Society üìÑ 2022",
                text: "Match the Industrial Outcomes given in List I with their Characteristics given below in List II\n\nList I Industrial Outcomes\nA. Engineers using a software for draughting\nB. Trade Union\nC. Silicosis in miners\nD. Growth of IT sector\n\nList II Characteristics\nI. Occupational hazard\nII. De-skilling of workers\nIII. Knowledge economy\nIV. Bargaining power of workers",
                options: ["A-I, B-II, C-III, D-IV", "A-III, B-I, C-II, D-III", "A-II, B-IV, C-I, D-III", "A-IV, B-II, C-III, D-I"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Software for draughting replaces manual skill -> Deskilling (II). Trade Unions provide Bargaining Power (IV). Silicosis is a lung disease -> Occupational Hazard (I). IT Sector -> Knowledge Economy (III).",
                    others: "Option C is the correct match.",
                    trick: "PRO TIP: Silicosis = Hazard. Union = Power."
                }
            },
            {
                topic: "üè∑Ô∏è Management üìÑ 2022",
                text: "Name the branch of management theory that seeks to increase productivity and competitiveness through the creation of a unique organizational culture involving all members of a firm.",
                options: ["Culture of Consumption", "Corporate Culture", "Knowledge economy", "Competitive Culture"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Corporate Culture refers to the shared values, beliefs, and practices within an organization. Management theories in the 1980s (like Japanese management styles) emphasized this to improve loyalty and productivity.",
                    others: "Knowledge economy is a macro concept. Culture of consumption is societal.",
                    trick: "PRO TIP: Organization's unique vibe = Corporate Culture."
                }
            },
            {
                topic: "üè∑Ô∏è Globalisation üìÑ 2022",
                text: "Match the (Concepts) given in List I with their Characteristics given below in List II\n\nList I-Industrial Outcomes\nA. Globalization\nB. Electronic Economy\nC. Liberalisation\nD. Cellular Telephone\n\nList II- Characteristics\n1. Economic Globalisation\nII. Growing interdependence between people, regions and countries\nIII. Growth in the usage of cell phones\nIV. Steady removal of the rules that regulates Indian trade and finance regulations",
                options: ["A-III, B-IV, C-I, D-II", "A-IV, B-III, C-II, D-I", "A-I, B-II, –°-III, D-IV", "A-II, B-I, C-IV, D-III"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Globalization = Interdependence (II). Electronic Economy = Economic Globalisation (driven by digital flow) (I). Liberalisation = Removal of rules (IV). Cellular Telephone = Growth in usage (III).",
                    others: "Option D correctly aligns the definitions.",
                    trick: "PRO TIP: Liberalisation = Removal of rules."
                }
            },
            {
                topic: "üè∑Ô∏è Mass Media üìÑ 2022",
                text: "In 1957, All India Radio acquired hugely popular channel which grew to become a money-spinning channel for AIR.\nThe name of the channel was:",
                options: ["Hum Log", "Vividh Bharati", "Doordarshan", "Buniyaad"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Vividh Bharati was launched in 1957 as a service of All India Radio to broadcast popular film music and entertainment, largely to compete with Radio Ceylon.",
                    others: "Hum Log and Buniyaad were TV soap operas (1980s). Doordarshan is the TV broadcaster.",
                    trick: "PRO TIP: 1957 + Radio + Music = Vividh Bharati."
                }
            },
            {
                topic: "üè∑Ô∏è Social Movements üìÑ 2022",
                text: "Passage Question: Name the leader who headed the social movement for Jharkhand state.",
                options: ["Kalidas", "Gunda Dhar", "Birsa Munda", "Mahatma Gandhi"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: As explicitly stated in the passage, the movement had a 'charismatic leader in Birsa Munda'.",
                    others: "The text identifies Birsa Munda as the icon.",
                    trick: "PRO TIP: Read the passage: 'Charismatic leader in Birsa Munda'."
                }
            },
            {
                topic: "üè∑Ô∏è Social Movements üìÑ 2022",
                text: "Passage Question: Choose the incorrect feature of a social movement.",
                options: ["Sustained Collective Action", "Shared objectives and ideologies", "Spontaneous and disorganized", "Leadership"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Social movements are defined by sustained collective action, organization, and leadership. A 'spontaneous and disorganized' event is typically a mob or a riot, not a movement.",
                    others: "Sustained action, ideology, and leadership are core features.",
                    trick: "PRO TIP: Movements need a Plan (Not disorganized)."
                }
            },
            {
                topic: "üè∑Ô∏è Social Movements üìÑ 2022",
                text: "Passage Question: Tribal movements are considered to be a part of New Social Movement. What comprises of New Social Movement?",
                options: ["Old issues of economic inequality", "Recognisation of power relatives", "Central role of political parties", "Quality life issues, identity, environment"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: New Social Movements (NSMs) focus on 'post-materialist' values like identity, culture, environment, and quality of life, rather than just traditional class/economic issues.",
                    others: "Old movements focused on economic inequality and were often led by political parties/unions.",
                    trick: "PRO TIP: NSM = Identity & Environment."
                }
            },
            {
                topic: "üè∑Ô∏è Social Movements üìÑ 2022",
                text: "Passage Question: Adivasis shared a common hatred towards\nA. Dikus\nB. Migrant traders\nC. Moneylenders\nD. Christian missionaries\n\nChoose the correct answer from the options given below:",
                options: ["B, C and D Only", "C, D and A Only", "A, B and C Only", "A, B and D Only"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: 'Dikus' is the overarching term used by Adivasis for outsiders. The specific groups constituting Dikus were migrant traders, moneylenders, and missionaries. The question asks for the components.",
                    others: "Option A lists the specific groups that 'Dikus' refers to.",
                    trick: "PRO TIP: Dikus = The Outsiders (Traders + Moneylenders + Missionaries)."
                }
            },
            {
                topic: "üè∑Ô∏è Social Movements üìÑ 2022",
                text: "Passage Question: Tribal movements help in creating, among Jharkhandis, a sense of :-",
                options: ["Ethnic consciousness, shared identity", "Marginalization, injustice", "Tribal customs and cultural practices", "Poverty, insecurity"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The passage states: 'This helped create a unified ethnic consciousness and a shared identity as Jharkhandis.'",
                    others: "Directly from the text.",
                    trick: "PRO TIP: Look for the exact phrase in the last sentence of the passage."
                }
            },
            {
                topic: "üè∑Ô∏è Colonial Industry üìÑ 2022",
                text: "Passage Question: The tea industry developed during the",
                options: ["Pre-colonial period", "Colonial period", "Post-independence period", "Vedic period"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The passage dates the start to 1851 and mentions 'regressive penal laws' of the 1860s/70s, which is the British Colonial period.",
                    others: "1851 is deep within the British Raj era.",
                    trick: "PRO TIP: 1851 = British Rule = Colonial."
                }
            },
            {
                topic: "üè∑Ô∏è Colonial Industry üìÑ 2022",
                text: "Passage Question: Tea industry during colonial times was",
                options: ["Labour intensive", "Machinery intensive", "Financially well paid jobs for labourers", "Based on democratic set up"],
                correct: 0,
                expl: {
                    correct: "ACADEMIC EXPLANATION: Tea plantations require huge amounts of manual labor for plucking. The passage mentions the 'bulk of sorely needed labour' had to be imported.",
                    others: "It was not machinery intensive (manual plucking). It was not well paid (fraud/coercion used). It was coercive, not democratic.",
                    trick: "PRO TIP: Picking tea leaves = Manual Work = Labour Intensive."
                }
            },
            {
                topic: "üè∑Ô∏è Migration üìÑ 2022",
                text: "Passage Question: Which of these reasons is NOT valid for the questions given below: The tea plantations was based on migrant labourers because:",
                options: ["The plantations were based in sparsely populated areas", "Offered high wages to workers", "Work was labour intensive in nature", "Plantation was located in uninhabited hillsides"],
                correct: 1,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The passage explicitly states that planters were 'unwilling to offer' financial incentives. They used fraud and coercion instead of high wages.",
                    others: "Sparsely populated (A) and uninhabited hillsides (D) are mentioned as reasons for needing imported labor.",
                    trick: "PRO TIP: Colonial planters were stingy (Unwilling to pay)."
                }
            },
            {
                topic: "üè∑Ô∏è Colonial Law üìÑ 2022",
                text: "Passage Question: Transport of Native Labourers Act (No 111) of 1863 was not helpful for:",
                options: ["Tea plantation owners", "Contractors", "Colonial government", "Labourers"],
                correct: 3,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The act is described as 'regressive penal laws' used for 'fraud coercion'. It benefited the owners, contractors, and government, but exploited the labourers.",
                    others: "Owners/Contractors utilized the act to recruit and control labor.",
                    trick: "PRO TIP: Colonial laws usually hurt the 'Native Labourers'."
                }
            },
            {
                topic: "üè∑Ô∏è History of Law üìÑ 2022",
                text: "Passage Question: Transport of Native Labourers Act (No 111) of 1863 of Bengal as amended in the years",
                options: ["1947, 1983, 1985", "1863, 1865, 1873", "1865, 1870, 1873", "1965, 1870, 1873"],
                correct: 2,
                expl: {
                    correct: "ACADEMIC EXPLANATION: The passage specifically mentions: 'amended in 1865, 1870 and 1873'.",
                    others: "Must match the dates in the text exactly.",
                    trick: "PRO TIP: Scan the last line of the passage for the dates."
                }
            },

        ];

        /* --- LOGIC ENGINE --- */
        const MAX_ATTEMPTS = 5;
        const SECONDS_PER_QUESTION = 72;
        const STORAGE_KEY = 'Paper_2022_Full';

        // --- SECURITY CONFIGURATION ---
        // 1. PASTE YOUR GOOGLE SCRIPT URL HERE:
        // 1. PASTE YOUR GOOGLE SCRIPT URL HERE (From your Deployment):
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbye1nUUxpxcbMLQrby3tvyCD043fz6twdCZhueU04ZRsaLdiuX7c-Q3jaivpJf-vuL2/exec";

        // 2. UNIQUE NAME FOR THIS SPECIFIC TEST (Demand #3)
        // Change this string for every new HTML file you create (e.g., "History_2025", "Mock_01")
        const TEST_ID = "Paper_2022_Full";

        // 3. ALLOWED USERS (Optional, since you are using Razorpay automation)
        const ALLOWED_USERS = ["1111", "2025", "9999", "STUDENT1"];

        // ------------------------------
        let globalCloudData = [];
        let responses = new Array(questions.length).fill(null);
        let status = new Array(questions.length).fill(0);
        let timeLeft = 0;
        let timerRef;
        let userName = "Student";
        let history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        let isMobile = false;

        // Initialize
        // --- 1. NEW SETUP & VISUALS ---
        let typingTimer;

        // --- 1. NEW WINDOW.ONLOAD (Includes "SocioLogic" Hint) ---
        window.onload = function () {
            if (window.innerWidth < 768) setMode('mobile');
            else setMode('desktop');

            document.getElementById('timer').innerText = "00:00:00";

            // Add Listeners
            document.getElementById('candidateName').addEventListener('input', checkStartConditions);
            document.getElementById('username').addEventListener('keyup', handleIdInput);

            // --- AUTO-SHOW HINT FOR FREE TESTS ---
            if (typeof TEST_ID !== 'undefined' && TEST_ID.toUpperCase().startsWith("FREE")) {
                const idInput = document.getElementById('username');

                // 1. Change Placeholder
                idInput.placeholder = "Enter ID: SocioLogic";

                // 2. Insert Hint Text
                const hintDiv = document.createElement("div");
                hintDiv.innerHTML = "üí° <b>Guest Access:</b> Type <span style='color:#2563eb; font-weight:800;'>SocioLogic</span> as your ID.";
                hintDiv.style.fontSize = "0.85rem";
                hintDiv.style.color = "#64748b";
                hintDiv.style.marginTop = "-10px";
                hintDiv.style.marginBottom = "15px";
                hintDiv.style.background = "#eff6ff";
                hintDiv.style.padding = "8px";
                hintDiv.style.borderRadius = "8px";
                hintDiv.style.border = "1px dashed #bfdbfe";

                // Insert it right after the input box
                idInput.parentNode.insertBefore(hintDiv, idInput.nextSibling);
            }
        };

        // --- 2. KEEP THIS FUNCTION (Do not delete!) ---
        function setMode(mode) {
            isMobile = (mode === 'mobile');
            const dBtn = document.getElementById('btn-desktop');
            const mBtn = document.getElementById('btn-mobile');

            // Safety check in case buttons don't exist yet
            if (dBtn && mBtn) {
                dBtn.className = isMobile ? 'mode-btn' : 'mode-btn active';
                mBtn.className = isMobile ? 'mode-btn active' : 'mode-btn';
            }
        }



        let checkTimer;

        function handleIdInput() {
            const idVal = document.getElementById('username').value.trim();
            const badge = document.getElementById('attempt-badge');
            const btn = document.getElementById('start-btn');

            // 1. Disable Button while typing
            btn.disabled = true;
            btn.style.backgroundColor = "#cbd5e1";
            btn.innerText = "Enter Details to Start";
            btn.style.cursor = "not-allowed";

            clearTimeout(checkTimer);

            // 2. Basic Validation
            if (idVal.length < 4) {
                badge.innerHTML = "Waiting for 4-digit ID...";
                badge.style.background = "#f1f5f9";
                badge.style.color = "#64748b";
                badge.style.borderColor = "#e2e8f0";
                return;
            }

            // 3. Show "Checking..."
            badge.innerHTML = "üîÑ Checking Records...";
            badge.style.background = "#fffbeb";
            badge.style.color = "#d97706";

            checkTimer = setTimeout(() => {
                fetch(SCRIPT_URL + "?type=check&id=" + encodeURIComponent(idVal) + "&test=" + encodeURIComponent(TEST_ID))
                    .then(response => response.text())
                    .then(countText => {
                        // A. Check for Block
                        if (countText.includes("BLOCK_NOT_PAID")) {
                            badge.innerHTML = `‚õî <b>Access Denied: ID not found in Paid List.</b>`;
                            badge.style.background = "#fee2e2";
                            badge.style.color = "#b91c1c";
                            badge.style.borderColor = "#fecaca";
                            return;
                        }

                        // --- B. MAGIC FIX: If Test is FREE, Ignore Limits! ---
                        if (typeof TEST_ID !== 'undefined' && TEST_ID.toUpperCase().startsWith("FREE")) {
                            badge.innerHTML = `‚úÖ <b>Free Access:</b> Unlimited Attempts Allowed`;
                            badge.style.background = "#dcfce7";
                            badge.style.color = "#15803d";
                            badge.style.borderColor = "#86efac";

                            checkStartConditions(); // Unlock immediately
                            return;
                        }
                        // ---------------------------------------------------

                        // C. Normal Logic for Paid Tests
                        const used = parseInt(countText) || 0;
                        const max = 5;
                        const remaining = max - used;

                        if (used >= max) {
                            badge.innerHTML = `‚õî <b>Total: ${max} | Exhausted: ${used} | Remaining: 0</b>`;
                            badge.style.background = "#fee2e2";
                            badge.style.color = "#b91c1c";
                            badge.style.borderColor = "#fecaca";
                        } else {
                            badge.innerHTML = `‚úÖ <b>Total: ${max} | Exhausted: ${used} | Remaining: ${remaining}</b>`;
                            badge.style.background = "#dcfce7";
                            badge.style.color = "#15803d";
                            badge.style.borderColor = "#86efac";
                            checkStartConditions();
                        }
                    })
                    .catch(err => {
                        badge.innerHTML = "‚ùå Connection Error.";
                    });
            }, 800);
        }
        function calculateAndShowAttempts() {
            const idVal = document.getElementById('username').value.trim();
            // Filters history to only count items belonging to the ID entered
            const attemptsUsed = history.filter(rec => rec.userID === idVal).length;

            const attemptsLeft = MAX_ATTEMPTS - attemptsUsed;
            const badge = document.getElementById('attempt-badge');

            if (attemptsUsed >= MAX_ATTEMPTS) {
                badge.innerHTML = `‚ö†Ô∏è <b>Attempts Exhausted</b> (0 remaining)`;
                badge.style.color = "#ef4444";
                badge.style.background = "#fee2e2";
                badge.style.borderColor = "#fecaca";
            } else {
                badge.innerHTML = `‚úÖ <b>Attempt #${attemptsUsed + 1}</b> (${attemptsLeft} remaining)`;
                badge.style.color = "#15803d";
                badge.style.background = "#dcfce7";
                badge.style.borderColor = "#86efac";
            }
            checkStartConditions();
        }

        function checkStartConditions() {
            const name = document.getElementById('candidateName').value.trim();
            const id = document.getElementById('username').value.trim();
            const badgeText = document.getElementById('attempt-badge').innerText;
            const btn = document.getElementById('start-btn');

            // Replace the old "const isBadgeValid = ..." line with this:
            const isBadgeValid = (badgeText.includes("Remaining") || badgeText.includes("Unlimited") || badgeText.includes("Attempt")) && !badgeText.includes("Remaining: 0");
            if (name.length > 0 && id.length >= 4 && isBadgeValid) {
                btn.disabled = false;
                btn.style.backgroundColor = "#2563eb";
                btn.style.cursor = "pointer";
                btn.innerText = "Start Examination ‚ûú";
            }
        }

        // --- 2. THE SECURITY GATEKEEPER (The "Start" Click) ---
        function startTest() {
            const nameInput = document.getElementById('candidateName');
            const idInput = document.getElementById('username');
            const startBtn = document.getElementById('start-btn');

            const nameVal = nameInput.value.trim();
            const idVal = idInput.value.trim();

            // Double Check
            if (!nameVal || !idVal) return;

            // UI Loading
            startBtn.disabled = true;
            startBtn.innerText = "Verifying Access...";

            // SERVER CHECK (Blocks Random IDs)
            const requestUrl = SCRIPT_URL + "?id=" + encodeURIComponent(idVal) +
                "&name=" + encodeURIComponent(nameVal) +
                "&test=" + encodeURIComponent(TEST_ID);

            fetch(requestUrl)
                .then(response => response.text())
                .then(data => {
                    if (data === "ALLOW") {
                        // SUCCESS: User is Paid & Valid
                        userName = nameVal;
                        document.getElementById('nav-user').innerText = userName;

                        document.getElementById('welcome-screen').style.display = 'none';
                        document.getElementById('app-wrapper').style.display = 'flex';

                        // Mobile Setup
                        if (isMobile) {
                            document.body.classList.add('mobile-mode');
                            document.getElementById('mob-menu').style.display = 'block';
                            document.getElementById('mob-close-sb').style.display = 'block';
                            document.getElementById('btn-next').innerText = "Next ‚ûú";
                            document.getElementById('btn-review').innerText = "Review";
                        } else {
                            document.body.classList.remove('mobile-mode');
                            document.getElementById('mob-menu').style.display = 'none';
                            document.getElementById('mob-close-sb').style.display = 'none';
                            document.getElementById('btn-next').innerText = "Save & Next ‚ûú";
                            document.getElementById('btn-review').innerText = "üö© Review";
                        }

                        current = 0;
                        responses = new Array(questions.length).fill(null);
                        status = new Array(questions.length).fill(0);
                        timeLeft = questions.length * SECONDS_PER_QUESTION;

                        initTest();
                    } else if (data === "BLOCK_NOT_PAID") {
                        // BLOCKS RANDOM USERS
                        alert("‚õî ACCESS DENIED: ID '" + idVal + "' not found. Please buy access first.");
                        startBtn.disabled = false;
                        startBtn.innerText = "Start Examination ‚ûú";
                    } else {
                        // BLOCKS LIMIT EXCEEDED
                        alert("‚ö†Ô∏è LIMIT REACHED: ID '" + idVal + "' has used all 5 attempts.");
                        startBtn.disabled = false;
                        startBtn.innerText = "Start Examination ‚ûú";
                    }
                })
                .catch(error => {
                    alert("‚ùå CONNECTION ERROR: Unable to verify. Check internet.");
                    startBtn.disabled = false;
                    startBtn.innerText = "Start Examination ‚ûú";
                });
        }
        function initTest() {
            renderQ(0);
            renderPalette();
            updateTimerDisplay();

            clearInterval(timerRef);
            timerRef = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) finishTest();
            }, 1000);
        }

        function updateTimerDisplay() {
            let h = Math.floor(timeLeft / 3600).toString().padStart(2, '0');
            let m = Math.floor((timeLeft % 3600) / 60).toString().padStart(2, '0');
            let s = (timeLeft % 60).toString().padStart(2, '0');
            document.getElementById('timer').innerText = `${h}:${m}:${s}`;
        }

        function renderQ(idx) {
            current = idx;
            const q = questions[idx];
            if (status[idx] === 0) { status[idx] = 1; renderPalette(); }

            const optionsHtml = q.options.map((opt, i) => {
                const isSelected = responses[idx] === i;
                const isMarkedReview = (status[idx] === 4 && isSelected);
                let cls = 'option';
                if (isMarkedReview) cls += ' review-marked selected';
                else if (isSelected) cls += ' selected';

                return `
            <div class="${cls}" onclick="selectOpt(${i})">
                <div class="opt-key">${String.fromCharCode(65 + i)}</div>
                <div style="flex:1">${opt}</div>
            </div>`;
            }).join('');

            document.getElementById('q-panel').innerHTML = `
            <div class="q-header">
                <span class="topic-tag">${q.topic}</span>
                <span class="q-counter">Q.${idx + 1} / ${questions.length}</span>
            </div>
            <div class="q-text">${q.text}</div>
            <div>${optionsHtml}</div>
        `;
        }

        function selectOpt(i) {
            responses[current] = i;
            status[current] = (status[current] === 3 || status[current] === 4) ? 4 : 2;
            renderQ(current);
            renderPalette();
        }

        function nav(d) {
            const next = current + d;
            if (next >= 0 && next < questions.length) renderQ(next);
        }

        function renderPalette() {
            document.getElementById('palette').innerHTML = questions.map((_, i) => {
                let cls = 'grid-btn';
                if (i === current) cls += ' st-curr';
                if (status[i] === 2) cls += ' st-ans';
                else if (status[i] === 3) cls += ' st-rev';
                else if (status[i] === 4) cls += ' st-ans-rev';
                return `<div class="${cls}" onclick="renderQ(${i})">${i + 1}</div>`;
            }).join('');
        }

        function markReview() {
            status[current] = responses[current] !== null ? 4 : 3;
            renderQ(current);
            renderPalette();
            nav(1);
        }

        function clearResp() {
            responses[current] = null;
            status[current] = 1;
            renderQ(current);
            renderPalette();
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }

        /* --- NEW HISTORY LOGIC --- */
        function openHistory() {
            const list = document.getElementById('history-list');
            const currentID = document.getElementById('username').value.trim();

            if (currentID.length < 4) { alert("Please enter your ID first."); return; }

            // Show loading state (Matches your existing CSS)
            list.innerHTML = `<div style="text-align:center; padding:20px; color:#64748b;">üîÑ Syncing with Cloud...</div>`;
            document.getElementById('history-modal').style.display = 'flex';

            // Fetch from Cloud
            fetch(SCRIPT_URL + "?type=history&id=" + encodeURIComponent(currentID))
                .then(res => res.json())
                .then(cloudData => {
                    globalCloudData = cloudData;
                    list.innerHTML = "";

                    if (cloudData.length === 0) {
                        list.innerHTML = `<div class="hist-empty">No records found for ID: <b>${currentID}</b></div>`;
                    } else {
                        // Render List (Using your EXACT existing CSS classes)
                        cloudData.forEach((rec, i) => {
                            list.innerHTML += `
                                <div class="hist-item" onclick="loadCloudAttempt(${i})">
                                    <div class="h-left">
                                        <span class="h-title">${rec.test}</span>
                                        <span class="h-date">üìÖ ${rec.date}</span>
                                    </div>
                                    <div style="display:flex; align-items:center; gap:10px;">
                                        <div class="h-score-badge">${rec.score}</div>
                                        <span style="color:#cbd5e1;">‚ûú</span>
                                    </div>
                                </div>`;
                        });
                    }
                })
                .catch(err => {
                    list.innerHTML = `<div class="hist-empty" style="color:#ef4444">‚ùå Connection Error.</div>`;
                });
        }
        function loadCloudAttempt(index) {
            const rec = globalCloudData[index];
            if (!rec || !rec.resp) {
                alert("Detailed data not available for this attempt.");
                return;
            }

            // Convert cloud data back to local format
            const parsedResponses = rec.resp.split(',').map(val => val === 'N' ? null : parseInt(val));

            const fullRecord = {
                date: rec.date,
                userID: document.getElementById('username').value,
                userResponses: parsedResponses
            };

            // Re-use your existing Result Screen renderer
            renderResultScreen(fullRecord);
            closeHistory();
        }

        // Helper to find the right record when clicked in history
        function reviewAttemptFromHistory(dateId) {
            const record = history.find(r => r.date === dateId);
            if (record) {
                renderResultScreen(record);
                closeHistory();
            }
        }

        function closeHistory() { document.getElementById('history-modal').style.display = 'none'; }
        function reviewAttempt(index) { renderResultScreen(history[index]); closeHistory(); }

        /* --- RESULTS --- */
        function finishTest() {
            clearInterval(timerRef);
            let score = 0, cor = 0, wro = 0;
            responses.forEach((ans, i) => {
                if (ans === questions[i].correct) { score += 4; cor++; }
                else if (ans !== null) { score -= 1; wro++; }
            });

            // 1. Prepare Data
            const finalScore = score + " / " + (questions.length * 4);
            const uName = document.getElementById('candidateName').value.trim();
            const uID = document.getElementById('username').value.trim();

            // Create answer string (e.g. "1,0,N,2")
            const respString = responses.map(r => r === null ? 'N' : r).join(',');

            // 2. SEND TO CLOUD (Silent Backup)
            // This is the ONLY new part. It happens in the background.
            fetch(SCRIPT_URL + "?type=submit&id=" + encodeURIComponent(uID) +
                "&name=" + encodeURIComponent(uName) +
                "&test=" + encodeURIComponent(TEST_ID) +
                "&score=" + encodeURIComponent(finalScore) +
                "&resp=" + encodeURIComponent(respString));

            // 3. Save Locally & Show Result (Your existing logic)
            const record = {
                date: new Date().toLocaleString(),
                userID: uID,
                score: score,
                correct: cor,
                wrong: wro,
                userResponses: [...responses]
            };
            history.push(record);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
            renderResultScreen(record);
        }
        function renderResultScreen(data) {
            // --- SAFETY FIX: Re-calculate stats in case old records miss them ---
            // This ensures even old history opens perfectly.
            let calculatedScore = 0;
            let calculatedCorrect = 0;
            let calculatedWrong = 0;
            let calculatedAtt = 0;

            // Check if userResponses exists (Legacy support)
            const responsesToUse = data.userResponses || new Array(questions.length).fill(null);

            questions.forEach((q, i) => {
                const ans = responsesToUse[i];
                if (ans !== null && ans !== undefined) {
                    calculatedAtt++;
                    if (ans === q.correct) {
                        calculatedScore += 4;
                        calculatedCorrect++;
                    } else {
                        calculatedScore -= 1;
                        calculatedWrong++;
                    }
                }
            });
            // -------------------------------------------------------

            // 1. Calculate Stats
            const totalQ = questions.length;
            const maxMarks = totalQ * 4;

            // 2. Push to HTML (The Score Grid)
            // We check if elements exist before setting them to prevent errors
            if (document.getElementById('disp-att')) document.getElementById('disp-att').innerText = `${calculatedAtt} / ${totalQ}`;
            if (document.getElementById('disp-cor')) document.getElementById('disp-cor').innerText = calculatedCorrect;
            if (document.getElementById('disp-wro')) document.getElementById('disp-wro').innerText = calculatedWrong;
            if (document.getElementById('disp-score')) document.getElementById('disp-score').innerText = `${calculatedScore} / ${maxMarks}`;

            // 3. Switch Screens
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('result-overlay').style.display = 'flex';

            // 4. Generate Detailed List
            let topicData = {};
            const html = questions.map((q, i) => {
                const userAns = responsesToUse[i];
                const isCor = userAns === q.correct;

                if (!topicData[q.topic]) topicData[q.topic] = { total: 0, cor: 0 };
                topicData[q.topic].total++;
                if (isCor) topicData[q.topic].cor++;

                let statIcon = isCor ? '<span class="txt-green">‚úì Correct</span>' : (userAns !== null && userAns !== undefined ? '<span class="txt-red">‚úï Incorrect</span>' : '<span>‚óã Skipped</span>');
                let rowCls = isCor ? 'correct' : (userAns !== null && userAns !== undefined ? 'wrong' : '');

                const optionsList = q.options.map((opt, idx) => {
                    let style = "padding:8px 12px; border-radius:8px; margin-bottom:5px; display:flex; line-height:1.4; border:1px solid #e2e8f0; background:#f8fafc; color:#64748b;";
                    let prefix = `<b style="min-width:25px;">${String.fromCharCode(65 + idx)}.</b>`;
                    if (idx === q.correct) style = "padding:8px 12px; border-radius:8px; margin-bottom:5px; display:flex; line-height:1.4; border:1px solid #bbf7d0; background:#dcfce7; color:#166534; font-weight:600;";
                    else if (idx === userAns && !isCor) style = "padding:8px 12px; border-radius:8px; margin-bottom:5px; display:flex; line-height:1.4; border:1px solid #fecaca; background:#fee2e2; color:#991b1b; font-weight:600;";
                    return `<div style="${style}">${prefix} <span>${opt}</span></div>`;
                }).join('');

                return `
            <div class="exp-row ${rowCls}">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:700;">
                    <span style="color:#64748b; font-size:0.85rem">${q.topic}</span>${statIcon}
                </div>
                <div style="font-weight:600; margin-bottom:15px; font-size:1.1rem; color:#1e293b;">Q${i + 1}: ${q.text}</div>
                <div style="margin-bottom:20px; font-size:0.95rem;">${optionsList}</div>
                <div class="exp-detail">
                    <div class="why-box"><span class="txt-green" style="font-weight:700">‚úÖ Explanation:</span> ${q.expl.correct}</div>
                    <div class="why-box"><span class="txt-red" style="font-weight:700">‚ùå Error Analysis:</span> ${q.expl.others}</div>
                    <div style="background:#fffbeb; padding:10px; border-radius:8px; border:1px dashed #f59e0b; font-size:0.9rem; color:#92400e;">üí° <b>Trick:</b> ${q.expl.trick}</div>
                </div>
            </div>`;
            }).join('');

            document.getElementById('solution-feed').innerHTML = html;

            // 5. Update Weakness/Strength
            let best = { name: "N/A", acc: -1 }, worst = { name: "N/A", acc: 101 };
            for (const [t, d] of Object.entries(topicData)) {
                const acc = (d.cor / d.total) * 100;
                if (acc > best.acc) best = { name: t, acc: acc };
                if (acc < worst.acc) worst = { name: t, acc: acc };
            }
            if (best.acc === -1) { best = { name: "None", acc: 0 }; worst = { name: "None", acc: 0 }; }
            document.getElementById('area-strong').innerText = best.name;
            document.getElementById('area-weak').innerText = worst.name;
            document.getElementById('area-strong-stat').innerText = `Accuracy: ${Math.round(best.acc)}%`;
            document.getElementById('area-weak-stat').innerText = `Accuracy: ${Math.round(worst.acc)}%`;
        }

        function showThankYou() {
            document.getElementById('result-overlay').style.display = 'none';
            document.getElementById('ty-screen').style.display = 'flex';
        }
    </script>
    <style>
        /* 1. Global Select Protection (Stops Copying) */
        body {
            -webkit-user-select: none;
            /* Safari/Chrome */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* IE/Edge */
            user-select: none;
            /* Standard */

            /* MOBILE SPECIFIC: Stop Long-Press Menu */
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Allow typing in input boxes */
        input,
        textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
            -webkit-touch-callout: default;
        }

        /* 2. Print Protection (Hides content on Ctrl+P) */
        @media print {
            body {
                display: none !important;
            }

            html::after {
                content: "Taking Screenshots or making PDF of the page is prohibited.";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #fff;
                color: #333;
                font-size: 2rem;
                font-weight: bold;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                text-align: center;
                border: 20px solid #d1d5db;
            }
        }

        /* 3. Blur Filter Class (Used by JS) */
        .blur-content {
            filter: blur(15px);
            pointer-events: none;
            user-select: none;
        }
    </style>

    <script>
        // 4. Block Right Click (Desktop) & Long Press (Mobile)
        document.addEventListener('contextmenu', event => event.preventDefault());

        // 5. Blur Screen on Tab Switch (Anti-Cheating)
        // Professional warning when user minimizes or switches tabs
        document.addEventListener("visibilitychange", function () {
            if (document.hidden) {
                document.body.classList.add("blur-content");
                document.title = "Taking Screenshots or making PDF of the page is prohibited.";
            } else {
                // Add a 0.5s delay punishment before un-blurring
                setTimeout(() => {
                    document.body.classList.remove("blur-content");
                    document.title = "Exam Session Active";
                }, 500);
            }
        });

        // 6. Desktop Keyboard Blocks
        document.addEventListener('keydown', function (e) {
            // Block F12 (DevTools), Ctrl+Shift+I, Ctrl+P (Print), Ctrl+S (Save)
            if (e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.key === 'p') ||
                (e.ctrlKey && e.key === 's')) {
                e.preventDefault();
                return false;
            }

            // Detect PrintScreen Key
            if (e.key === 'PrintScreen') {
                alert("System Warning: Screen capture is disabled. ");
                document.body.classList.add("blur-content");
                setTimeout(() => document.body.classList.remove("blur-content"), 3000); // Punish with 3s blur
            }
        });
    </script>

</body>

</html>